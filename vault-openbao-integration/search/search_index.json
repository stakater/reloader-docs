{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"What is Reloader?","text":""},{"location":"index.html#what-is-reloader","title":"What is Reloader?","text":"<p>Configuration changes, applied safely \u2014 every time.</p> <p>Reloader ensures that configuration and secret changes in Kubernetes are applied to running workloads in a safe, automatic, and consistent way.</p> <p>In Kubernetes, updating a ConfigMap or Secret does not automatically update running Pods. Without additional controls, this often leads to manual restarts, stale configuration, and operational risk.</p> <p>Reloader closes this gap by observing configuration changes and triggering workload updates based on explicit and predictable rules.</p>"},{"location":"index.html#why-reloader-exists","title":"Why Reloader Exists","text":"<p>In many Kubernetes environments, configuration changes rely on manual intervention or best-effort operational practices.</p> <p>Common challenges include:</p> <ul> <li>Workloads running with outdated configuration or secrets</li> <li>Manual restarts causing downtime or errors</li> <li>Inconsistent behavior across environments</li> <li>Platform teams becoming operational bottlenecks</li> </ul> <p>Reloader was created to make configuration changes deterministic operational events, rather than ad-hoc procedures.</p>"},{"location":"index.html#reloaders-operational-model","title":"Reloader\u2019s Operational Model","text":"<p>Reloader introduces a consistent operational model for handling configuration and secret changes in Kubernetes.</p> <p>At a high level:</p> <ol> <li>Configuration or secrets are updated</li> <li>Reloader detects the change</li> <li>A controlled workload update is triggered</li> <li>The updated configuration is applied at runtime</li> </ol> <p>This model ensures that approved configuration changes are actually reflected in running workloads, without requiring application changes or manual intervention.</p>"},{"location":"index.html#deterministic-change-propagation","title":"Deterministic Change Propagation","text":"<p>Reloader ensures that configuration changes are not silently ignored. Once a change is detected, the corresponding workload update follows a predictable and observable path.</p>"},{"location":"index.html#reduced-operational-risk","title":"Reduced Operational Risk","text":"<p>By removing ad-hoc restarts and manual procedures, Reloader reduces human error and improves platform reliability.</p>"},{"location":"eula.html","title":"EULA","text":""},{"location":"eula.html#eula","title":"EULA","text":"<p>Last revision date: 12 December 2022</p> <p>IMPORTANT: THIS SOFTWARE END-USER LICENSE AGREEMENT (\"EULA\") IS A LEGAL AGREEMENT (\"Agreement\") BETWEEN YOU (THE CUSTOMER, EITHER AS AN INDIVIDUAL OR, IF PURCHASED OR OTHERWISE ACQUIRED BY OR FOR AN ENTITY, AS AN ENTITY) AND Stakater AB OR ITS SUBSIDUARY (\"COMPANY\"). READ IT CAREFULLY BEFORE COMPLETING THE INSTALLATION PROCESS AND USING MULTI TENANT OPERATOR (\"SOFTWARE\"). IT PROVIDES A LICENSE TO USE THE SOFTWARE AND CONTAINS WARRANTY INFORMATION AND LIABILITY DISCLAIMERS. BY INSTALLING AND USING THE SOFTWARE, YOU ARE CONFIRMING YOUR ACCEPTANCE OF THE SOFTWARE AND AGREEING TO BECOME BOUND BY THE TERMS OF THIS AGREEMENT.</p> <p>In order to use the Software under this Agreement, you must receive a license key at the time of purchase, in accordance with the scope of use and other terms specified and as set forth in Section 1 of this Agreement.</p>"},{"location":"eula.html#1-license-grant","title":"1. License Grant","text":"<ul> <li> <p>1.1 General Use. This Agreement grants you a non-exclusive, non-transferable, limited license to the use rights for the Software, subject to the terms and conditions in this Agreement. The Software is licensed, not sold.</p> </li> <li> <p>1.2 Electronic Delivery. All Software and license documentation shall be delivered by electronic means unless otherwise specified on the applicable invoice or at the time of purchase. Software shall be deemed delivered when it is made available for download for you by the Company (\"Delivery\").</p> </li> </ul>"},{"location":"eula.html#2-modifications","title":"2. Modifications","text":"<ul> <li> <p>2.1 No Modifications may be created of the original Software. \"Modification\" means:</p> <ul> <li> <p>(a) Any addition to or deletion from the contents of a file included in the original Software</p> </li> <li> <p>(b) Any new file that contains any part of the original Software</p> </li> </ul> </li> </ul>"},{"location":"eula.html#3-restricted-uses","title":"3. Restricted Uses","text":"<ul> <li> <p>3.1 You shall not (and shall not allow any third party to):</p> <ul> <li> <p>(a) reverse engineer the Software or attempt to reconstruct or discover any source code, underlying ideas, algorithms, file formats or programming interfaces of the Software by any means whatsoever (except and only to the extent that applicable law prohibits or restricts reverse engineering restrictions);</p> </li> <li> <p>(b) distribute, sell, sub-license, rent, lease or use the Software for time sharing, hosting, service provider or like purposes, except as expressly permitted under this Agreement;</p> </li> <li> <p>(c) redistribute the Software;</p> </li> <li> <p>(d) remove any product identification, proprietary, copyright or other notices contained in the Software;</p> </li> <li> <p>(e) modify any part of the Software, create a derivative work of any part of the Software (except as permitted in Section 4), or incorporate the Software, except to the extent expressly authorized in writing by the Company;</p> </li> <li> <p>(f) publicly disseminate performance information or analysis (including, without limitation, benchmarks) from any source relating to the Software;</p> </li> <li> <p>(g) utilize any equipment, device, software, or other means designed to circumvent or remove any form of Source URL or copy protection used by the Company in connection with the Software, or use the Software together with any authorization code, Source URL, serial number, or other copy protection device not supplied by the Company;</p> </li> <li> <p>(h) use the Software to develop a product which is competitive with any of the Company's product offerings;</p> </li> <li> <p>(i) use unauthorized Source URLs or license key(s) or distribute or publish Source URLs or license key(s), except as may be expressly permitted by the Company in writing. If your unique license is ever published, the Company reserves the right to terminate your access without notice.</p> </li> </ul> </li> <li> <p>3.2 Under no circumstances may you use the Software as part of a product or service that provides similar functionality to the Software itself.</p> </li> </ul>"},{"location":"eula.html#4-ownership","title":"4. Ownership","text":"<ul> <li>4.1 Notwithstanding anything to the contrary contained herein, except for the limited license rights expressly provided herein, the Company and its suppliers have and will retain all rights, title and interest (including, without limitation, all patent, copyright, trademark, trade secret and other intellectual property rights) in and to the Software and all copies, modifications and derivative works thereof (including any changes which incorporate any of your ideas, feedback or suggestions). You acknowledge that you are obtaining only a limited license right to the Software, and that irrespective of any use of the words \"purchase\", \"sale\" or like terms hereunder no ownership rights are being conveyed to you under this Agreement or otherwise.</li> </ul>"},{"location":"eula.html#5-fees-and-payment","title":"5. Fees and Payment","text":"<ul> <li>5.1 The Software license fees will be due and payable in full as set forth in the applicable invoice or at the time of purchase. You shall be responsible for all taxes, with-holdings, duties and levies arising from the order (excluding taxes based on the net income of the Company).</li> </ul>"},{"location":"eula.html#6-support-maintenance-and-services","title":"6. Support, Maintenance and Services","text":"<ul> <li>6.1 Subject to the terms and conditions of this Agreement, as set forth in your invoice, and as set forth on the Stakater support page, support and maintenance services may be included with the purchase of your license subscription.</li> </ul>"},{"location":"eula.html#7-disclaimer-of-warranties","title":"7. Disclaimer of Warranties","text":"<ul> <li> <p>7.1 The Software is provided \"as is\", with all faults, defects and errors, and without warranty of any kind. The Company does not warrant that the Software will be free of bugs, errors, or other defects, and the Company shall have no liability of any kind for the use of or inability to use the Software, the Software content or any associated service, and you acknowledge that it is not technically practicable for the Company to do so.</p> </li> <li> <p>7.2 To the maximum extent permitted by applicable law, the Company disclaims all warranties, express, implied, arising by law or otherwise, regarding the Software, the Software content and their respective performance or suitability for your intended use, including without limitation any implied warranty of merchantability, fitness for a particular purpose.</p> </li> </ul>"},{"location":"eula.html#8-limitation-of-liability","title":"8. Limitation of Liability","text":"<ul> <li> <p>8.1 In no event will the Company be liable for any direct, indirect, consequential, incidental, special, exemplary, or punitive damages or liabilities whatsoever arising from or relating to the Software, the Software content or this Agreement, whether based on contract, tort (including negligence), strict liability or other theory, even if the Company has been advised of the possibility of such damages.</p> </li> <li> <p>8.2 In no event will the Company's liability exceed the Software license price as indicated in the invoice. The existence of more than one claim will not enlarge or extend this limit.</p> </li> </ul>"},{"location":"eula.html#9-remedies","title":"9. Remedies","text":"<ul> <li> <p>9.1 Your exclusive remedy and the Company's entire liability for breach of this Agreement shall be limited, at the Company's sole and exclusive discretion, to:</p> <ul> <li> <p>(a) replacement of any defective software or documentation; or</p> </li> <li> <p>(b) refund of the license fee paid to the Company</p> </li> </ul> </li> </ul>"},{"location":"eula.html#10-acknowledgements","title":"10. Acknowledgements","text":"<ul> <li> <p>10.1 Consent to the Use of Data. You agree that the Company and its affiliates may collect and use technical information gathered as part of the product support services. The Company may use this information solely to improve products and services and will not disclose this information in a form that personally identifies individuals or organizations.</p> </li> <li> <p>10.2 Government End Users. If the Software and related documentation are supplied to or purchased by or on behalf of a Government, then the Software is deemed to be \"commercial software\" as that term is used in the acquisition regulation system.</p> </li> </ul>"},{"location":"eula.html#11-third-party-software","title":"11. Third Party Software","text":"<ul> <li> <p>11.1 Examples included in Software may provide links to third party libraries or code (collectively \"Third Party Software\") to implement various functions. Third Party Software does not comprise part of the Software. In some cases, access to Third Party Software may be included along with the Software delivery as a convenience for demonstration purposes. Licensee acknowledges:</p> <ul> <li> <p>(1) That some part of Third Party Software may require additional licensing of copyright and patents from the owners of such, and</p> </li> <li> <p>(2) That distribution of any of the Software referencing or including any portion of a Third Party Software may require appropriate licensing from such third parties</p> </li> </ul> </li> </ul>"},{"location":"eula.html#12-miscellaneous","title":"12. Miscellaneous","text":"<ul> <li> <p>12.1 Entire Agreement. This Agreement sets forth our entire agreement with respect to the Software and the subject matter hereof and supersedes all prior and contemporaneous understandings and agreements whether written or oral.</p> </li> <li> <p>12.2 Amendment. The Company reserves the right, in its sole discretion, to amend this Agreement from time. Amendments are managed as described in General Provisions.</p> </li> <li> <p>12.3 Assignment. You may not assign this Agreement or any of its rights under this Agreement without the prior written consent of The Company and any attempted assignment without such consent shall be void.</p> </li> <li> <p>12.4 Export Compliance. You agree to comply with all applicable laws and regulations, including laws, regulations, orders or other restrictions on export, re-export or redistribution of software.</p> </li> <li> <p>12.5 Indemnification. You agree to defend, indemnify, and hold harmless the Company from and against any lawsuits, claims, losses, damages, fines and expenses (including attorneys' fees and costs) arising out of your use of the Software or breach of this Agreement.</p> </li> <li> <p>12.6 Attorneys' Fees and Costs. The prevailing party in any action to enforce this Agreement will be entitled to recover its attorneys' fees and costs in connection with such action.</p> </li> <li> <p>12.7 Severability. If any provision of this Agreement is held by a court of competent jurisdiction to be invalid, illegal, or unenforceable, the remainder of this Agreement will remain in full force and effect.</p> </li> <li> <p>12.8 Waiver. Failure or neglect by either party to enforce at any time any of the provisions of this license Agreement shall not be construed or deemed to be a waiver of that party's rights under this Agreement.</p> </li> <li> <p>12.9 Audit. The Company may, at its expense, appoint its own personnel or an independent third party to audit the numbers of installations of the Software in use by you. Any such audit shall be conducted upon thirty (30) days prior notice, during regular business hours and shall not unreasonably interfere with your business activities.</p> </li> <li> <p>12.10 Headings. The headings of sections and paragraphs of this Agreement are for convenience of reference only and are not intended to restrict, affect or be of any weight in the interpretation or construction of the provisions of such sections or paragraphs.</p> </li> </ul>"},{"location":"eula.html#13-contact-information","title":"13. Contact Information","text":"<ul> <li>13.1 If you have any questions about this EULA, or if you want to contact the Company for any reason, please direct correspondence to <code>sales@stakater.com</code>.</li> </ul>"},{"location":"help.html","title":"Support","text":""},{"location":"help.html#to-get-help","title":"To get help","text":"<p>If you need assistance, please create a support ticket in the support portal.</p>"},{"location":"versions.html","title":"Versions","text":""},{"location":"versions.html#reloader-enterprise-release-history","title":"Reloader Enterprise \u2013 Release History","text":""},{"location":"versions.html#v1410","title":"v1.4.10","text":""},{"location":"versions.html#release-metadata","title":"Release Metadata","text":"Version<code>v1.4.10</code> Container Image<code>ghcr.io/stakater/reloader-enterprise:v1.4.10</code> Container Image UBI<code>ghcr.io/stakater/reloader-enterprise:v1.4.10-ubi</code> Reloader OSS Release NotesRelease Notes"},{"location":"versions.html#sbom","title":"SBOM","text":"Click to expand SBOM JSON <pre><code>{\n  \"artifacts\": [\n    {\n      \"name\": \"ghcr.io/stakater/reloader-enterprise:v1.4.10\",\n      \"digest\": \"sha256:b20e65ed59211bb03c8873767c45ca491385d6956913ebd8b31030e29f734b08\"\n    },\n    {\n      \"name\": \"ghcr.io/stakater/reloader-enterprise:v1.4.10-ubi\",\n      \"digest\": \"sha256:7717317a0aff163e22c572f0a9644fe5f41128c1f525d2a95e4f91d994193fb6\"\n    }\n  ]\n}\n</code></pre>"},{"location":"versions.html#v149","title":"v1.4.9","text":""},{"location":"versions.html#release-metadata_1","title":"Release Metadata","text":"Version<code>v1.4.9</code> Container Image<code>ghcr.io/stakater/reloader-enterprise:v1.4.9</code> Container Image UBI<code>ghcr.io/stakater/reloader-enterprise:v1.4.9-ubi</code> Reloader OSS Release NotesRelease Notes"},{"location":"versions.html#sbom_1","title":"SBOM","text":"Click to expand SBOM JSON <pre><code>{\n  \"artifacts\": [\n    {\n      \"name\": \"ghcr.io/stakater/reloader-enterprise:v1.4.9\",\n      \"digest\": \"sha256:60a7c16e00d6df071161235e9b949283e206faa77b061247b87d54d7ca81bad0\"\n    },\n    {\n      \"name\": \"ghcr.io/stakater/reloader-enterprise:v1.4.9-ubi\",\n      \"digest\": \"sha256:2cc7f1b206b78d3530050406feed4a5acf2ae3b0bd59e8eb9f3d1c9120c8c6d4\"\n    }\n  ]\n}\n</code></pre> <p>Generated by automation</p>"},{"location":"about/editions.html","title":"OSS vs Enterprise","text":""},{"location":"about/editions.html#reloader-editions","title":"Reloader Editions","text":"<p>Reloader is available in two editions: OSS and Enterprise.</p>"},{"location":"about/editions.html#edition-comparison","title":"Edition comparison","text":"Capability Reloader OSS Reloader Enterprise Core reload functionality \u2705 \u2705 Kubernetes-native behavior \u2705 \u2705 Works with any Secret delivery mechanism (ESO, CSI, init containers, etc.) \u2705 \u2705 Hardened and verified container images \u274c \u2705 Validated integrations \u274c \u2705 Continuous integration testing \u274c \u2705 Upgrade &amp; compatibility guarantees \u274c \u2705 Long-term maintenance &amp; backported fixes \u274c \u2705 Commercial support &amp; SLA \u274c \u2705 Production onboarding &amp; guidance \u274c \u2705 Suitable for regulated / audited environments \u274c \u2705"},{"location":"about/value-by-role.html","title":"Value by Role","text":""},{"location":"about/value-by-role.html#value-by-role","title":"Value by Role","text":"<p>Reloader is used by multiple roles within an organization. While the underlying operational model is the same, its impact differs depending on responsibility and scope.</p> <p>This page describes how different roles typically interact with and benefit from Reloader.</p>"},{"location":"about/value-by-role.html#platform-engineers-and-sres","title":"Platform Engineers and SREs","text":"<p>Platform teams are responsible for cluster stability, consistency, and operational safety across environments.</p> <p>Reloader supports platform teams by:</p> <ul> <li>Ensuring configuration and secret changes are applied consistently</li> <li>Eliminating the need for manual restarts and ad-hoc operational procedures</li> <li>Reducing configuration drift across clusters and environments</li> <li>Providing a predictable and observable model for change propagation</li> </ul> <p>By standardizing how configuration changes are handled, platform teams can reduce operational toil and lower the risk of incidents caused by stale configuration.</p> <p>Advanced governance and audit capabilities are available in Reloader Enterprise.</p>"},{"location":"about/value-by-role.html#application-developers","title":"Application Developers","text":"<p>Application teams are often affected by configuration issues without having direct control over the underlying platform.</p> <p>Reloader enables application teams to:</p> <ul> <li>Rely on configuration and secret changes being applied automatically</li> <li>Avoid application-specific reload logic</li> <li>Experience consistent runtime behavior across environments</li> </ul> <p>This allows developers to focus on application logic while the platform handles configuration change propagation in a uniform way.</p>"},{"location":"about/value-by-role.html#security-risk-and-compliance","title":"Security, Risk, and Compliance","text":"<p>Security and compliance teams require confidence that approved configuration changes are enforced in runtime environments.</p> <p>Reloader contributes by:</p> <ul> <li>Reducing reliance on manual operational procedures</li> <li>Ensuring approved configuration and secret changes are consistently applied</li> <li>Creating a clearer link between desired configuration and runtime behavior</li> </ul> <p>In regulated environments, this reduces operational risk and simplifies audit and compliance discussions.</p> <p>Structured audit and governance capabilities are available in Reloader Enterprise.</p>"},{"location":"about/value-by-role.html#engineering-management","title":"Engineering Management","text":"<p>Engineering leaders are responsible for balancing delivery speed, reliability, and operational risk.</p> <p>Reloader supports this by:</p> <ul> <li>Reducing incidents caused by configuration drift</li> <li>Lowering operational overhead on platform teams</li> <li>Enabling platform scale without proportional increases in operational effort</li> </ul> <p>This helps organizations operate Kubernetes environments more predictably as they grow.</p>"},{"location":"about/why-reloader-matters.html","title":"Why Reloader Matters","text":""},{"location":"about/why-reloader-matters.html#why-reloader-matters","title":"Why Reloader Matters","text":"<p>Reloader addresses a class of operational problems that emerge when configuration changes are not consistently applied to running workloads.</p> <p>This page describes the key outcomes Reloader provides when used as part of a Kubernetes platform.</p>"},{"location":"about/why-reloader-matters.html#1-operational-reliability","title":"1. Operational Reliability","text":"<p>Reloader ensures that configuration and secret changes are not silently ignored by running workloads.</p> <p>This helps prevent:</p> <ul> <li>Workloads running with stale configuration</li> <li>Configuration updates being forgotten or partially applied</li> <li>Incidents caused by configuration drift between desired and runtime state</li> </ul>"},{"location":"about/why-reloader-matters.html#2-change-safety","title":"2. Change Safety","text":"<p>Uncontrolled restarts can introduce instability and unintended side effects.</p> <p>Reloader introduces a controlled mechanism for applying configuration changes which enables:</p> <ul> <li>Scoped and predictable workload updates</li> <li>Reduced blast radius during configuration changes</li> <li>Clean integration with GitOps-based workflows</li> </ul>"},{"location":"about/why-reloader-matters.html#3-operational-transparency","title":"3. Operational Transparency","text":"<p>Understanding when and why configuration changes are applied is critical for day-to-day operations and incident analysis.</p> <p>Reloader provides clear and observable behavior around configuration-driven workload updates, making it easier to:</p> <ul> <li>Understand what triggered a workload update</li> <li>Correlate configuration changes with runtime behavior</li> <li>Diagnose issues related to configuration propagation</li> </ul>"},{"location":"about/why-reloader-matters.html#4-compliance-efficiency","title":"4. Compliance Efficiency","text":"<p>In regulated environments, it is important that approved configuration changes are consistently enforced in runtime systems.</p> <p>Reloader supports this by:</p> <ul> <li>Reducing reliance on manual operational procedures</li> <li>Creating a clearer link between approved configuration and runtime behavior</li> <li>Lowering operational and audit risk caused by human error</li> </ul> <p>Additional governance and audit capabilities are available in Reloader Enterprise.</p>"},{"location":"about/why-reloader-matters.html#5-clear-separation-of-responsibilities","title":"5. Clear Separation of Responsibilities","text":"<p>Reloader helps enforce a clean separation of responsibilities between platform teams and application teams.</p> <ul> <li>Platform teams define how configuration changes are propagated</li> <li>Application teams consume configuration without implementing reload logic</li> </ul> <p>This reduces coupling between application code and platform operations, leading to more maintainable systems over time.</p>"},{"location":"about/why-reloader-matters.html#6-platform-scale","title":"6. Platform Scale","text":"<p>As Kubernetes environments grow, ad-hoc configuration handling does not scale.</p> <p>Reloader enables platform teams to:</p> <ul> <li>Apply a single, consistent pattern for configuration changes</li> <li>Reduce custom logic across teams and applications</li> <li>Enable safe self-service for application teams without increasing risk</li> </ul>"},{"location":"installation/install.html","title":"Reloader Enterprise","text":""},{"location":"installation/install.html#reloader-enterprise-re-installation","title":"Reloader Enterprise (RE) Installation","text":"<p>Reloader Enterprise (RE) is distributed through GitHub Container Registry (<code>GHCR</code>). Access to enterprise images is granted through GitHub, using a private package-proxy repository.</p> <p>To install Reloader Enterprise, customers must:</p> <ol> <li>Have an active Reloader Enterprise subscription  </li> <li>Receive access to the private package registry  </li> <li>Authenticate their Kubernetes cluster to pull the enterprise image  </li> <li>Install using the OSS Helm chart with enterprise overrides  </li> </ol> <p>This section explains how access is granted and how to perform the installation.</p>"},{"location":"installation/install.html#how-access-to-reloader-enterprise-is-granted","title":"How Access to Reloader Enterprise Is Granted?","text":"<p>Stakater provides access to Reloader Enterprise through a private GitHub package proxy repository.</p> <p>When you are added as a customer:</p> <ul> <li>You receive the <code>read</code> role  </li> <li>You can pull Reloader Enterprise images  </li> <li>You can view contributors  </li> <li>You cannot create branches, modify the code, or view other collaborators  </li> </ul> <p>The repository acts as a proxy to private build sources. It does not build artifacts itself.</p> <p>Access is available only to active Reloader Enterprise customers.</p>"},{"location":"installation/install.html#installation-overview","title":"Installation Overview","text":"<p>After access is granted, you may install Reloader Enterprise in one of two ways:</p>"},{"location":"installation/install.html#option-a-use-your-github-user","title":"Option A \u2014 Use Your GitHub User","text":"<p>You provide Stakater with your GitHub username. This user is added as a collaborator to the enterprise package repository.</p>"},{"location":"installation/install.html#option-b-use-a-token-provided-by-stakater","title":"Option B \u2014 Use a Token Provided by Stakater","text":"<p>Stakater issues a dedicated <code>reloader-enterprise</code> access token.</p> <p>Both methods require creating a Kubernetes registry secret and running a Helm install.</p>"},{"location":"installation/install.html#installation-method-a-using-your-github-user","title":"Installation Method A \u2014 Using Your GitHub User","text":""},{"location":"installation/install.html#step-1-become-a-collaborator","title":"Step 1 \u2014 Become a collaborator","text":"<p>Stakater adds your GitHub user to the private enterprise package proxy. You must accept the GitHub invitation.</p>"},{"location":"installation/install.html#step-2-create-a-github-personal-access-token-pat","title":"Step 2 \u2014 Create a GitHub Personal Access Token (PAT)","text":"<p>Create a token with the following scope:</p> <ul> <li><code>read:packages</code></li> </ul>"},{"location":"installation/install.html#step-3-store-the-pat-in-kubernetes","title":"Step 3 \u2014 Store the PAT in Kubernetes","text":"<pre><code>kubectl create secret docker-registry regcred \\\n  --docker-server=ghcr.io \\\n  --docker-username=&lt;github-username&gt; \\\n  --docker-password=&lt;github-token&gt;\n</code></pre>"},{"location":"installation/install.html#step-4-install-reloader-enterprise-via-helm","title":"Step 4 \u2014 Install Reloader Enterprise via Helm","text":"<pre><code>helm install stakater/reloader \\\n  --set image.repository=ghcr.io/stakater/reloader-enterprise \\\n  --set image.tag=&lt;version&gt; \\\n  --set \"global.imagePullSecrets[0].name=regcred\" \\\n  --generate-name\n</code></pre>"},{"location":"installation/install.html#installation-method-b-using-a-token-provided-by-stakater","title":"Installation Method B \u2014 Using a Token Provided by Stakater","text":""},{"location":"installation/install.html#step-1-request-a-stakater-issued-token","title":"Step 1 \u2014 Request a Stakater-issued token","text":"<p>This token is tied to the <code>reloader-enterprise</code> GitHub service account.</p>"},{"location":"installation/install.html#step-2-store-the-token-in-kubernetes","title":"Step 2 \u2014 Store the token in Kubernetes","text":"<pre><code>kubectl create secret docker-registry regcred \\\n  --docker-server=ghcr.io \\\n  --docker-username=reloader-enterprise \\\n  --docker-password=&lt;token-from-stakater&gt;\n</code></pre>"},{"location":"installation/install.html#step-3-install-the-enterprise-image-via-helm","title":"Step 3 \u2014 Install the enterprise image via Helm","text":"<pre><code>helm install stakater/reloader \\\n  --set image.repository=ghcr.io/stakater/reloader-enterprise \\\n  --set image.tag=&lt;version&gt; \\\n  --set \"global.imagePullSecrets[0].name=regcred\" \\\n  --generate-name\n</code></pre>"},{"location":"installation/install.html#checking-available-versions","title":"Checking Available Versions","text":"<p>Reloader Enterprise uses the same image tags as the open-source version, but only versions that have passed enterprise-grade validation are published.</p>"},{"location":"installation/install.html#view-versions-in-github-packages","title":"View versions in GitHub Packages","text":"<p>Reloader Enterprise images are hosted in a private GitHub Container Registry (GHCR) repository.</p> <p>Once access is granted, customers can view available versions at:</p> <p><code>ghcr.io/stakater/reloader-enterprise-package-proxy</code></p> <p>\u26a0\ufe0f This repository is private. If you are not logged in to GitHub or your GitHub account does not have access, GitHub will return 404 Not Found. This is expected behavior.</p> <p>If you believe you should have access but cannot view the repository, please contact Stakater support.</p>"},{"location":"installation/install.html#or-via-github-api","title":"Or via GitHub API","text":"<pre><code>curl -L \\\n -H \"Accept: application/vnd.github+json\" \\\n -H \"Authorization: Bearer &lt;token&gt;\" \\\n -H \"X-GitHub-Api-Version: 2022-11-28\" \\\n https://api.github.com/orgs/stakater/packages/container/reloader-enterprise/versions\n</code></pre>"},{"location":"installation/install.html#access-requirements","title":"Access Requirements","text":"<p>Access to the enterprise package repository is granted only to organizations with an active Reloader Enterprise subscription. If the subscription expires, access is automatically revoked.</p>"},{"location":"integrations/index.html","title":"Overview","text":""},{"location":"integrations/index.html#integrations-overview","title":"Integrations Overview","text":"<p>Reloader integrates with a wide range of Kubernetes-native tools for secrets management, certificate automation, and configuration delivery.</p> <p>This section provides an overview of:</p> <ul> <li>How integrations work with Reloader</li> <li>The different support and validation levels</li> <li>Which integrations are validated and supported in Reloader Enterprise</li> <li>What community users can expect</li> </ul> <p>Each integration has its own dedicated section with architecture notes, step-by-step examples, and operational considerations.</p>"},{"location":"integrations/index.html#how-integrations-work-with-reloader","title":"How integrations work with Reloader","text":"<p>Reloader itself is tool-agnostic.</p> <p>It watches Kubernetes resources such as:</p> <ul> <li><code>Secrets</code></li> <li><code>ConfigMaps</code></li> </ul> <p>When these change, Reloader can trigger safe rollouts of supported workloads (e.g. Deployments, StatefulSets, Rollouts), regardless of how those resources were created or updated.</p> <p>Integrations typically follow this flow:</p> <pre><code>External system\n\u2193\nKubernetes Secret / ConfigMap\n\u2193\nReloader detects change\n\u2193\nControlled workload rollout\n</code></pre> <p>Because the integration point is Kubernetes-native, many tools can work with Reloader. The difference lies in validation, guarantees, and support.</p>"},{"location":"integrations/index.html#support-validation-levels","title":"Support &amp; validation levels","text":"<p>Not all integrations are equal in terms of testing, guarantees, and support.</p> <p>To set clear expectations, Reloader uses the following support levels.</p>"},{"location":"integrations/index.html#validated-reloader-enterprise","title":"\ud83d\udfe2 Validated (Reloader Enterprise)","text":"<ul> <li>Continuously tested in CI</li> <li>Documented end-to-end workflows</li> <li>Validated across upgrades</li> <li>Known edge cases handled</li> <li>Covered by commercial support and SLA</li> </ul>"},{"location":"integrations/index.html#community","title":"\ud83d\udfe1 Community","text":"<ul> <li>Known to work in practice</li> <li>Community-contributed or best-effort docs</li> <li>No continuous validation or SLA</li> </ul>"},{"location":"integrations/index.html#experimental","title":"\ud83d\udd35 Experimental","text":"<ul> <li>Early-stage or limited validation</li> <li>Suitable for testing and experimentation</li> <li>Behavior may change between releases</li> </ul> <p>These labels are shown clearly on each integration page.</p>"},{"location":"integrations/index.html#integrations-support-matrix","title":"Integrations support matrix","text":"<p>The table below summarizes the current status of supported integrations.</p> Integration Support level HashiCorp Vault \ud83d\udfe2 Validated (Reloader Enterprise) OpenBao \ud83d\udfe2 Validated (Reloader Enterprise) Conjur \ud83d\udfe2 Validated (Reloader Enterprise) External Secrets Operator \ud83d\udfe1 Community Cert-Manager \ud83d\udfe1 Community Sealed Secrets \ud83d\udfe1 Community Secrets Store CSI Driver \ud83d\udfe1 Community <p>Community usage is possible for most integrations, but only integrations marked as \u201cValidated\u201d are continuously tested and supported.</p>"},{"location":"integrations/index.html#what-validated-means-in-practice","title":"What \u201cvalidated\u201d means in practice","text":"<p>For integrations marked as Validated (Reloader Enterprise), Stakater continuously verifies:</p> <ul> <li>Reload behavior under frequent secret rotation</li> <li>Compatibility with supported Kubernetes versions</li> <li>Interaction with GitOps workflows (e.g. Argo CD)</li> <li>Rollout safety and failure handling</li> <li>RBAC and security boundaries</li> <li>Upgrade and rollback scenarios</li> </ul> <p>This reduces operational risk for platform teams running Reloader in production-critical environments.</p>"},{"location":"integrations/conjur/index.html","title":"Overview","text":""},{"location":"integrations/conjur/index.html#conjur-integration","title":"Conjur Integration","text":"<p>\ud83d\udfe2 Support level This integration is validated and supported in Reloader Enterprise. Community usage is possible, but without continuous validation or SLA</p> <p>This guide shows how to automatically restart Kubernetes workloads when CyberArk Conjur secrets change using Stakater Reloader.</p>"},{"location":"integrations/conjur/index.html#integration-patterns","title":"Integration Patterns","text":"Pattern How Secrets Arrive Rotation Reloader Compatibility Guide External Secrets Operator ESO syncs to K8s Secret ESO refresh interval Best fit ESO Guide Sidecar Sidecar updates K8s Secret Sidecar refresh interval Best fit Sidecar Guide CSI Driver CSI mounts files + syncs to K8s Secret CSI rotation interval Works with <code>secretObjects</code> CSI Guide"},{"location":"integrations/conjur/index.html#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Golden ConfigMap Architecture                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502  Cluster Level (conjur namespace):                                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  conjur-config-cluster-prep (Helm Chart)                               \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                  \u2502 \u2502\n\u2502  \u2502  \u2502 Golden ConfigMap \u2502  Contains: CONJUR_ACCOUNT, CONJUR_APPLIANCE_URL, \u2502 \u2502\n\u2502  \u2502  \u2502 (conjur-configmap)\u2502           CONJUR_SSL_CERTIFICATE, etc.          \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502  Application Namespace:                                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  conjur-config-namespace-prep (Helm Chart)                             \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                  \u2502 \u2502\n\u2502  \u2502  \u2502 conjur-connect   \u2502  Copies connection info from Golden ConfigMap    \u2502 \u2502\n\u2502  \u2502  \u2502 ConfigMap        \u2502                                                  \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                  \u2502 \u2502\n\u2502  \u2502           \u2502                                                            \u2502 \u2502\n\u2502  \u2502           \u25bc                                                            \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502\n\u2502  \u2502  \u2502                    Application Pod                                \u2502 \u2502 \u2502\n\u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502\n\u2502  \u2502  \u2502  \u2502 App         \u2502         \u2502 Secrets Provider Sidecar           \u2502 \u2502 \u2502 \u2502\n\u2502  \u2502  \u2502  \u2502 Container   \u2502         \u2502 - Reads from conjur-connect        \u2502 \u2502 \u2502 \u2502\n\u2502  \u2502  \u2502  \u2502             \u2502         \u2502 - Authenticates via JWT            \u2502 \u2502 \u2502 \u2502\n\u2502  \u2502  \u2502  \u2502             \u2502         \u2502 - Syncs secrets to K8s Secret      \u2502 \u2502 \u2502 \u2502\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/conjur/index.html#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes cluster (v1.19+)</li> <li>Helm v3+</li> <li>Conjur OSS or Enterprise</li> <li>Conjur CLI installed locally</li> <li>Stakater Reloader installed</li> <li>kubectl configured with cluster access</li> </ul>"},{"location":"integrations/conjur/index.html#install-stakater-reloader","title":"Install Stakater Reloader","text":"<pre><code>helm repo add stakater https://stakater.github.io/stakater-charts\nhelm install reloader stakater/reloader --namespace reloader --create-namespace\n</code></pre>"},{"location":"integrations/conjur/index.html#common-setup-steps","title":"Common Setup Steps","text":""},{"location":"integrations/conjur/index.html#step-1-install-conjur-oss","title":"Step 1: Install Conjur OSS","text":"<pre><code># Add CyberArk Helm repo\nhelm repo add cyberark https://cyberark.github.io/helm-charts\nhelm repo update\n\n# Create namespace\nkubectl create namespace conjur\n\n# Generate data key\nDATA_KEY=$(docker run --rm cyberark/conjur data-key generate)\n\n# Install Conjur with authn-jwt enabled\nhelm install conjur cyberark/conjur-oss -n conjur \\\n  --set account.name=myaccount \\\n  --set account.create=true \\\n  --set dataKey=\"$DATA_KEY\" \\\n  --set authenticators=\"authn\\,authn-jwt/dev\" \\\n  --set ssl.hostname=conjur-conjur-oss.conjur.svc.cluster.local \\\n  --wait --timeout 60s\n</code></pre>"},{"location":"integrations/conjur/index.html#step-2-configure-conjur-cli","title":"Step 2: Configure Conjur CLI","text":"<pre><code># Get admin API key\nADMIN_API_KEY=$(kubectl exec -n conjur deployment/conjur-conjur-oss -c conjur-oss -- \\\n  conjurctl role retrieve-key myaccount:user:admin)\n\n# Get the Conjur SSL certificate\nkubectl get secret -n conjur conjur-conjur-ssl-cert \\\n  -o jsonpath='{.data.tls\\.crt}' | base64 -d &gt; conjur.pem\n\n# Initialize Conjur CLI (assumes Conjur is accessible via port-forward or ingress)\n# Option 1: Port-forward for local access\nkubectl port-forward -n conjur svc/conjur-conjur-oss 8443:443 &amp;\n\n# Initialize and login\nconjur init \\\n  --url https://localhost:8443 \\\n  --account myaccount \\\n  --ca-cert conjur.pem \\\n  --force\n\nconjur login -i admin -p $ADMIN_API_KEY\n</code></pre>"},{"location":"integrations/conjur/index.html#step-3-install-golden-configmap-cluster-prep","title":"Step 3: Install Golden ConfigMap (Cluster Prep)","text":"<pre><code>CONJUR_SSL_CERT=$(kubectl get secret -n conjur conjur-conjur-ssl-cert \\\n  -o jsonpath='{.data.tls\\.crt}' | base64 -d)\n\nhelm install conjur-config-cluster cyberark/conjur-config-cluster-prep -n conjur \\\n  --set conjur.account=myaccount \\\n  --set conjur.applianceUrl=\"https://conjur-conjur-oss.conjur.svc.cluster.local\" \\\n  --set conjur.certificateBase64=\"$(echo -n \"$CONJUR_SSL_CERT\" | base64 -w0)\" \\\n  --set authnK8s.authenticatorID=dev \\\n  --set authnK8s.serviceAccount.create=false\n</code></pre>"},{"location":"integrations/conjur/index.html#how-reloader-works","title":"How Reloader Works","text":"<ol> <li>Secret Provider updates K8s Secret - Sidecar/ESO/CSI syncs secrets from Conjur</li> <li>Reloader detects change - Watches for Secret changes via Kubernetes API</li> <li>Pod restart triggered - Rolling restart of pods referencing the changed Secret</li> </ol>"},{"location":"integrations/conjur/index.html#reloader-annotations","title":"Reloader Annotations","text":"<p>On Deployment:</p> <pre><code>metadata:\n  annotations:\n    reloader.stakater.com/search: \"true\"\n</code></pre> <p>On Secret (must be annotation, not label):</p> <pre><code>metadata:\n  annotations:\n    reloader.stakater.com/match: \"true\"\n</code></pre>"},{"location":"integrations/conjur/index.html#pattern-specific-guides","title":"Pattern-Specific Guides","text":"<ul> <li>Sidecar Pattern</li> <li>CSI Driver Pattern</li> <li>ESO Pattern</li> </ul>"},{"location":"integrations/conjur/index.html#references","title":"References","text":"<ul> <li>Stakater Reloader</li> <li>CyberArk Conjur Documentation</li> <li>Conjur CLI Installation</li> <li>Conjur Config Cluster Prep</li> <li>Conjur Config Namespace Prep</li> </ul>"},{"location":"integrations/conjur/conjur-csi.html","title":"CSI Driver","text":""},{"location":"integrations/conjur/conjur-csi.html#how-to-use-reloader-with-conjur-csi-driver-pattern","title":"How to Use Reloader with Conjur CSI Driver Pattern","text":"<p>This guide explains how to set up CyberArk Conjur with the Secrets Store CSI Driver using JWT-based authentication (<code>authn-jwt</code>), combined with Stakater Reloader for automatic pod restarts when secrets change.</p>"},{"location":"integrations/conjur/conjur-csi.html#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           Kubernetes Cluster                                 \u2502\n\u2502                                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                         Application Pod                                 \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 \u2502\n\u2502  \u2502  \u2502  App Container                                                   \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502                                                                  \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - Reads secrets from env vars (K8s Secret)                     \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - Optionally reads secrets from mounted files                  \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502                                                                  \u2502   \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502 \u2502\n\u2502  \u2502                              \u2502                                          \u2502 \u2502\n\u2502  \u2502                              \u25bc                                          \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 \u2502\n\u2502  \u2502  \u2502  CSI Volume Mount (/mnt/secrets)                                \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - username.txt                                                  \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - password.txt                                                  \u2502   \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502            \u25bc                         \u25bc                         \u25bc            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n\u2502  \u2502  Conjur CSI      \u2502    \u2502   K8s Secret     \u2502    \u2502  Stakater        \u2502      \u2502\n\u2502  \u2502  Provider        \u2502\u2500\u2500\u2500\u25ba\u2502   (app-secrets)  \u2502\u2500\u2500\u2500\u25ba\u2502  Reloader        \u2502      \u2502\n\u2502  \u2502                  \u2502    \u2502                  \u2502    \u2502                  \u2502      \u2502\n\u2502  \u2502  - Authenticates \u2502    \u2502  annotation:     \u2502    \u2502  Watches secret  \u2502      \u2502\n\u2502  \u2502    via JWT       \u2502    \u2502  reloader.../    \u2502    \u2502  changes and     \u2502      \u2502\n\u2502  \u2502  - Fetches from  \u2502    \u2502  match: \"true\"   \u2502    \u2502  restarts pods   \u2502      \u2502\n\u2502  \u2502    Conjur        \u2502    \u2502                  \u2502    \u2502                  \u2502      \u2502\n\u2502  \u2502  - Syncs via     \u2502    \u2502  (secretObjects) \u2502    \u2502                  \u2502      \u2502\n\u2502  \u2502    secretObjects \u2502    \u2502                  \u2502    \u2502                  \u2502      \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\n\u2502            \u2502                                                                 \u2502\n\u2502            \u25bc                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                       \u2502\n\u2502  \u2502    Conjur        \u2502                                                       \u2502\n\u2502  \u2502    Server        \u2502                                                       \u2502\n\u2502  \u2502                  \u2502                                                       \u2502\n\u2502  \u2502  Stores secrets  \u2502                                                       \u2502\n\u2502  \u2502  Validates JWT   \u2502                                                       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#prerequisites","title":"Prerequisites","text":"<p>Complete the common setup steps from the Overview:</p> <ul> <li>Conjur OSS installed</li> <li>Conjur CLI configured</li> <li>Golden ConfigMap (cluster-prep) installed</li> </ul> <p>Additionally required:</p> <ul> <li>Secrets Store CSI Driver installed with <code>syncSecret.enabled=true</code></li> <li>CyberArk Conjur CSI Provider installed</li> </ul>"},{"location":"integrations/conjur/conjur-csi.html#install-secrets-store-csi-driver","title":"Install Secrets Store CSI Driver","text":"<pre><code>helm repo add secrets-store-csi-driver https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts\nhelm install csi-secrets-store secrets-store-csi-driver/secrets-store-csi-driver \\\n  --namespace kube-system \\\n  --set syncSecret.enabled=true \\\n  --set enableSecretRotation=true \\\n  --set rotationPollInterval=30s \\\n  --set tokenRequests[0].audience=\"conjur\"\n</code></pre> <p>Important: The <code>tokenRequests[0].audience=\"conjur\"</code> is required for JWT authentication with Conjur CSI Provider.</p>"},{"location":"integrations/conjur/conjur-csi.html#install-conjur-csi-provider","title":"Install Conjur CSI Provider","text":"<pre><code>helm repo add cyberark https://cyberark.github.io/helm-charts\nhelm install conjur-csi-provider cyberark/conjur-k8s-csi-provider \\\n  --namespace kube-system\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#step-1-load-conjur-policies","title":"Step 1: Load Conjur Policies","text":"<p>Create <code>conjur-policy.yaml</code>:</p> <pre><code># JWT Authenticator Configuration\n- !policy\n  id: conjur/authn-jwt/dev\n  body:\n    - !webservice\n    - !group apps\n    - !permit\n      role: !group apps\n      privilege: [ read, authenticate ]\n      resource: !webservice\n    # Use public-keys instead of jwks-uri\n    - !variable public-keys\n    - !variable issuer\n    - !variable token-app-property\n    - !variable identity-path\n    - !variable audience\n\n# Application Secrets\n- !policy\n  id: secrets\n  body:\n    - !group consumers\n    - &amp;variables\n      - !variable username\n      - !variable password\n    - !permit\n      role: !group consumers\n      privilege: [ read, execute ]\n      resource: *variables\n\n# Host Identity for CSI test app\n- !policy\n  id: jwt-apps\n  body:\n    - !host\n      id: system:serviceaccount:csi-test-app:csi-test-app-sa\n      annotations:\n        authn-jwt/dev/sub: system:serviceaccount:csi-test-app:csi-test-app-sa\n\n# Grant Host to JWT Authenticator Group\n- !grant\n  role: !group conjur/authn-jwt/dev/apps\n  member: !host jwt-apps/system:serviceaccount:csi-test-app:csi-test-app-sa\n\n# Grant Host Access to Secrets\n- !grant\n  role: !group secrets/consumers\n  member: !host jwt-apps/system:serviceaccount:csi-test-app:csi-test-app-sa\n</code></pre> <p>Load the policy:</p> <pre><code>conjur policy load -b root -f conjur-policy.yaml\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#step-2-configure-jwt-authenticator-variables","title":"Step 2: Configure JWT Authenticator Variables","text":"<p>Important: Use <code>public-keys</code> instead of <code>jwks-uri</code>. The <code>jwks-uri</code> approach fails because Conjur cannot reach the Kubernetes API server due to SSL certificate issues.</p> <p>Important: For CSI Provider, the audience must be <code>\"conjur\"</code> (not the Conjur URL).</p> <p>Note: Using <code>jq</code> to format the public-keys JSON ensures proper quoting. Malformed JSON (missing quotes around keys) will cause JWT authentication to fail with 401 errors.</p> <pre><code># Get Kubernetes JWKS public keys and format as proper JSON\nkubectl get --raw /openid/v1/jwks &gt; /tmp/jwks.json\njq -n --slurpfile jwks /tmp/jwks.json '{\"type\":\"jwks\",\"value\":$jwks[0]}' &gt; /tmp/public-keys.json\n\n# Set public-keys from file (ensures proper JSON formatting)\nconjur variable set -i conjur/authn-jwt/dev/public-keys -v \"$(cat /tmp/public-keys.json)\"\n\n# Set issuer\nconjur variable set -i conjur/authn-jwt/dev/issuer \\\n  -v \"https://kubernetes.default.svc.cluster.local\"\n\n# Set token-app-property\nconjur variable set -i conjur/authn-jwt/dev/token-app-property -v \"sub\"\n\n# Set identity-path\nconjur variable set -i conjur/authn-jwt/dev/identity-path -v \"jwt-apps\"\n\n# Set audience - MUST be \"conjur\" for CSI Provider\nconjur variable set -i conjur/authn-jwt/dev/audience -v \"conjur\"\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#step-3-set-application-secrets","title":"Step 3: Set Application Secrets","text":"<pre><code>conjur variable set -i secrets/username -v \"admin-user\"\n\nconjur variable set -i secrets/password -v \"super-secret-password\"\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#step-4-create-application-namespace","title":"Step 4: Create Application Namespace","text":"<pre><code>kubectl create namespace csi-test-app\nkubectl create serviceaccount csi-test-app-sa -n csi-test-app\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#step-5-install-namespace-prep","title":"Step 5: Install Namespace Prep","text":"<pre><code>helm install conjur-config-namespace-prep cyberark/conjur-config-namespace-prep \\\n  --namespace csi-test-app \\\n  --set authnK8s.goldenConfigMap=\"conjur-configmap\" \\\n  --set authnK8s.namespace=\"conjur\"\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#step-6-create-secretproviderclass","title":"Step 6: Create SecretProviderClass","text":"<p>Create <code>secret-provider-class.yaml</code>:</p> <pre><code>apiVersion: secrets-store.csi.x-k8s.io/v1\nkind: SecretProviderClass\nmetadata:\n  name: conjur-secrets\n  namespace: csi-test-app\nspec:\n  provider: conjur\n  # Sync to Kubernetes Secret - Required for Reloader integration\n  secretObjects:\n    - secretName: app-secrets\n      type: Opaque\n      annotations:\n        reloader.stakater.com/match: \"true\"\n      data:\n        - key: username\n          objectName: username.txt\n        - key: password\n          objectName: password.txt\n  parameters:\n    # IMPORTANT: Use version 0.2.0 - secrets mapping is done via pod annotations\n    conjur.org/configurationVersion: \"0.2.0\"\n    account: myaccount\n    applianceUrl: \"https://conjur-conjur-oss.conjur.svc.cluster.local\"\n    authnId: authn-jwt/dev\n    # Get SSL certificate from conjur-connect configmap\n    sslCertificate: |\n      -----BEGIN CERTIFICATE-----\n      &lt;your-conjur-ssl-certificate-here&gt;\n      -----END CERTIFICATE-----\n</code></pre> <p>Note: Get the SSL certificate from:</p> <pre><code>kubectl get configmap conjur-connect -n csi-test-app -o jsonpath='{.data.CONJUR_SSL_CERTIFICATE}'\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f secret-provider-class.yaml\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#step-7-deploy-application","title":"Step 7: Deploy Application","text":"<p>Create <code>deployment.yaml</code>:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: csi-test-app\n  namespace: csi-test-app\n  annotations:\n    reloader.stakater.com/search: \"true\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: csi-test-app\n  template:\n    metadata:\n      labels:\n        app: csi-test-app\n      annotations:\n        # REQUIRED: Map Conjur secrets to files in the CSI volume\n        # Format: - &lt;filename&gt;: &lt;conjur-variable-path&gt;\n        conjur.org/secrets: |\n          - username.txt: secrets/username\n          - password.txt: secrets/password\n    spec:\n      serviceAccountName: csi-test-app-sa\n      containers:\n        - name: app\n          image: busybox:latest\n          command:\n            - \"sh\"\n            - \"-c\"\n            - |\n              while true; do\n                echo \"Username: $APP_USERNAME\"\n                echo \"Password: $APP_PASSWORD\"\n                sleep 30\n              done\n          # Reference secrets from K8s Secret (required for Reloader)\n          env:\n            - name: APP_USERNAME\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: username\n            - name: APP_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: password\n          # CSI volume mount required to trigger secret sync\n          volumeMounts:\n            - name: conjur-secrets\n              mountPath: /mnt/secrets\n              readOnly: true\n      volumes:\n        - name: conjur-secrets\n          csi:\n            driver: secrets-store.csi.k8s.io\n            readOnly: true\n            volumeAttributes:\n              secretProviderClass: conjur-secrets\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f deployment.yaml\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#step-8-verify-the-setup","title":"Step 8: Verify the Setup","text":""},{"location":"integrations/conjur/conjur-csi.html#check-pod-status","title":"Check Pod Status","text":"<pre><code>kubectl get pods -n csi-test-app\n</code></pre> <p>Pod should be Running.</p>"},{"location":"integrations/conjur/conjur-csi.html#check-secretproviderclasspodstatus","title":"Check SecretProviderClassPodStatus","text":"<pre><code>kubectl get secretproviderclasspodstatuses -n csi-test-app\n</code></pre> <p>Verify <code>mounted: true</code> in the status.</p>"},{"location":"integrations/conjur/conjur-csi.html#verify-secrets-are-populated","title":"Verify Secrets are Populated","text":"<pre><code># Check K8s Secret was created\nkubectl get secret app-secrets -n csi-test-app -o jsonpath='{.data.password}' | base64 -d\n\n# Check app logs\nkubectl logs -n csi-test-app -l app=csi-test-app\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#step-9-test-secret-rotation","title":"Step 9: Test Secret Rotation","text":""},{"location":"integrations/conjur/conjur-csi.html#update-secret-in-conjur","title":"Update Secret in Conjur","text":"<pre><code>conjur variable set -i secrets/password -v \"new-rotated-password\"\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#wait-and-verify","title":"Wait and Verify","text":"<p>Wait 30-60 seconds for CSI rotation and Reloader restart:</p> <pre><code># Check secret was updated\nkubectl get secret app-secrets -n csi-test-app -o jsonpath='{.data.password}' | base64 -d\n\n# Check pod was restarted (new pod name)\nkubectl get pods -n csi-test-app -l app=csi-test-app\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#key-configuration-points","title":"Key Configuration Points","text":""},{"location":"integrations/conjur/conjur-csi.html#secretproviderclass-configuration-v020","title":"SecretProviderClass Configuration (v0.2.0)","text":"Field Description <code>conjur.org/configurationVersion</code> Must be <code>\"0.2.0\"</code> for pod annotation-based secrets mapping <code>account</code> Conjur account name <code>applianceUrl</code> Conjur server URL <code>authnId</code> JWT authenticator ID (e.g., <code>authn-jwt/dev</code>) <code>sslCertificate</code> Conjur SSL certificate (PEM format) <p>Note: In v0.2.0, the <code>identity</code> field is NOT used. Identity is derived from the JWT token automatically.</p>"},{"location":"integrations/conjur/conjur-csi.html#pod-annotations","title":"Pod Annotations","text":"<p>The pod must have the <code>conjur.org/secrets</code> annotation to map Conjur variables to files:</p> <pre><code>annotations:\n  conjur.org/secrets: |\n    - username.txt: secrets/username\n    - password.txt: secrets/password\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#secretobjects-configuration","title":"<code>secretObjects</code> Configuration","text":"<p>The <code>secretObjects</code> field syncs mounted secrets to a Kubernetes Secret:</p> <pre><code>secretObjects:\n  - secretName: app-secrets\n    type: Opaque\n    annotations:\n      reloader.stakater.com/match: \"true\"\n    data:\n      - key: username\n        objectName: username.txt  # Must match filename in conjur.org/secrets\n      - key: password\n        objectName: password.txt\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#csi-driver-token-configuration","title":"CSI Driver Token Configuration","text":"<p>The CSI Driver must be installed with <code>tokenRequests</code> for JWT authentication:</p> <pre><code>helm install csi-secrets-store ... \\\n  --set tokenRequests[0].audience=\"conjur\"\n</code></pre>"},{"location":"integrations/conjur/conjur-csi.html#reloader-annotations","title":"Reloader Annotations","text":"Resource Annotation Deployment <code>reloader.stakater.com/search: \"true\"</code> Secret <code>reloader.stakater.com/match: \"true\"</code> (via <code>secretObjects</code>)"},{"location":"integrations/conjur/conjur-csi.html#why-csi-volume-mount-is-required","title":"Why CSI Volume Mount is Required","text":"<p>Even if your app only uses environment variables from the K8s Secret, the CSI volume must be mounted because:</p> <ol> <li>The CSI driver only syncs secrets when a pod mounts the volume</li> <li>Without the mount, the K8s Secret (<code>secretObjects</code>) won't be created</li> </ol>"},{"location":"integrations/conjur/conjur-eso.html","title":"External Secrets Operator","text":""},{"location":"integrations/conjur/conjur-eso.html#how-to-use-reloader-with-conjur-external-secrets-operator-pattern","title":"How to Use Reloader with Conjur External Secrets Operator Pattern","text":"<p>This guide explains how to set up CyberArk Conjur with the External Secrets Operator (ESO), combined with Stakater Reloader for automatic pod restarts when secrets change.</p>"},{"location":"integrations/conjur/conjur-eso.html#authentication-options","title":"Authentication Options","text":"<p>ESO supports two authentication methods with Conjur:</p> Method Description Use Case API Key Uses a Conjur host ID and API key stored in a K8s Secret Simpler setup, good for development JWT Uses Kubernetes ServiceAccount tokens for authentication More secure, no static credentials, recommended for production <p>Choose the authentication method that best fits your security requirements and proceed to the corresponding section.</p>"},{"location":"integrations/conjur/conjur-eso.html#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           Kubernetes Cluster                                 \u2502\n\u2502                                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                    External Secrets Operator                            \u2502 \u2502\n\u2502  \u2502                                                                         \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502 \u2502\n\u2502  \u2502  \u2502  SecretStore    \u2502         \u2502  ExternalSecret                      \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502         \u2502                                      \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  - Conjur URL   \u2502         \u2502  - refreshInterval: 30s              \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  - Auth Method  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  - Maps Conjur vars to K8s Secret    \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  - CA Bundle    \u2502         \u2502  - Adds Reloader annotation          \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502         \u2502                                      \u2502  \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502   K8s Secret     \u2502    \u2502  Stakater        \u2502    \u2502  Application     \u2502       \u2502\n\u2502  \u2502   (app-secrets)  \u2502\u2500\u2500\u2500\u25ba\u2502  Reloader        \u2502\u2500\u2500\u2500\u25ba\u2502  Pod             \u2502       \u2502\n\u2502  \u2502                  \u2502    \u2502                  \u2502    \u2502                  \u2502       \u2502\n\u2502  \u2502  annotation:     \u2502    \u2502  Watches secret  \u2502    \u2502  Reads secrets   \u2502       \u2502\n\u2502  \u2502  reloader.../    \u2502    \u2502  changes and     \u2502    \u2502  from env vars   \u2502       \u2502\n\u2502  \u2502  match: \"true\"   \u2502    \u2502  restarts pods   \u2502    \u2502                  \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502            \u25b2                                                                 \u2502\n\u2502            \u2502                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                       \u2502\n\u2502  \u2502    Conjur        \u2502                                                       \u2502\n\u2502  \u2502    Server        \u2502                                                       \u2502\n\u2502  \u2502                  \u2502                                                       \u2502\n\u2502  \u2502  Stores secrets  \u2502                                                       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#prerequisites","title":"Prerequisites","text":"<p>Complete the common setup steps from the Overview:</p> <ul> <li>Conjur OSS installed</li> <li>Conjur CLI configured</li> <li>Stakater Reloader installed</li> </ul> <p>Additionally required:</p> <ul> <li>External Secrets Operator installed</li> </ul>"},{"location":"integrations/conjur/conjur-eso.html#install-external-secrets-operator","title":"Install External Secrets Operator","text":"<pre><code>helm repo add external-secrets https://charts.external-secrets.io\nhelm repo update\nhelm install external-secrets external-secrets/external-secrets \\\n  --namespace external-secrets \\\n  --create-namespace \\\n  --wait\n</code></pre> <p>Verify installation:</p> <pre><code>kubectl get pods -n external-secrets\n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#option-1-api-key-authentication","title":"Option 1: API Key Authentication","text":"<p>This section covers setting up ESO with API key authentication. This method stores a Conjur host ID and API key in a Kubernetes Secret.</p>"},{"location":"integrations/conjur/conjur-eso.html#api-key-step-1-load-conjur-policy","title":"API Key: Step 1 - Load Conjur Policy","text":"<p>Create <code>conjur-policy.yaml</code>:</p> <pre><code># Conjur Policy for External Secrets Operator (API Key Authentication)\n\n# Application Secrets\n- !policy\n  id: secrets\n  body:\n    - !group consumers\n    - &amp;variables\n      - !variable username\n      - !variable password\n    - !permit\n      role: !group consumers\n      privilege: [ read, execute ]\n      resource: *variables\n\n# Host Identity for External Secrets Operator\n- !policy\n  id: apps\n  body:\n    - !host external-secrets\n\n# Grant Host Access to Secrets\n- !grant\n  role: !group secrets/consumers\n  member: !host apps/external-secrets\n</code></pre> <p>Load the policy and capture the API key:</p> <pre><code>conjur policy load -b root -f conjur-policy.yaml\n</code></pre> <p>Important: Save the <code>api_key</code> from the output. You'll need it later.</p> <p>Example output:</p> <pre><code>{\n  \"created_roles\": {\n    \"myaccount:host:apps/external-secrets\": {\n      \"id\": \"myaccount:host:apps/external-secrets\",\n      \"api_key\": \"3d37q6ph0h2ah3wssa983b1n0gsk8v1hv3b2b74vk7ztmg2b9c992\"\n    }\n  },\n  \"version\": 1\n}\n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#api-key-step-2-set-application-secrets","title":"API Key: Step 2 - Set Application Secrets","text":"<pre><code>conjur variable set -i secrets/username -v \"admin-user\"\n\nconjur variable set -i secrets/password -v \"super-secret-password\"\n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#api-key-step-3-create-application-namespace-and-credentials","title":"API Key: Step 3 - Create Application Namespace and Credentials","text":"<pre><code># Create namespace\nkubectl create namespace eso-test-app\n\n# Create Conjur credentials secret for ESO\n# Replace &lt;API_KEY&gt; with the API key from Step 1\nkubectl create secret generic conjur-credentials -n eso-test-app \\\n  --from-literal=hostId=\"host/apps/external-secrets\" \\\n  --from-literal=apikey=\"&lt;API_KEY&gt;\"\n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#api-key-step-4-get-conjur-ca-certificate","title":"API Key: Step 4 - Get Conjur CA Certificate","text":"<p>Note: The <code>caBundle</code> field is only required if Conjur uses a self-signed or private SSL certificate. If Conjur uses a publicly trusted SSL certificate, you can omit the <code>caBundle</code> field from the SecretStore configuration.</p> <pre><code># Get base64-encoded CA certificate (only needed for self-signed/private certificates)\nkubectl get secret conjur-conjur-ssl-cert -n conjur -o jsonpath='{.data.tls\\.crt}'\n</code></pre> <p>Save this value for the SecretStore configuration.</p>"},{"location":"integrations/conjur/conjur-eso.html#api-key-step-5-create-secretstore","title":"API Key: Step 5 - Create SecretStore","text":"<p>Create <code>secret-store.yaml</code>:</p> <pre><code>apiVersion: external-secrets.io/v1\nkind: SecretStore\nmetadata:\n  name: conjur-secret-store\n  namespace: eso-test-app\nspec:\n  provider:\n    conjur:\n      url: https://conjur-conjur-oss.conjur.svc.cluster.local\n      # Paste the base64-encoded CA certificate from Step 4\n      caBundle: &lt;BASE64_ENCODED_CA_CERTIFICATE&gt;\n      auth:\n        apikey:\n          account: myaccount\n          userRef:\n            name: conjur-credentials\n            key: hostId\n          apiKeyRef:\n            name: conjur-credentials\n            key: apikey\n</code></pre> <p>Apply and verify:</p> <pre><code>kubectl apply -f secret-store.yaml\nkubectl get secretstore -n eso-test-app\n</code></pre> <p>Should show <code>STATUS: Valid</code> and <code>READY: True</code>.</p> <p>Now proceed to Create ExternalSecret section.</p>"},{"location":"integrations/conjur/conjur-eso.html#option-2-jwt-authentication","title":"Option 2: JWT Authentication","text":"<p>This section covers setting up ESO with JWT authentication. This method uses Kubernetes ServiceAccount tokens to authenticate with Conjur - no static credentials required.</p>"},{"location":"integrations/conjur/conjur-eso.html#jwt-step-1-configure-jwt-authenticator-in-conjur","title":"JWT: Step 1 - Configure JWT Authenticator in Conjur","text":"<p>First, load the Conjur policy that configures the JWT authenticator and creates a host identity.</p> <p>Create <code>conjur-policy.yaml</code>:</p> <pre><code># Conjur Policy for External Secrets Operator (JWT Authentication)\n\n# Application Secrets\n- !policy\n  id: secrets\n  body:\n    - !group consumers\n    - &amp;variables\n      - !variable username\n      - !variable password\n    - !permit\n      role: !group consumers\n      privilege: [ read, execute ]\n      resource: *variables\n\n# JWT Authenticator Configuration for authn-jwt/dev\n- !policy\n  id: conjur/authn-jwt/dev\n  body:\n    - !webservice\n\n    # JWT validation variables\n    - !variable public-keys\n    - !variable issuer\n    - !variable token-app-property\n    - !variable identity-path\n    - !variable audience\n\n    # Group for apps that can authenticate\n    - !group apps\n\n    - !permit\n      role: !group apps\n      privilege: [ authenticate ]\n      resource: !webservice\n\n    - !webservice status\n\n# Host identities for JWT authentication\n# Identity path is 'jwt-apps', so hosts are defined under this policy\n- !policy\n  id: jwt-apps\n  body:\n    # Host for ESO service account\n    # Format: system:serviceaccount:&lt;namespace&gt;:&lt;serviceaccount-name&gt;\n    - !host\n      id: system:serviceaccount:eso-jwt-test:eso-jwt-sa\n      annotations:\n        authn-jwt/dev/sub: system:serviceaccount:eso-jwt-test:eso-jwt-sa\n\n# Grant host to authenticator group\n- !grant\n  role: !group conjur/authn-jwt/dev/apps\n  member: !host jwt-apps/system:serviceaccount:eso-jwt-test:eso-jwt-sa\n\n# Grant access to secrets\n- !grant\n  role: !group secrets/consumers\n  member: !host jwt-apps/system:serviceaccount:eso-jwt-test:eso-jwt-sa\n</code></pre> <p>Load the policy:</p> <pre><code>conjur policy load -b root -f conjur-policy.yaml  \n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#jwt-step-2-configure-jwt-authenticator-variables","title":"JWT: Step 2 - Configure JWT Authenticator Variables","text":"<p>Set the JWT authenticator variables:</p> <pre><code># Get Kubernetes JWKS public keys and format as proper JSON\nkubectl get --raw /openid/v1/jwks &gt; /tmp/jwks.json\njq -n --slurpfile jwks /tmp/jwks.json '{\"type\":\"jwks\",\"value\":$jwks[0]}' &gt; /tmp/public-keys.json\n\n# Set public-keys from file (ensures proper JSON formatting)\nconjur variable set -i conjur/authn-jwt/dev/public-keys -v \"$(cat /tmp/public-keys.json)\"\n\nconjur variable set -i conjur/authn-jwt/dev/issuer -v \"https://kubernetes.default.svc.cluster.local\"\n\nconjur variable set -i conjur/authn-jwt/dev/token-app-property -v \"sub\"\n\nconjur variable set -i conjur/authn-jwt/dev/identity-path -v \"jwt-apps\"\n\nconjur variable set -i conjur/authn-jwt/dev/audience -v \"https://conjur-conjur-oss.conjur.svc.cluster.local\"\n</code></pre> <p>Note: Using <code>jq</code> to format the public-keys JSON ensures proper quoting. Malformed JSON (missing quotes around keys) will cause JWT authentication to fail with 401 errors.</p>"},{"location":"integrations/conjur/conjur-eso.html#jwt-step-3-set-application-secrets","title":"JWT: Step 3 - Set Application Secrets","text":"<pre><code>conjur variable set -i secrets/username -v \"admin-user\"\n\nconjur variable set -i secrets/password -v \"super-secret-password\"\n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#jwt-step-4-create-application-namespace-and-serviceaccount","title":"JWT: Step 4 - Create Application Namespace and ServiceAccount","text":"<pre><code># Create namespace\nkubectl create namespace eso-jwt-test\n\n# Create service account for ESO to use\nkubectl create serviceaccount eso-jwt-sa -n eso-jwt-test\n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#jwt-step-5-get-conjur-ca-certificate","title":"JWT: Step 5 - Get Conjur CA Certificate","text":"<p>Note: The <code>caBundle</code> field is only required if Conjur uses a self-signed or private SSL certificate. If Conjur uses a publicly trusted SSL certificate, you can omit the <code>caBundle</code> field from the SecretStore configuration.</p> <pre><code># Get base64-encoded CA certificate (only needed for self-signed/private certificates)\nkubectl get secret conjur-conjur-ssl-cert -n conjur -o jsonpath='{.data.tls\\.crt}'\n</code></pre> <p>Save this value for the SecretStore configuration.</p>"},{"location":"integrations/conjur/conjur-eso.html#jwt-step-6-create-secretstore-with-jwt-auth","title":"JWT: Step 6 - Create SecretStore with JWT Auth","text":"<p>Create <code>secret-store.yaml</code>:</p> <pre><code>apiVersion: external-secrets.io/v1\nkind: SecretStore\nmetadata:\n  name: conjur-jwt-secret-store\n  namespace: eso-jwt-test\nspec:\n  provider:\n    conjur:\n      url: https://conjur-conjur-oss.conjur.svc.cluster.local\n      # Paste the base64-encoded CA certificate from Step 5\n      caBundle: &lt;BASE64_ENCODED_CA_CERTIFICATE&gt;\n      auth:\n        jwt:\n          account: myaccount\n          serviceID: dev\n          serviceAccountRef:\n            name: eso-jwt-sa\n            audiences:\n              - https://conjur-conjur-oss.conjur.svc.cluster.local\n</code></pre> <p>Apply and verify:</p> <pre><code>kubectl apply -f secret-store.yaml\nkubectl get secretstore -n eso-jwt-test\n</code></pre> <p>Should show <code>STATUS: Valid</code> and <code>READY: True</code>.</p> <p>Now proceed to Create ExternalSecret section.</p>"},{"location":"integrations/conjur/conjur-eso.html#common-configuration","title":"Common Configuration","text":"<p>The following sections apply to both authentication methods. Adjust the namespace name based on your chosen method:</p> <ul> <li>API Key: <code>eso-test-app</code></li> <li>JWT: <code>eso-jwt-test</code></li> </ul>"},{"location":"integrations/conjur/conjur-eso.html#create-externalsecret","title":"Create ExternalSecret","text":"<p>Create <code>external-secret.yaml</code>:</p> <pre><code>apiVersion: external-secrets.io/v1\nkind: ExternalSecret\nmetadata:\n  name: app-secrets\n  namespace: &lt;NAMESPACE&gt;  # eso-test-app or eso-jwt-test\nspec:\n  refreshInterval: 30s\n  secretStoreRef:\n    name: &lt;SECRET_STORE_NAME&gt;  # conjur-secret-store or conjur-jwt-secret-store\n    kind: SecretStore\n  target:\n    name: app-secrets\n    creationPolicy: Owner\n    template:\n      metadata:\n        annotations:\n          # Reloader annotation - triggers restart on workloads with search: \"true\"\n          reloader.stakater.com/match: \"true\"\n  data:\n    - secretKey: username\n      remoteRef:\n        key: secrets/username\n    - secretKey: password\n      remoteRef:\n        key: secrets/password\n</code></pre> <p>Apply and verify:</p> <pre><code>kubectl apply -f external-secret.yaml\nkubectl get externalsecret -n &lt;NAMESPACE&gt;\n</code></pre> <p>Should show <code>STATUS: SecretSynced</code> and <code>READY: True</code>.</p>"},{"location":"integrations/conjur/conjur-eso.html#deploy-application","title":"Deploy Application","text":"<p>Create <code>deployment.yaml</code>:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: eso-test-app\n  namespace: &lt;NAMESPACE&gt;  # eso-test-app or eso-jwt-test\n  annotations:\n    reloader.stakater.com/search: \"true\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: eso-test-app\n  template:\n    metadata:\n      labels:\n        app: eso-test-app\n    spec:\n      containers:\n        - name: app\n          image: busybox:latest\n          command:\n            - \"sh\"\n            - \"-c\"\n            - |\n              while true; do\n                echo \"Username: $APP_USERNAME\"\n                echo \"Password: $APP_PASSWORD\"\n                sleep 30\n              done\n          env:\n            - name: APP_USERNAME\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: username\n            - name: APP_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: password\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f deployment.yaml\n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#verify-the-setup","title":"Verify the Setup","text":"<pre><code># SecretStore\nkubectl get secretstore -n &lt;NAMESPACE&gt;\n\n# ExternalSecret\nkubectl get externalsecret -n &lt;NAMESPACE&gt;\n\n# Secret (created by ESO)\nkubectl get secret app-secrets -n &lt;NAMESPACE&gt;\n\n# Pod\nkubectl get pods -n &lt;NAMESPACE&gt;\n\n# Verify secret contents\nkubectl get secret app-secrets -n &lt;NAMESPACE&gt; -o jsonpath='{.data.password}' | base64 -d\n\n# Check app logs\nkubectl logs -n &lt;NAMESPACE&gt; -l app=eso-test-app\n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#test-secret-rotation","title":"Test Secret Rotation","text":""},{"location":"integrations/conjur/conjur-eso.html#update-secret-in-conjur","title":"Update Secret in Conjur","text":"<pre><code>conjur variable set -i secrets/password -v \"new-rotated-password\"\n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#wait-and-verify","title":"Wait and Verify","text":"<p>Wait 30-60 seconds for ESO refresh and Reloader restart:</p> <pre><code># Check secret was updated\nkubectl get secret app-secrets -n &lt;NAMESPACE&gt; -o jsonpath='{.data.password}' | base64 -d\n\n# Check pod was restarted (new pod name)\nkubectl get pods -n &lt;NAMESPACE&gt; -l app=eso-test-app\n\n# Check app logs show new password\nkubectl logs -n &lt;NAMESPACE&gt; -l app=eso-test-app --tail=5\n</code></pre>"},{"location":"integrations/conjur/conjur-eso.html#configuration-reference","title":"Configuration Reference","text":""},{"location":"integrations/conjur/conjur-eso.html#secretstore-configuration","title":"SecretStore Configuration","text":""},{"location":"integrations/conjur/conjur-eso.html#api-key-authentication","title":"API Key Authentication","text":"Field Description <code>url</code> Conjur server URL <code>caBundle</code> Base64-encoded CA certificate for SSL (optional if using publicly trusted certificate) <code>auth.apikey.account</code> Conjur account name <code>auth.apikey.userRef</code> Reference to K8s secret containing host ID <code>auth.apikey.apiKeyRef</code> Reference to K8s secret containing API key"},{"location":"integrations/conjur/conjur-eso.html#jwt-authentication","title":"JWT Authentication","text":"Field Description <code>url</code> Conjur server URL <code>caBundle</code> Base64-encoded CA certificate for SSL (optional if using publicly trusted certificate) <code>auth.jwt.account</code> Conjur account name <code>auth.jwt.serviceID</code> JWT authenticator service ID (e.g., <code>dev</code> for <code>authn-jwt/dev</code>) <code>auth.jwt.serviceAccountRef.name</code> Kubernetes ServiceAccount name <code>auth.jwt.serviceAccountRef.audiences</code> JWT audience values (should match Conjur's audience variable)"},{"location":"integrations/conjur/conjur-eso.html#jwt-authenticator-variables","title":"JWT Authenticator Variables","text":"Variable Description Example Value <code>public-keys</code> JWKS for token validation <code>{\"type\":\"jwks\",\"value\":{...}}</code> <code>issuer</code> Expected JWT issuer claim <code>https://kubernetes.default.svc.cluster.local</code> <code>token-app-property</code> JWT claim for identity <code>sub</code> <code>identity-path</code> Conjur policy path for hosts <code>jwt-apps</code> <code>audience</code> Expected JWT audience claim Conjur URL"},{"location":"integrations/conjur/conjur-eso.html#externalsecret-configuration","title":"ExternalSecret Configuration","text":"Field Description <code>refreshInterval</code> How often ESO syncs secrets from Conjur (e.g., <code>30s</code>) <code>secretStoreRef</code> Reference to the SecretStore <code>target.name</code> Name of the K8s Secret to create <code>target.template.metadata.annotations</code> Annotations to add to the created Secret <code>data[].secretKey</code> Key name in the K8s Secret <code>data[].remoteRef.key</code> Variable path in Conjur"},{"location":"integrations/conjur/conjur-eso.html#reloader-annotations","title":"Reloader Annotations","text":"Resource Annotation Deployment <code>reloader.stakater.com/search: \"true\"</code> Secret (via ExternalSecret template) <code>reloader.stakater.com/match: \"true\"</code>"},{"location":"integrations/conjur/conjur-eso.html#comparison-api-key-vs-jwt-authentication","title":"Comparison: API Key vs JWT Authentication","text":"Aspect API Key JWT Credentials Static API key stored in K8s Secret Dynamic tokens from ServiceAccount Security Key rotation requires manual update No static secrets, tokens auto-rotate Setup Complexity Simpler Requires JWT authenticator configuration Conjur Policy Host with API key Host with JWT claim annotations Best For Development, simple setups Production, security-conscious environments"},{"location":"integrations/conjur/conjur-sidecar.html","title":"Sidecar","text":""},{"location":"integrations/conjur/conjur-sidecar.html#how-to-use-reloader-with-conjur-jwt-sidecar-pattern","title":"How to Use Reloader with Conjur JWT Sidecar Pattern","text":"<p>This guide explains how to set up CyberArk Conjur with the Secrets Provider sidecar pattern using JWT-based authentication (<code>authn-jwt</code>), combined with Stakater Reloader for automatic pod restarts when secrets change.</p>"},{"location":"integrations/conjur/conjur-sidecar.html#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           Kubernetes Cluster                             \u2502\n\u2502                                                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                         Application Pod                             \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502 \u2502\n\u2502  \u2502  \u2502  App Container  \u2502         \u2502  Secrets Provider Sidecar        \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502         \u2502                                  \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  Reads secrets  \u2502         \u2502  1. Gets projected SA JWT token  \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  from K8s       \u2502         \u2502  2. Authenticates via authn-jwt  \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  Secret         \u2502         \u2502  3. Fetches secrets from Conjur  \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502         \u2502  4. Updates K8s Secret           \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502         \u2502  5. Refreshes every 30s          \u2502  \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                      \u2502                                   \u2502\n\u2502                                      \u25bc                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502   K8s Secret     \u2502    \u2502  Stakater        \u2502    \u2502    Conjur        \u2502   \u2502\n\u2502  \u2502   (app-secrets)  \u2502\u25c4\u2500\u2500\u2500\u2502  Reloader        \u2502    \u2502    Server        \u2502   \u2502\n\u2502  \u2502                  \u2502    \u2502                  \u2502    \u2502                  \u2502   \u2502\n\u2502  \u2502  annotation:     \u2502    \u2502  Watches secret  \u2502    \u2502  Stores secrets  \u2502   \u2502\n\u2502  \u2502  reloader.../    \u2502    \u2502  changes and     \u2502    \u2502  Validates JWT   \u2502   \u2502\n\u2502  \u2502  match: \"true\"   \u2502    \u2502  restarts pods   \u2502    \u2502  tokens          \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#prerequisites","title":"Prerequisites","text":"<p>Complete the common setup steps from the Overview:</p> <ul> <li>Conjur OSS installed</li> <li>Conjur CLI configured</li> <li>Golden ConfigMap (cluster-prep) installed</li> </ul>"},{"location":"integrations/conjur/conjur-sidecar.html#step-1-load-conjur-policies","title":"Step 1: Load Conjur Policies","text":"<p>Create <code>conjur-policy.yaml</code>:</p> <pre><code># JWT Authenticator Configuration\n- !policy\n  id: conjur/authn-jwt/dev\n  body:\n    - !webservice\n    - !group apps\n    - !permit\n      role: !group apps\n      privilege: [ read, authenticate ]\n      resource: !webservice\n    # Use public-keys instead of jwks-uri\n    - !variable public-keys\n    - !variable issuer\n    - !variable token-app-property\n    - !variable identity-path\n    - !variable audience\n\n# Application Secrets\n- !policy\n  id: secrets\n  body:\n    - !group consumers\n    - &amp;variables\n      - !variable username\n      - !variable password\n      - !variable db-url\n    - !permit\n      role: !group consumers\n      privilege: [ read, execute ]\n      resource: *variables\n\n# Host Identity for JWT Authentication\n- !policy\n  id: jwt-apps\n  body:\n    - !host\n      id: system:serviceaccount:jwt-test-app:jwt-test-app-sa\n      annotations:\n        authn-jwt/dev/sub: system:serviceaccount:jwt-test-app:jwt-test-app-sa\n\n# Grant Host to JWT Authenticator Group\n- !grant\n  role: !group conjur/authn-jwt/dev/apps\n  member: !host jwt-apps/system:serviceaccount:jwt-test-app:jwt-test-app-sa\n\n# Grant Host Access to Secrets\n- !grant\n  role: !group secrets/consumers\n  member: !host jwt-apps/system:serviceaccount:jwt-test-app:jwt-test-app-sa\n</code></pre> <p>Load the policy:</p> <pre><code>conjur policy load -b root -f conjur-policy.yaml\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#step-2-configure-jwt-authenticator-variables","title":"Step 2: Configure JWT Authenticator Variables","text":"<p>Important: Use <code>public-keys</code> instead of <code>jwks-uri</code>. The <code>jwks-uri</code> approach fails because Conjur cannot reach the Kubernetes API server due to SSL certificate issues.</p> <p>Note: Using <code>jq</code> to format the public-keys JSON ensures proper quoting. Malformed JSON (missing quotes around keys) will cause JWT authentication to fail with 401 errors.</p> <pre><code># Get Kubernetes JWKS public keys and format as proper JSON\nkubectl get --raw /openid/v1/jwks &gt; /tmp/jwks.json\njq -n --slurpfile jwks /tmp/jwks.json '{\"type\":\"jwks\",\"value\":$jwks[0]}' &gt; /tmp/public-keys.json\n\n# Set public-keys from file (ensures proper JSON formatting)\nconjur variable set -i conjur/authn-jwt/dev/public-keys -v \"$(cat /tmp/public-keys.json)\"\n\n# Set issuer\nconjur variable set -i conjur/authn-jwt/dev/issuer \\\n  -v \"https://kubernetes.default.svc.cluster.local\"\n\n# Set token-app-property\nconjur variable set -i conjur/authn-jwt/dev/token-app-property -v \"sub\"\n\n# Set identity-path\nconjur variable set -i conjur/authn-jwt/dev/identity-path -v \"jwt-apps\"\n\n# Set audience\nconjur variable set -i conjur/authn-jwt/dev/audience \\\n  -v \"https://conjur-conjur-oss.conjur.svc.cluster.local\"\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#step-3-set-application-secrets","title":"Step 3: Set Application Secrets","text":"<pre><code>conjur variable set -i secrets/username -v \"admin-user\"\n\nconjur variable set -i secrets/password -v \"super-secret-password\"\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#step-4-create-application-namespace","title":"Step 4: Create Application Namespace","text":"<pre><code>kubectl create namespace jwt-test-app\nkubectl create serviceaccount jwt-test-app-sa -n jwt-test-app\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#step-5-install-namespace-prep","title":"Step 5: Install Namespace Prep","text":"<pre><code>helm install conjur-config-jwt-test cyberark/conjur-config-namespace-prep -n jwt-test-app \\\n  --set conjur.configMap.namespace=conjur \\\n  --set conjur.configMap.name=conjur-configmap \\\n  --set authnK8s.goldenConfigMap=conjur-configmap \\\n  --set authnK8s.namespace=conjur\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#step-6-create-rbac-for-secrets-provider","title":"Step 6: Create RBAC for Secrets Provider","text":"<p>Create <code>rbac.yaml</code>:</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: secrets-provider-role\n  namespace: jwt-test-app\nrules:\n- apiGroups: [\"\"]\n  resources: [\"secrets\"]\n  verbs: [\"get\", \"update\", \"patch\"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: secrets-provider-rolebinding\n  namespace: jwt-test-app\nsubjects:\n- kind: ServiceAccount\n  name: jwt-test-app-sa\n  namespace: jwt-test-app\nroleRef:\n  kind: Role\n  name: secrets-provider-role\n  apiGroup: rbac.authorization.k8s.io\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f rbac.yaml\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#step-7-deploy-application-with-secrets-provider-sidecar","title":"Step 7: Deploy Application with Secrets Provider Sidecar","text":"<p>Create <code>deployment.yaml</code>:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: jwt-test-app\n  namespace: jwt-test-app\n  annotations:\n    reloader.stakater.com/search: \"true\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: jwt-test-app\n  template:\n    metadata:\n      labels:\n        app: jwt-test-app\n      annotations:\n        # Required for sidecar refresh\n        conjur.org/container-mode: sidecar\n        conjur.org/secrets-refresh-interval: 30s\n    spec:\n      serviceAccountName: jwt-test-app-sa\n      containers:\n      - name: app\n        image: busybox:latest\n        command: [\"sh\", \"-c\", \"while true; do echo \\\"Username: $APP_USERNAME\\\"; echo \\\"Password: $APP_PASSWORD\\\"; sleep 30; done\"]\n        # App must reference the secret for Reloader to trigger restart\n        env:\n        - name: APP_USERNAME\n          valueFrom:\n            secretKeyRef:\n              name: app-secrets\n              key: username\n        - name: APP_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: app-secrets\n              key: password\n\n      - name: conjur-secrets-provider\n        image: cyberark/secrets-provider-for-k8s:1.6.1\n        imagePullPolicy: IfNotPresent\n        env:\n        - name: CONJUR_ACCOUNT\n          valueFrom:\n            configMapKeyRef:\n              name: conjur-connect\n              key: CONJUR_ACCOUNT\n        - name: CONJUR_APPLIANCE_URL\n          valueFrom:\n            configMapKeyRef:\n              name: conjur-connect\n              key: CONJUR_APPLIANCE_URL\n        - name: CONJUR_AUTHN_URL\n          value: \"https://conjur-conjur-oss.conjur.svc.cluster.local/authn-jwt/dev\"\n        - name: CONJUR_SSL_CERTIFICATE\n          valueFrom:\n            configMapKeyRef:\n              name: conjur-connect\n              key: CONJUR_SSL_CERTIFICATE\n        - name: SSL_CERT_FILE\n          value: /etc/ssl/conjur/conjur.pem\n        - name: MY_POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: MY_POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        - name: K8S_SECRETS\n          value: \"app-secrets\"\n        - name: SECRETS_DESTINATION\n          value: \"k8s_secrets\"\n        - name: CONTAINER_MODE\n          value: \"sidecar\"\n        - name: DEBUG\n          value: \"true\"\n        - name: JWT_TOKEN_PATH\n          value: /var/run/secrets/tokens/jwt\n        volumeMounts:\n        - name: conjur-secrets\n          mountPath: /conjur/secrets\n        - name: jwt-token\n          mountPath: /var/run/secrets/tokens\n          readOnly: true\n        - name: conjur-ssl\n          mountPath: /etc/ssl/conjur\n          readOnly: true\n        - name: podinfo\n          mountPath: /conjur/podinfo\n\n      volumes:\n      - name: conjur-secrets\n        emptyDir:\n          medium: Memory\n      - name: jwt-token\n        projected:\n          sources:\n          - serviceAccountToken:\n              path: jwt\n              expirationSeconds: 6000\n              audience: https://conjur-conjur-oss.conjur.svc.cluster.local\n      - name: conjur-ssl\n        configMap:\n          name: conjur-connect\n          items:\n          - key: CONJUR_SSL_CERTIFICATE\n            path: conjur.pem\n      - name: podinfo\n        downwardAPI:\n          defaultMode: 420\n          items:\n          - path: annotations\n            fieldRef:\n              apiVersion: v1\n              fieldPath: metadata.annotations\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: app-secrets\n  namespace: jwt-test-app\n  annotations:\n    reloader.stakater.com/match: \"true\"\ntype: Opaque\nstringData:\n  username: \"\"\n  password: \"\"\n  conjur-map: |\n    username: secrets/username\n    password: secrets/password\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f deployment.yaml\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#step-8-verify-the-setup","title":"Step 8: Verify the Setup","text":""},{"location":"integrations/conjur/conjur-sidecar.html#check-pod-status","title":"Check Pod Status","text":"<pre><code>kubectl get pods -n jwt-test-app\n</code></pre> <p>Both containers should be Running.</p>"},{"location":"integrations/conjur/conjur-sidecar.html#check-sidecar-logs","title":"Check Sidecar Logs","text":"<pre><code>kubectl logs -n jwt-test-app deployment/jwt-test-app -c conjur-secrets-provider\n</code></pre> <p>Look for:</p> <ul> <li><code>CAKC035 Successfully authenticated</code></li> <li><code>CSPFK009I DAP/Conjur Secrets updated in Kubernetes successfully</code></li> </ul>"},{"location":"integrations/conjur/conjur-sidecar.html#verify-secrets-are-populated","title":"Verify Secrets are Populated","text":"<pre><code>kubectl get secret app-secrets -n jwt-test-app -o jsonpath='{.data.password}' | base64 -d\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#step-9-test-secret-rotation","title":"Step 9: Test Secret Rotation","text":""},{"location":"integrations/conjur/conjur-sidecar.html#update-secret-in-conjur","title":"Update Secret in Conjur","text":"<pre><code>conjur variable set -i secrets/password -v \"new-rotated-password\"\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#wait-and-verify","title":"Wait and Verify","text":"<p>Wait 30-60 seconds for sidecar refresh and Reloader restart:</p> <pre><code># Check secret was updated\nkubectl get secret app-secrets -n jwt-test-app -o jsonpath='{.data.password}' | base64 -d\n\n# Check pod was restarted\nkubectl get pods -n jwt-test-app -l app=jwt-test-app\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#key-configuration-points","title":"Key Configuration Points","text":""},{"location":"integrations/conjur/conjur-sidecar.html#jwt-authenticator-variables","title":"JWT Authenticator Variables","text":"Variable Description Value <code>public-keys</code> JWKS for token validation <code>{\"type\":\"jwks\",\"value\":{\"keys\":[...]}}</code> <code>issuer</code> Expected <code>iss</code> claim <code>https://kubernetes.default.svc.cluster.local</code> <code>token-app-property</code> JWT claim for identity <code>sub</code> <code>identity-path</code> Policy path for hosts <code>jwt-apps</code> <code>audience</code> Expected <code>aud</code> claim Conjur URL"},{"location":"integrations/conjur/conjur-sidecar.html#why-public-keys-instead-of-jwks-uri","title":"Why <code>public-keys</code> Instead of <code>jwks-uri</code>?","text":"<p>When using <code>jwks-uri</code>, Conjur tries to fetch JWKS from the Kubernetes API server but fails due to SSL certificate verification issues. With <code>public-keys</code>, we provide the JWKS directly to Conjur.</p>"},{"location":"integrations/conjur/conjur-sidecar.html#required-pod-annotations","title":"Required Pod Annotations","text":"<p>These must be on the Pod template metadata:</p> <pre><code>annotations:\n  conjur.org/container-mode: sidecar\n  conjur.org/secrets-refresh-interval: 30s\n</code></pre>"},{"location":"integrations/conjur/conjur-sidecar.html#required-volumes","title":"Required Volumes","text":"Volume Purpose <code>jwt-token</code> Projected ServiceAccount token with custom audience <code>conjur-ssl</code> SSL certificate for Conjur <code>podinfo</code> DownwardAPI to expose pod annotations to sidecar <code>conjur-secrets</code> emptyDir for sidecar use"},{"location":"integrations/conjur/conjur-sidecar.html#reloader-annotations","title":"Reloader Annotations","text":"Resource Annotation Deployment <code>reloader.stakater.com/search: \"true\"</code> Secret <code>reloader.stakater.com/match: \"true\"</code> (must be annotation, not label)"},{"location":"integrations/openbao/index.html","title":"Overview","text":""},{"location":"integrations/openbao/index.html#openbao-integration","title":"OpenBao Integration","text":"<p> Support level This integration is validated and supported in Reloader Enterprise. Community usage is possible, but without continuous validation or SLA</p> <p>This guide shows how to automatically restart Kubernetes workloads when OpenBao secrets change using Stakater Reloader.</p>"},{"location":"integrations/openbao/index.html#what-is-openbao","title":"What is OpenBao?","text":"<p>OpenBao is an open-source, community-driven fork of HashiCorp Vault, managed by the Linux Foundation. It was created after HashiCorp changed Vault's license from MPL 2.0 to BSL 1.1. OpenBao maintains API compatibility with Vault, making it a drop-in replacement for most use cases.</p>"},{"location":"integrations/openbao/index.html#integration-patterns","title":"Integration Patterns","text":"Pattern How Secrets Arrive Rotation Reloader Compatibility Guide External Secrets Operator ESO syncs to K8s Secret ESO refresh interval Best fit ESO Guide OpenBao Secrets Operator BSO syncs to K8s Secret BSO refresh interval Best fit BSO Guide CSI Driver CSI mounts files + syncs to K8s Secret CSI rotation interval Works with <code>secretObjects</code> CSI Guide CSI Driver (File-Based) CSI mounts files only (no K8s Secret) CSI rotation interval Works via SecretProviderClassPodStatus CSI File Guide"},{"location":"integrations/openbao/index.html#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     OpenBao + Reloader Architecture                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502  OpenBao Server (openbao namespace):                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  OpenBao                                                               \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502 \u2502\n\u2502  \u2502  \u2502 KV v2 Engine     \u2502  \u2502 Kubernetes Auth  \u2502  \u2502 AppRole Auth     \u2502    \u2502 \u2502\n\u2502  \u2502  \u2502 secret/myapp     \u2502  \u2502 (k8s SA tokens)  \u2502  \u2502 (RoleID/SecretID)\u2502    \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502  Application Namespace:                                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  Secret Sync (ESO / BSO / CSI)                                         \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502 \u2502\n\u2502  \u2502  \u2502  Operator CRDs   \u2502\u2500\u2500\u2500\u25ba\u2502  K8s Secret      \u2502                         \u2502 \u2502\n\u2502  \u2502  \u2502  (SecretStore,   \u2502    \u2502  (app-secrets)   \u2502                         \u2502 \u2502\n\u2502  \u2502  \u2502   VaultAuth, etc)\u2502    \u2502  match: \"true\"   \u2502                         \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502 \u2502\n\u2502  \u2502                                   \u2502                                    \u2502 \u2502\n\u2502  \u2502                                   \u25bc                                    \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502 \u2502\n\u2502  \u2502  \u2502 Stakater Reloader\u2502\u2500\u2500\u2500\u25ba\u2502  Application Pod \u2502                         \u2502 \u2502\n\u2502  \u2502  \u2502 Detects change   \u2502    \u2502  Rolling restart  \u2502                         \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/openbao/index.html#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes cluster (v1.19+)</li> <li>Helm v3+</li> <li>OpenBao (OSS)</li> <li>OpenBao CLI (<code>bao</code>) installed locally</li> <li>Stakater Reloader installed</li> <li>kubectl configured with cluster access</li> </ul>"},{"location":"integrations/openbao/index.html#install-stakater-reloader","title":"Install Stakater Reloader","text":"<pre><code>helm repo add stakater https://stakater.github.io/stakater-charts\nhelm install reloader stakater/reloader --namespace reloader --create-namespace\n</code></pre>"},{"location":"integrations/openbao/index.html#common-setup-steps","title":"Common Setup Steps","text":""},{"location":"integrations/openbao/index.html#step-1-install-openbao","title":"Step 1: Install OpenBao","text":"<pre><code># Add OpenBao Helm repo\nhelm repo add openbao https://openbao.github.io/openbao-helm\nhelm repo update\n\n# Install OpenBao\nhelm install openbao openbao/openbao -n openbao --create-namespace \\\n  --set \"server.dataStorage.size=1Gi\" \\\n  --set \"injector.enabled=false\"\n</code></pre> <p>Note: The injector is disabled because this guide uses ESO, BSO, or CSI to sync secrets. Enable it if you also need OpenBao Agent sidecar injection.</p> <p>Wait for the pod to start (it will be Running but not Ready until unsealed):</p> <pre><code>kubectl wait --for=jsonpath='{.status.phase}'=Running pod/openbao-0 -n openbao --timeout=180s\n</code></pre>"},{"location":"integrations/openbao/index.html#step-2-initialize-and-unseal-openbao","title":"Step 2: Initialize and Unseal OpenBao","text":"<pre><code># Initialize OpenBao (using 1 key share for simplicity; use more in production)\nkubectl exec -n openbao openbao-0 -- bao operator init \\\n  -key-shares=1 \\\n  -key-threshold=1 \\\n  -format=json &gt; openbao-init.json\n</code></pre> <p>Important: Save <code>openbao-init.json</code> securely. It contains the unseal key and root token.</p> <pre><code># Extract unseal key and root token\nOPENBAO_UNSEAL_KEY=$(cat openbao-init.json | jq -r '.unseal_keys_b64[0]')\nOPENBAO_ROOT_TOKEN=$(cat openbao-init.json | jq -r '.root_token')\n\n# Unseal OpenBao\nkubectl exec -n openbao openbao-0 -- bao operator unseal \"$OPENBAO_UNSEAL_KEY\"\n</code></pre> <p>OpenBao should now show <code>Sealed: false</code>. Wait for the pod to become Ready:</p> <pre><code>kubectl wait --for=condition=ready pod/openbao-0 -n openbao --timeout=30s\n</code></pre>"},{"location":"integrations/openbao/index.html#step-3-configure-openbao-cli","title":"Step 3: Configure OpenBao CLI","text":"<p>Set up the <code>bao</code> CLI locally:</p> <pre><code># Port-forward for local CLI access\nkubectl port-forward -n openbao svc/openbao 8200:8200 &amp;\n\n# Configure CLI (use the root token from Step 2)\nexport BAO_ADDR=\"http://127.0.0.1:8200\"\nexport BAO_TOKEN=\"$OPENBAO_ROOT_TOKEN\"\n</code></pre> <p>Alternatively, you can run <code>bao</code> commands directly inside the OpenBao pod:</p> <pre><code>kubectl exec -n openbao openbao-0 -- sh -c \"BAO_TOKEN=&lt;token&gt; bao &lt;command&gt;\"\n</code></pre> <p>Note: The remaining steps in this guide use the local CLI. If using the in-pod approach, prefix each <code>bao</code> command with the <code>kubectl exec</code> pattern above.</p>"},{"location":"integrations/openbao/index.html#step-4-enable-kv-v2-secrets-engine","title":"Step 4: Enable KV v2 Secrets Engine","text":"<pre><code>bao secrets enable -path=secret kv-v2\n</code></pre> <p>Verify:</p> <pre><code>bao secrets list\n</code></pre> <p>You should see <code>secret/</code> listed as <code>kv</code> version 2.</p>"},{"location":"integrations/openbao/index.html#step-5-write-test-secrets","title":"Step 5: Write Test Secrets","text":"<pre><code>bao kv put secret/myapp username='admin-user' password='super-secret-password'\n</code></pre> <p>Verify:</p> <pre><code>bao kv get secret/myapp\n</code></pre>"},{"location":"integrations/openbao/index.html#step-6-create-openbao-read-policy","title":"Step 6: Create OpenBao Read Policy","text":"<pre><code>bao policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/openbao/index.html#step-7-enable-kubernetes-auth","title":"Step 7: Enable Kubernetes Auth","text":"<pre><code># Enable Kubernetes auth method\nbao auth enable kubernetes\n\n# Configure Kubernetes auth\nbao write auth/kubernetes/config \\\n  kubernetes_host='https://kubernetes.default.svc.cluster.local'\n</code></pre>"},{"location":"integrations/openbao/index.html#step-8-enable-approle-auth-optional","title":"Step 8: Enable AppRole Auth (Optional)","text":"<p>Only required for the BSO AppRole pattern.</p> <pre><code>bao auth enable approle\n</code></pre>"},{"location":"integrations/openbao/index.html#how-reloader-works","title":"How Reloader Works","text":"<ol> <li>Secret provider updates K8s Secret - ESO/BSO/CSI syncs secrets from OpenBao</li> <li>Reloader detects change - Watches for Secret changes via Kubernetes API</li> <li>Pod restart triggered - Rolling restart of pods referencing the changed Secret</li> </ol>"},{"location":"integrations/openbao/index.html#reloader-annotations","title":"Reloader Annotations","text":"<p>On Deployment (for K8s Secret-based patterns: ESO, BSO, CSI with secretObjects):</p> <pre><code>metadata:\n  annotations:\n    reloader.stakater.com/search: \"true\"\n</code></pre> <p>On Secret (must be annotation, not label):</p> <pre><code>metadata:\n  annotations:\n    reloader.stakater.com/match: \"true\"\n</code></pre> <p>On Deployment (for CSI file-based pattern only):</p> <pre><code>metadata:\n  annotations:\n    secretproviderclass.reloader.stakater.com/reload: \"&lt;secretproviderclass-name&gt;\"\n</code></pre>"},{"location":"integrations/openbao/index.html#pattern-specific-guides","title":"Pattern-Specific Guides","text":"<ul> <li>External Secrets Operator Pattern - Token or Kubernetes auth</li> <li>OpenBao Secrets Operator Pattern - Kubernetes auth or AppRole</li> <li>CSI Driver Pattern - Kubernetes auth (syncs to K8s Secret)</li> <li>CSI Driver File-Based Pattern - Kubernetes auth (file-only, no K8s Secret)</li> </ul>"},{"location":"integrations/openbao/index.html#references","title":"References","text":"<ul> <li>Stakater Reloader</li> <li>OpenBao Documentation</li> <li>OpenBao Helm Chart</li> <li>External Secrets Operator - OpenBao Provider</li> <li>OpenBao Secrets Operator</li> <li>OpenBao CSI Provider</li> </ul>"},{"location":"integrations/openbao/openbao-bso.html","title":"OpenBao Secrets Operator","text":""},{"location":"integrations/openbao/openbao-bso.html#how-to-use-reloader-with-openbao-secrets-operator-pattern","title":"How to Use Reloader with OpenBao Secrets Operator Pattern","text":"<p>This guide explains how to set up OpenBao with the OpenBao Secrets Operator (BSO), combined with Stakater Reloader for automatic pod restarts when secrets change.</p> <p>Note: The OpenBao Secrets Operator uses CRDs with \"Vault\" naming (VaultConnection, VaultAuth, VaultStaticSecret) for API compatibility. This is expected behavior - OpenBao is API-compatible with HashiCorp Vault.</p>"},{"location":"integrations/openbao/openbao-bso.html#authentication-options","title":"Authentication Options","text":"<p>BSO supports multiple authentication methods with OpenBao:</p> Method Description Use Case Kubernetes Auth Uses Kubernetes ServiceAccount tokens for authentication Recommended for production, no static credentials AppRole Uses a RoleID and SecretID pair Good for non-Kubernetes clients or cross-cluster setups <p>Choose the authentication method that best fits your security requirements and proceed to the corresponding section.</p>"},{"location":"integrations/openbao/openbao-bso.html#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           Kubernetes Cluster                                 \u2502\n\u2502                                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                    OpenBao Secrets Operator                             \u2502 \u2502\n\u2502  \u2502                                                                         \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502 \u2502\n\u2502  \u2502  \u2502 VaultConnection \u2502  \u2502 VaultAuth  \u2502  \u2502 VaultStaticSecret          \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502  \u2502            \u2502  \u2502                            \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502 - OpenBao addr  \u2502\u2500\u25ba\u2502 - K8s Auth \u2502\u2500\u25ba\u2502 - mount: secret            \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502  \u2502   or       \u2502  \u2502 - path: myapp              \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502  \u2502 - AppRole  \u2502  \u2502 - refreshAfter: 30s        \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502  \u2502            \u2502  \u2502 - Reloader annotation      \u2502  \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502   K8s Secret     \u2502    \u2502  Stakater        \u2502    \u2502  Application     \u2502       \u2502\n\u2502  \u2502   (app-secrets)  \u2502\u2500\u2500\u2500\u25ba\u2502  Reloader        \u2502\u2500\u2500\u2500\u25ba\u2502  Pod             \u2502       \u2502\n\u2502  \u2502                  \u2502    \u2502                  \u2502    \u2502                  \u2502       \u2502\n\u2502  \u2502  annotation:     \u2502    \u2502  Watches secret  \u2502    \u2502  Reads secrets   \u2502       \u2502\n\u2502  \u2502  reloader.../    \u2502    \u2502  changes and     \u2502    \u2502  from env vars   \u2502       \u2502\n\u2502  \u2502  match: \"true\"   \u2502    \u2502  restarts pods   \u2502    \u2502                  \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502            \u25b2                                                                 \u2502\n\u2502            \u2502                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                       \u2502\n\u2502  \u2502    OpenBao       \u2502                                                       \u2502\n\u2502  \u2502    Server        \u2502                                                       \u2502\n\u2502  \u2502                  \u2502                                                       \u2502\n\u2502  \u2502  KV v2 engine   \u2502                                                       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#prerequisites","title":"Prerequisites","text":"<p>Complete the common setup steps from the Overview:</p> <ul> <li>OpenBao installed, initialized, and unsealed</li> <li>OpenBao CLI configured (<code>BAO_ADDR</code> and <code>BAO_TOKEN</code> exported)</li> <li>KV v2 secrets engine enabled</li> <li>Test secrets written to <code>secret/myapp</code></li> <li>Read policy (<code>myapp-read</code>) created</li> <li>Stakater Reloader installed</li> </ul> <p>Additionally required:</p> <ul> <li>OpenBao Secrets Operator installed</li> </ul> <p>Note: All <code>bao</code> commands below assume <code>BAO_ADDR</code> and <code>BAO_TOKEN</code> are set from Overview Step 3.</p>"},{"location":"integrations/openbao/openbao-bso.html#install-openbao-secrets-operator","title":"Install OpenBao Secrets Operator","text":"<pre><code>kubectl apply -k \"https://github.com/openbao/openbao-secrets-operator//config/default?ref=main\"\n</code></pre> <p>Verify installation:</p> <pre><code>kubectl get pods -n vault-secrets-operator-system\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#option-1-kubernetes-authentication","title":"Option 1: Kubernetes Authentication","text":"<p>This section covers setting up BSO with OpenBao Kubernetes authentication. This method uses Kubernetes ServiceAccount tokens to authenticate with OpenBao.</p>"},{"location":"integrations/openbao/openbao-bso.html#k8s-auth-step-1-create-openbao-policy","title":"K8s Auth: Step 1 - Create OpenBao Policy","text":"<pre><code>bao policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#k8s-auth-step-2-enable-and-configure-kubernetes-auth","title":"K8s Auth: Step 2 - Enable and Configure Kubernetes Auth","text":"<pre><code># Enable Kubernetes auth method (skip if already enabled)\nbao auth enable kubernetes\n\n# Configure Kubernetes auth\nbao write auth/kubernetes/config \\\n  kubernetes_host='https://kubernetes.default.svc.cluster.local'\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#k8s-auth-step-3-create-openbao-role","title":"K8s Auth: Step 3 - Create OpenBao Role","text":"<pre><code>bao write auth/kubernetes/role/bso-role \\\n  bound_service_account_names=openbao-bso-sa \\\n  bound_service_account_namespaces=openbao-bso-test \\\n  policies=myapp-read \\\n  ttl=1h\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#k8s-auth-step-4-write-secrets","title":"K8s Auth: Step 4 - Write Secrets","text":"<pre><code>bao kv put secret/myapp username='admin-user' password='super-secret-password'\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#k8s-auth-step-5-create-application-namespace-and-serviceaccount","title":"K8s Auth: Step 5 - Create Application Namespace and ServiceAccount","text":"<pre><code># Create namespace\nkubectl create namespace openbao-bso-test\n\n# Create service account\nkubectl create serviceaccount openbao-bso-sa -n openbao-bso-test\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#k8s-auth-step-6-create-vaultconnection","title":"K8s Auth: Step 6 - Create VaultConnection","text":"<p>Create <code>vault-connection.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultConnection\nmetadata:\n  name: openbao-connection\n  namespace: openbao-bso-test\nspec:\n  address: \"http://openbao.openbao.svc.cluster.local:8200\"\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f vault-connection.yaml\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#k8s-auth-step-7-create-vaultauth","title":"K8s Auth: Step 7 - Create VaultAuth","text":"<p>Create <code>vault-auth.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultAuth\nmetadata:\n  name: openbao-auth\n  namespace: openbao-bso-test\nspec:\n  vaultConnectionRef: openbao-connection\n  method: kubernetes\n  mount: kubernetes\n  kubernetes:\n    role: bso-role\n    serviceAccount: openbao-bso-sa\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f vault-auth.yaml\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#k8s-auth-step-8-create-vaultstaticsecret","title":"K8s Auth: Step 8 - Create VaultStaticSecret","text":"<p>Create <code>vault-static-secret.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultStaticSecret\nmetadata:\n  name: app-secrets\n  namespace: openbao-bso-test\nspec:\n  vaultAuthRef: openbao-auth\n  mount: secret\n  type: kv-v2\n  path: myapp\n  refreshAfter: 30s\n  destination:\n    name: app-secrets\n    create: true\n    annotations:\n      reloader.stakater.com/match: \"true\"\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f vault-static-secret.yaml\n</code></pre> <p>Now proceed to Deploy Application section.</p>"},{"location":"integrations/openbao/openbao-bso.html#option-2-approle-authentication","title":"Option 2: AppRole Authentication","text":"<p>This section covers setting up BSO with OpenBao AppRole authentication. This method uses a RoleID and SecretID pair.</p>"},{"location":"integrations/openbao/openbao-bso.html#approle-step-1-create-openbao-policy","title":"AppRole: Step 1 - Create OpenBao Policy","text":"<pre><code>bao policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#approle-step-2-enable-and-configure-approle-auth","title":"AppRole: Step 2 - Enable and Configure AppRole Auth","text":"<pre><code># Enable AppRole auth method (skip if already enabled)\nbao auth enable approle\n\n# Create AppRole role\nbao write auth/approle/role/bso-role \\\n  secret_id_ttl=0 \\\n  token_policies=myapp-read \\\n  token_ttl=1h \\\n  token_max_ttl=4h\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#approle-step-3-get-roleid-and-secretid","title":"AppRole: Step 3 - Get RoleID and SecretID","text":"<pre><code># Get RoleID\nROLE_ID=$(bao read -field=role_id auth/approle/role/bso-role/role-id)\necho \"RoleID: $ROLE_ID\"\n\n# Generate SecretID\nSECRET_ID=$(bao write -field=secret_id -f auth/approle/role/bso-role/secret-id)\necho \"SecretID: $SECRET_ID\"\n</code></pre> <p>Important: Save both values. You'll need them in Step 5.</p>"},{"location":"integrations/openbao/openbao-bso.html#approle-step-4-write-secrets","title":"AppRole: Step 4 - Write Secrets","text":"<pre><code>bao kv put secret/myapp username='admin-user' password='super-secret-password'\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#approle-step-5-create-application-namespace-serviceaccount-and-approle-secret","title":"AppRole: Step 5 - Create Application Namespace, ServiceAccount, and AppRole Secret","text":"<pre><code># Create namespace\nkubectl create namespace openbao-bso-test\n\n# Create service account (required by the deployment)\nkubectl create serviceaccount openbao-bso-sa -n openbao-bso-test\n\n# Create Kubernetes Secret with AppRole SecretID\n# The secret must have a key named \"id\" (required by BSO)\n# Replace &lt;SECRET_ID&gt; with the SecretID from Step 3\nkubectl create secret generic openbao-approle-secret -n openbao-bso-test \\\n  --from-literal=id=\"&lt;SECRET_ID&gt;\"\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#approle-step-6-create-vaultconnection","title":"AppRole: Step 6 - Create VaultConnection","text":"<p>Create <code>vault-connection.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultConnection\nmetadata:\n  name: openbao-connection\n  namespace: openbao-bso-test\nspec:\n  address: \"http://openbao.openbao.svc.cluster.local:8200\"\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f vault-connection.yaml\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#approle-step-7-create-vaultauth","title":"AppRole: Step 7 - Create VaultAuth","text":"<p>Create <code>vault-auth.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultAuth\nmetadata:\n  name: openbao-auth\n  namespace: openbao-bso-test\nspec:\n  vaultConnectionRef: openbao-connection\n  method: appRole\n  mount: approle\n  appRole:\n    roleId: &lt;ROLE_ID&gt;\n    secretRef: openbao-approle-secret\n</code></pre> <p>Note: Replace <code>&lt;ROLE_ID&gt;</code> with the RoleID from Step 3. The <code>secretRef</code> is the name of the K8s Secret created in Step 5, which must contain a key named <code>id</code> with the SecretID value.</p> <p>Apply:</p> <pre><code>kubectl apply -f vault-auth.yaml\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#approle-step-8-create-vaultstaticsecret","title":"AppRole: Step 8 - Create VaultStaticSecret","text":"<p>Create <code>vault-static-secret.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultStaticSecret\nmetadata:\n  name: app-secrets\n  namespace: openbao-bso-test\nspec:\n  vaultAuthRef: openbao-auth\n  mount: secret\n  type: kv-v2\n  path: myapp\n  refreshAfter: 30s\n  destination:\n    name: app-secrets\n    create: true\n    annotations:\n      reloader.stakater.com/match: \"true\"\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f vault-static-secret.yaml\n</code></pre> <p>Now proceed to Deploy Application section.</p>"},{"location":"integrations/openbao/openbao-bso.html#common-configuration","title":"Common Configuration","text":"<p>The following sections apply to both authentication methods.</p>"},{"location":"integrations/openbao/openbao-bso.html#deploy-application","title":"Deploy Application","text":"<p>Create <code>deployment.yaml</code>:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: openbao-bso-test-app\n  namespace: openbao-bso-test\n  annotations:\n    reloader.stakater.com/search: \"true\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: openbao-bso-test-app\n  template:\n    metadata:\n      labels:\n        app: openbao-bso-test-app\n    spec:\n      serviceAccountName: openbao-bso-sa\n      containers:\n        - name: app\n          image: busybox:latest\n          command:\n            - \"sh\"\n            - \"-c\"\n            - |\n              while true; do\n                echo \"Username: $APP_USERNAME\"\n                echo \"Password: $APP_PASSWORD\"\n                sleep 30\n              done\n          env:\n            - name: APP_USERNAME\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: username\n            - name: APP_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: password\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f deployment.yaml\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#verify-the-setup","title":"Verify the Setup","text":"<pre><code># VaultConnection\nkubectl get vaultconnection -n openbao-bso-test\n\n# VaultAuth\nkubectl get vaultauth -n openbao-bso-test\n\n# VaultStaticSecret\nkubectl get vaultstaticsecret -n openbao-bso-test\n\n# Secret (created by BSO)\nkubectl get secret app-secrets -n openbao-bso-test\n\n# Pod\nkubectl get pods -n openbao-bso-test\n\n# Verify secret contents\nkubectl get secret app-secrets -n openbao-bso-test -o jsonpath='{.data.password}' | base64 -d\n\n# Check app logs\nkubectl logs -n openbao-bso-test -l app=openbao-bso-test-app\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#test-secret-rotation","title":"Test Secret Rotation","text":""},{"location":"integrations/openbao/openbao-bso.html#update-secret-in-openbao","title":"Update Secret in OpenBao","text":"<pre><code>bao kv put secret/myapp username='admin-user' password='new-rotated-password'\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#wait-and-verify","title":"Wait and Verify","text":"<p>Wait 30-60 seconds for BSO refresh and Reloader restart:</p> <pre><code># Check secret was updated\nkubectl get secret app-secrets -n openbao-bso-test -o jsonpath='{.data.password}' | base64 -d\n\n# Check pod was restarted (new pod name)\nkubectl get pods -n openbao-bso-test -l app=openbao-bso-test-app\n\n# Check app logs show new password\nkubectl logs -n openbao-bso-test -l app=openbao-bso-test-app --tail=5\n</code></pre>"},{"location":"integrations/openbao/openbao-bso.html#configuration-reference","title":"Configuration Reference","text":""},{"location":"integrations/openbao/openbao-bso.html#vaultconnection-configuration","title":"VaultConnection Configuration","text":"Field Description <code>address</code> OpenBao server URL (e.g., <code>http://openbao.openbao.svc.cluster.local:8200</code>) <code>caCertSecretRef</code> (Optional) Reference to K8s Secret containing OpenBao CA certificate <code>tlsServerName</code> (Optional) TLS server name for certificate verification <code>skipTLSVerify</code> (Optional) Skip TLS verification (not recommended for production)"},{"location":"integrations/openbao/openbao-bso.html#vaultauth-configuration","title":"VaultAuth Configuration","text":""},{"location":"integrations/openbao/openbao-bso.html#kubernetes-authentication","title":"Kubernetes Authentication","text":"Field Description <code>vaultConnectionRef</code> Reference to the VaultConnection resource <code>method</code> Auth method: <code>kubernetes</code> <code>mount</code> Auth mount path in OpenBao (e.g., <code>kubernetes</code>) <code>kubernetes.role</code> OpenBao role name <code>kubernetes.serviceAccount</code> Kubernetes ServiceAccount name"},{"location":"integrations/openbao/openbao-bso.html#approle-authentication","title":"AppRole Authentication","text":"Field Description <code>vaultConnectionRef</code> Reference to the VaultConnection resource <code>method</code> Auth method: <code>appRole</code> <code>mount</code> Auth mount path in OpenBao (e.g., <code>approle</code>) <code>appRole.roleId</code> AppRole RoleID <code>appRole.secretRef</code> Name of K8s Secret containing SecretID (must have a key named <code>id</code>)"},{"location":"integrations/openbao/openbao-bso.html#vaultstaticsecret-configuration","title":"VaultStaticSecret Configuration","text":"Field Description <code>vaultAuthRef</code> Reference to the VaultAuth resource <code>mount</code> Secrets engine mount path (e.g., <code>secret</code>) <code>type</code> Secrets engine type (<code>kv-v2</code> or <code>kv-v1</code>) <code>path</code> Secret path within the mount (e.g., <code>myapp</code>) <code>refreshAfter</code> How often BSO syncs secrets from OpenBao (e.g., <code>30s</code>) <code>destination.name</code> Name of the K8s Secret to create <code>destination.create</code> Whether to create the Secret if it doesn't exist <code>destination.annotations</code> Annotations to add to the created Secret"},{"location":"integrations/openbao/openbao-bso.html#reloader-annotations","title":"Reloader Annotations","text":"Resource Annotation Deployment <code>reloader.stakater.com/search: \"true\"</code> Secret (via VaultStaticSecret destination) <code>reloader.stakater.com/match: \"true\"</code>"},{"location":"integrations/openbao/openbao-bso.html#comparison-kubernetes-auth-vs-approle","title":"Comparison: Kubernetes Auth vs AppRole","text":"Aspect Kubernetes Auth AppRole Credentials Dynamic tokens from ServiceAccount Static RoleID + rotating SecretID Security No static secrets, tokens auto-rotate SecretID can be rotated, RoleID is static Setup Complexity Requires OpenBao K8s auth configuration Requires AppRole setup + secret management OpenBao Config Policy + K8s auth role Policy + AppRole role Best For In-cluster workloads, production Cross-cluster setups, CI/CD pipelines"},{"location":"integrations/openbao/openbao-csi-file.html","title":"CSI Driver (File-Based)","text":""},{"location":"integrations/openbao/openbao-csi-file.html#openbao-csi-driver-file-based-stakater-reloader-integration","title":"OpenBao CSI Driver (File-Based) + Stakater Reloader Integration","text":"<p>This guide demonstrates integrating OpenBao with Stakater Reloader using the Secrets Store CSI Driver in file-based mode, where secrets are delivered directly as mounted files without syncing to Kubernetes Secrets.</p>"},{"location":"integrations/openbao/openbao-csi-file.html#overview","title":"Overview","text":"<p>In the file-based CSI pattern, secrets from OpenBao are mounted directly into pods as files. Reloader monitors the <code>SecretProviderClassPodStatus</code> resource for version changes and triggers pod restarts when secrets are rotated.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Kubernetes Cluster                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                    Application Namespace                       \u2502  \u2502\n\u2502  \u2502                                                                \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502 SecretProvider  \u2502    \u2502         Application Pod          \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502     Class       \u2502    \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502                 \u2502    \u2502  \u2502  CSI Volume Mount          \u2502  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 - provider:     \u2502    \u2502  \u2502  /mnt/secrets/             \u2502  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502   openbao       \u2502    \u2502  \u2502    \u251c\u2500\u2500 username            \u2502  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 - parameters    \u2502    \u2502  \u2502    \u2514\u2500\u2500 password            \u2502  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502   (no secret-   \u2502    \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502    Objects)     \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                     \u25b2                    \u2502  \u2502\n\u2502  \u2502           \u2502                              \u2502                    \u2502  \u2502\n\u2502  \u2502           \u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502  \u2502\n\u2502  \u2502           \u2502              \u2502     Secrets Store CSI         \u2502    \u2502  \u2502\n\u2502  \u2502           \u2502              \u2502         Driver                \u2502    \u2502  \u2502\n\u2502  \u2502           \u2502              \u2502                               \u2502    \u2502  \u2502\n\u2502  \u2502           \u2502              \u2502  - Mounts secrets as files    \u2502    \u2502  \u2502\n\u2502  \u2502           \u2502              \u2502  - Updates version in status  \u2502    \u2502  \u2502\n\u2502  \u2502           \u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502  \u2502\n\u2502  \u2502           \u2502                              \u2502                    \u2502  \u2502\n\u2502  \u2502           \u25bc                              \u25bc                    \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502          SecretProviderClassPodStatus                   \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502                                                         \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  status:                                                \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502    objects:                                             \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502    - id: username                                       \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502      version: \"abc123...\"  \u25c4\u2500\u2500 Version hash changes     \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502    - id: password               when secret rotates     \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502      version: \"def456...\"                               \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2502                         \u2502                                     \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                            \u2502                                        \u2502\n\u2502                            \u25bc                                        \u2502\n\u2502             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                            \u2502\n\u2502             \u2502    Stakater Reloader    \u2502                            \u2502\n\u2502             \u2502                         \u2502                            \u2502\n\u2502             \u2502  Watches SPCPS for      \u2502                            \u2502\n\u2502             \u2502  version changes        \u2502                            \u2502\n\u2502             \u2502                         \u2502                            \u2502\n\u2502             \u2502  Triggers pod restart   \u2502                            \u2502\n\u2502             \u2502  on version change      \u2502                            \u2502\n\u2502             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                            \u2502\n\u2502                                                                     \u2502\n\u2502             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                            \u2502\n\u2502             \u2502    OpenBao CSI          \u2502                            \u2502\n\u2502             \u2502      Provider           \u2502                            \u2502\n\u2502             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                            \u2502\n\u2502                         \u2502                                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n               \u2502      OpenBao        \u2502\n               \u2502                     \u2502\n               \u2502  KV v2 Secrets      \u2502\n               \u2502  secret/myapp       \u2502\n               \u2502                     \u2502\n               \u2502  Kubernetes Auth    \u2502\n               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/openbao/openbao-csi-file.html#when-to-use-this-pattern","title":"When to Use This Pattern","text":"<p>Use the file-based CSI pattern when:</p> <ul> <li>Applications read secrets directly from files</li> <li>You want to avoid creating Kubernetes Secret objects</li> <li>Security policies require secrets to exist only in memory/tmpfs</li> <li>You need the simplest possible secret delivery mechanism</li> </ul>"},{"location":"integrations/openbao/openbao-csi-file.html#prerequisites","title":"Prerequisites","text":"<p>Complete the common setup steps from the Overview:</p> <ul> <li>OpenBao installed, initialized, and unsealed</li> <li>OpenBao CLI configured (<code>BAO_ADDR</code> and <code>BAO_TOKEN</code> exported)</li> <li>KV v2 secrets engine enabled</li> <li>Test secrets written to <code>secret/myapp</code></li> <li>Stakater Reloader installed</li> </ul> <p>Additionally required:</p> <ul> <li>Secrets Store CSI Driver installed with rotation enabled</li> <li>OpenBao CSI Provider installed</li> </ul> <p>Note: All <code>bao</code> commands below assume <code>BAO_ADDR</code> and <code>BAO_TOKEN</code> are set from Overview Step 3.</p>"},{"location":"integrations/openbao/openbao-csi-file.html#step-1-install-secrets-store-csi-driver","title":"Step 1: Install Secrets Store CSI Driver","text":"<p>Install with rotation enabled:</p> <pre><code>helm repo add secrets-store-csi-driver \\\n  https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts\nhelm repo update\n\nhelm install csi-secrets-store \\\n  secrets-store-csi-driver/secrets-store-csi-driver \\\n  -n kube-system \\\n  --set enableSecretRotation=true \\\n  --set rotationPollInterval=30s\n</code></pre> <p>Note: <code>syncSecret.enabled</code> is not required for file-based delivery.</p>"},{"location":"integrations/openbao/openbao-csi-file.html#step-2-enable-openbao-csi-provider","title":"Step 2: Enable OpenBao CSI Provider","text":"<pre><code>helm upgrade openbao openbao/openbao \\\n  -n openbao \\\n  --set csi.enabled=true \\\n  --reuse-values\n</code></pre>"},{"location":"integrations/openbao/openbao-csi-file.html#step-3-configure-openbao","title":"Step 3: Configure OpenBao","text":""},{"location":"integrations/openbao/openbao-csi-file.html#create-read-policy","title":"Create Read Policy","text":"<pre><code>bao policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/openbao/openbao-csi-file.html#enable-kubernetes-auth","title":"Enable Kubernetes Auth","text":"<pre><code>bao auth enable kubernetes\n\nbao write auth/kubernetes/config \\\n    kubernetes_host='https://kubernetes.default.svc.cluster.local'\n</code></pre>"},{"location":"integrations/openbao/openbao-csi-file.html#create-auth-role","title":"Create Auth Role","text":"<pre><code>bao write auth/kubernetes/role/openbao-csi-role \\\n    bound_service_account_names=openbao-csi-sa \\\n    bound_service_account_namespaces=openbao-csi-test \\\n    policies=myapp-read \\\n    ttl=1h\n</code></pre>"},{"location":"integrations/openbao/openbao-csi-file.html#write-test-secret","title":"Write Test Secret","text":"<pre><code>bao kv put secret/myapp username=myuser password=mypassword\n</code></pre>"},{"location":"integrations/openbao/openbao-csi-file.html#step-4-create-application-namespace-and-serviceaccount","title":"Step 4: Create Application Namespace and ServiceAccount","text":"<pre><code>kubectl create namespace openbao-csi-test\n</code></pre> <pre><code># serviceaccount.yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: openbao-csi-sa\n  namespace: openbao-csi-test\n</code></pre>"},{"location":"integrations/openbao/openbao-csi-file.html#step-5-create-secretproviderclass","title":"Step 5: Create SecretProviderClass","text":"<p>File-based configuration without <code>secretObjects</code>:</p> <pre><code># secret-provider-class.yaml\napiVersion: secrets-store.csi.x-k8s.io/v1\nkind: SecretProviderClass\nmetadata:\n  name: openbao-secrets-file\n  namespace: openbao-csi-test\nspec:\n  provider: openbao\n  parameters:\n    vaultAddress: \"http://openbao.openbao.svc.cluster.local:8200\"\n    roleName: openbao-csi-role\n    objects: |\n      - objectName: \"username\"\n        secretPath: \"secret/data/myapp\"\n        secretKey: \"username\"\n      - objectName: \"password\"\n        secretPath: \"secret/data/myapp\"\n        secretKey: \"password\"\n</code></pre> <p>Key Differences from K8s Secret Sync:</p> <ul> <li>No <code>secretObjects</code> section</li> <li>Secrets only exist as mounted files</li> <li>No Kubernetes Secret is created</li> </ul>"},{"location":"integrations/openbao/openbao-csi-file.html#step-6-deploy-application","title":"Step 6: Deploy Application","text":"<p>The deployment uses the CSI-specific Reloader annotation:</p> <pre><code># deployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: openbao-csi-file-app\n  namespace: openbao-csi-test\n  annotations:\n    # Reloader annotation for CSI-mounted secrets (file-based)\n    secretproviderclass.reloader.stakater.com/reload: \"openbao-secrets-file\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: openbao-csi-file-app\n  template:\n    metadata:\n      labels:\n        app: openbao-csi-file-app\n    spec:\n      serviceAccountName: openbao-csi-sa\n      containers:\n        - name: app\n          image: busybox:latest\n          command:\n            - \"sh\"\n            - \"-c\"\n            - |\n              while true; do\n                echo \"=== Secrets from file ===\"\n                echo \"Username: $(cat /mnt/secrets/username)\"\n                echo \"Password: $(cat /mnt/secrets/password)\"\n                sleep 30\n              done\n          volumeMounts:\n            - name: secrets-store\n              mountPath: \"/mnt/secrets\"\n              readOnly: true\n      volumes:\n        - name: secrets-store\n          csi:\n            driver: secrets-store.csi.k8s.io\n            readOnly: true\n            volumeAttributes:\n              secretProviderClass: openbao-secrets-file\n</code></pre> <p>Key Configuration:</p> <ul> <li><code>secretproviderclass.reloader.stakater.com/reload: \"openbao-secrets-file\"</code> -   Tells Reloader to watch the named SecretProviderClass for version changes</li> <li>Secrets read directly from <code>/mnt/secrets/</code> files</li> <li>No environment variables referencing Kubernetes Secrets</li> </ul>"},{"location":"integrations/openbao/openbao-csi-file.html#step-7-verify-setup","title":"Step 7: Verify Setup","text":"<p>Apply manifests:</p> <pre><code>kubectl apply -f serviceaccount.yaml\nkubectl apply -f secret-provider-class.yaml\nkubectl apply -f deployment.yaml\n</code></pre> <p>Check pod is running:</p> <pre><code>kubectl get pods -n openbao-csi-test -l app=openbao-csi-file-app\n</code></pre> <p>Verify secrets are mounted:</p> <pre><code>kubectl exec -n openbao-csi-test deploy/openbao-csi-file-app -- cat /mnt/secrets/password\n</code></pre> <p>Check SecretProviderClassPodStatus:</p> <pre><code>kubectl get secretproviderclasspodstatus -n openbao-csi-test\n</code></pre> <p>View version information:</p> <pre><code>kubectl get secretproviderclasspodstatus -n openbao-csi-test -o yaml | grep -A5 \"objects:\"\n</code></pre> <p>Example output:</p> <pre><code>status:\n  objects:\n    - id: username\n      version: \"u35OH4bBShH7wgv0YNyr1dzoZzJyKwDFq845rA6Ca_k=\"\n    - id: password\n      version: \"hYds2SjGgvcyw2BIk9aYSJtxUV4hbIefYN3oPjO3WhA=\"\n</code></pre>"},{"location":"integrations/openbao/openbao-csi-file.html#step-8-test-secret-rotation","title":"Step 8: Test Secret Rotation","text":"<p>Record current versions:</p> <pre><code>kubectl get secretproviderclasspodstatus -n openbao-csi-test -o yaml | grep -A5 \"objects:\"\n</code></pre> <p>Update secret in OpenBao:</p> <pre><code>bao kv put secret/myapp username=myuser password=rotated-password\n</code></pre> <p>Wait for CSI rotation and check version change:</p> <pre><code># After ~30-45 seconds (based on rotationPollInterval)\nkubectl get secretproviderclasspodstatus -n openbao-csi-test -o yaml | grep -A5 \"objects:\"\n</code></pre> <p>The password version hash should change:</p> <pre><code>status:\n  objects:\n    - id: username\n      version: \"u35OH4bBShH7wgv0YNyr1dzoZzJyKwDFq845rA6Ca_k=\"  # unchanged\n    - id: password\n      version: \"yNvjDhGGwPLMPhAplHYNJ4eEWrq6zFzA7XGV7Oz6erQ=\"  # CHANGED\n</code></pre> <p>Reloader detects this change and triggers a pod restart.</p>"},{"location":"integrations/openbao/openbao-csi-file.html#how-it-works","title":"How It Works","text":"<ol> <li>CSI Driver mounts secrets - Secrets are mounted as files in the pod's volume</li> <li>SecretProviderClassPodStatus created - CSI driver creates a status resource tracking mounted secrets and their versions</li> <li>Rotation polling - CSI driver periodically checks OpenBao for changes</li> <li>Version update - When secrets change, CSI driver updates the version hash in SecretProviderClassPodStatus</li> <li>Reloader detects change - Reloader watches SecretProviderClassPodStatus for the named SecretProviderClass and triggers pod restart on version changes</li> </ol>"},{"location":"integrations/openbao/openbao-csi-file.html#reloader-annotation","title":"Reloader Annotation","text":"<p>For file-based CSI secrets, use the dedicated annotation on the Deployment:</p> <pre><code>metadata:\n  annotations:\n    secretproviderclass.reloader.stakater.com/reload: \"&lt;secretproviderclass-name&gt;\"\n</code></pre> <p>This is different from the standard Secret/ConfigMap annotations. Reloader watches the <code>SecretProviderClassPodStatus</code> resources and triggers restarts when the version hashes change.</p>"},{"location":"integrations/openbao/openbao-csi-file.html#comparison-file-based-vs-k8s-secret-sync","title":"Comparison: File-Based vs K8s Secret Sync","text":"Aspect File-Based K8s Secret Sync Secret storage Mounted files only Files + K8s Secret Reloader annotation <code>secretproviderclass...reload</code> <code>reloader...match</code> on Secret Security Secrets never in etcd Secrets stored in etcd Env var support Read from file Native secretKeyRef Complexity Simpler More configuration"},{"location":"integrations/openbao/openbao-csi-file.html#important-notes","title":"Important Notes","text":""},{"location":"integrations/openbao/openbao-csi-file.html#provider-name","title":"Provider Name","text":"<p>Use <code>openbao</code> as the provider name:</p> <pre><code>spec:\n  provider: openbao\n</code></pre>"},{"location":"integrations/openbao/openbao-csi-file.html#rotation-must-be-enabled","title":"Rotation Must Be Enabled","text":"<p>The CSI driver must have rotation enabled to detect changes:</p> <pre><code>--set enableSecretRotation=true\n--set rotationPollInterval=30s\n</code></pre>"},{"location":"integrations/openbao/openbao-csi-file.html#application-must-read-files","title":"Application Must Read Files","text":"<p>Applications must be designed to read secrets from mounted files rather than environment variables.</p>"},{"location":"integrations/openbao/openbao-csi-file.html#troubleshooting","title":"Troubleshooting","text":""},{"location":"integrations/openbao/openbao-csi-file.html#version-not-changing","title":"Version Not Changing","text":"<ol> <li>Verify CSI driver has rotation enabled</li> <li>Check rotationPollInterval setting</li> <li>Wait for the full poll interval after rotating secrets</li> </ol>"},{"location":"integrations/openbao/openbao-csi-file.html#secrets-not-mounting","title":"Secrets Not Mounting","text":"<p>Check OpenBao CSI provider logs:</p> <pre><code>kubectl logs -n openbao -l app.kubernetes.io/name=openbao-csi-provider\n</code></pre>"},{"location":"integrations/openbao/openbao-csi-file.html#reloader-not-triggering-restart","title":"Reloader Not Triggering Restart","text":"<ol> <li>Verify the annotation references the correct SecretProviderClass name</li> <li>Check Reloader logs for errors</li> <li>Ensure SecretProviderClassPodStatus exists and shows version changes</li> </ol>"},{"location":"integrations/openbao/openbao-csi.html","title":"CSI Driver","text":""},{"location":"integrations/openbao/openbao-csi.html#how-to-use-reloader-with-openbao-csi-driver-pattern","title":"How to Use Reloader with OpenBao CSI Driver Pattern","text":"<p>This guide demonstrates integrating OpenBao with Stakater Reloader using the Secrets Store CSI Driver with the OpenBao CSI Provider.</p>"},{"location":"integrations/openbao/openbao-csi.html#overview","title":"Overview","text":"<p>The CSI (Container Storage Interface) pattern mounts secrets from OpenBao directly into pods as volume files. Using the <code>secretObjects</code> feature, secrets are also synced to Kubernetes Secrets, enabling Reloader integration.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Kubernetes Cluster                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                    Application Namespace                       \u2502  \u2502\n\u2502  \u2502                                                                \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502 SecretProvider  \u2502    \u2502         Application Pod          \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502     Class       \u2502    \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502                 \u2502    \u2502  \u2502  CSI Volume Mount          \u2502  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 - provider:     \u2502    \u2502  \u2502  /mnt/secrets/             \u2502  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502   openbao       \u2502    \u2502  \u2502    \u251c\u2500\u2500 username            \u2502  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 - secretObjects \u2502    \u2502  \u2502    \u2514\u2500\u2500 password            \u2502  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 - parameters    \u2502    \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2502           \u2502                              \u25b2                     \u2502  \u2502\n\u2502  \u2502           \u2502                              \u2502                     \u2502  \u2502\n\u2502  \u2502           \u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502  \u2502\n\u2502  \u2502           \u2502              \u2502                               \u2502    \u2502  \u2502\n\u2502  \u2502           \u25bc              \u2502     Secrets Store CSI         \u2502    \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502         Driver                \u2502    \u2502  \u2502\n\u2502  \u2502  \u2502 K8s Secret     \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2524  (syncs to K8s Secret via     \u2502    \u2502  \u2502\n\u2502  \u2502  \u2502 (app-secrets)  \u2502      \u2502   secretObjects)              \u2502    \u2502  \u2502\n\u2502  \u2502  \u2502                \u2502      \u2502                               \u2502    \u2502  \u2502\n\u2502  \u2502  \u2502 annotations:   \u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502  \u2502\n\u2502  \u2502  \u2502  reloader...   \u2502                      \u2502                    \u2502  \u2502\n\u2502  \u2502  \u2502  match: true   \u2502                      \u2502                    \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502                    \u2502  \u2502\n\u2502  \u2502          \u2502                               \u2502                    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502             \u2502                               \u2502                       \u2502\n\u2502             \u25bc                               \u25bc                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502  \u2502  Stakater Reloader  \u2502         \u2502  OpenBao CSI        \u2502           \u2502\n\u2502  \u2502                     \u2502         \u2502    Provider         \u2502           \u2502\n\u2502  \u2502  Watches secrets    \u2502         \u2502                     \u2502           \u2502\n\u2502  \u2502  with match: true   \u2502         \u2502  Fetches secrets    \u2502           \u2502\n\u2502  \u2502                     \u2502         \u2502  from OpenBao       \u2502           \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                             \u2502                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                              \u2502\n                                              \u25bc\n                                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                   \u2502      OpenBao        \u2502\n                                   \u2502                     \u2502\n                                   \u2502  KV v2 Secrets      \u2502\n                                   \u2502  secret/myapp       \u2502\n                                   \u2502                     \u2502\n                                   \u2502  Kubernetes Auth    \u2502\n                                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#prerequisites","title":"Prerequisites","text":"<p>Complete the common setup steps from the Overview:</p> <ul> <li>OpenBao installed, initialized, and unsealed</li> <li>OpenBao CLI configured (<code>BAO_ADDR</code> and <code>BAO_TOKEN</code> exported)</li> <li>KV v2 secrets engine enabled</li> <li>Test secrets written to <code>secret/myapp</code></li> <li>Stakater Reloader installed with search mode enabled</li> </ul> <p>Additionally required:</p> <ul> <li>Secrets Store CSI Driver installed with syncSecret and rotation enabled</li> <li>OpenBao CSI Provider installed (included in OpenBao Helm chart)</li> </ul> <p>Note: All <code>bao</code> commands below assume <code>BAO_ADDR</code> and <code>BAO_TOKEN</code> are set from Overview Step 3.</p>"},{"location":"integrations/openbao/openbao-csi.html#step-1-install-secrets-store-csi-driver","title":"Step 1: Install Secrets Store CSI Driver","text":"<p>Install with syncSecret and rotation enabled:</p> <pre><code>helm repo add secrets-store-csi-driver \\\n  https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts\nhelm repo update\n\nhelm install csi-secrets-store \\\n  secrets-store-csi-driver/secrets-store-csi-driver \\\n  -n kube-system \\\n  --set syncSecret.enabled=true \\\n  --set enableSecretRotation=true \\\n  --set rotationPollInterval=30s\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#step-2-enable-openbao-csi-provider","title":"Step 2: Enable OpenBao CSI Provider","text":"<p>If not already enabled, upgrade OpenBao installation:</p> <pre><code>helm upgrade openbao openbao/openbao \\\n  -n openbao \\\n  --set csi.enabled=true \\\n  --reuse-values\n</code></pre> <p>Verify the CSI provider is running:</p> <pre><code>kubectl get pods -n openbao -l app.kubernetes.io/name=openbao-csi-provider\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#step-3-configure-openbao","title":"Step 3: Configure OpenBao","text":""},{"location":"integrations/openbao/openbao-csi.html#create-read-policy","title":"Create Read Policy","text":"<pre><code>bao policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#enable-kubernetes-auth","title":"Enable Kubernetes Auth","text":"<pre><code>bao auth enable kubernetes\n\nbao write auth/kubernetes/config \\\n    kubernetes_host='https://kubernetes.default.svc.cluster.local'\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#create-auth-role","title":"Create Auth Role","text":"<pre><code>bao write auth/kubernetes/role/openbao-csi-role \\\n    bound_service_account_names=openbao-csi-sa \\\n    bound_service_account_namespaces=openbao-csi-test \\\n    policies=myapp-read \\\n    ttl=1h\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#write-test-secret","title":"Write Test Secret","text":"<pre><code>bao kv put secret/myapp username=myuser password=mypassword\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#step-4-create-application-namespace-and-serviceaccount","title":"Step 4: Create Application Namespace and ServiceAccount","text":"<pre><code>kubectl create namespace openbao-csi-test\n</code></pre> <pre><code># serviceaccount.yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: openbao-csi-sa\n  namespace: openbao-csi-test\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#step-5-create-secretproviderclass","title":"Step 5: Create SecretProviderClass","text":"<p>The <code>secretObjects</code> section syncs secrets to a Kubernetes Secret with the Reloader annotation:</p> <pre><code># secret-provider-class.yaml\napiVersion: secrets-store.csi.x-k8s.io/v1\nkind: SecretProviderClass\nmetadata:\n  name: openbao-secrets\n  namespace: openbao-csi-test\nspec:\n  provider: openbao\n  secretObjects:\n    - secretName: app-secrets\n      type: Opaque\n      annotations:\n        reloader.stakater.com/match: \"true\"\n      data:\n        - objectName: username\n          key: username\n        - objectName: password\n          key: password\n  parameters:\n    vaultAddress: \"http://openbao.openbao.svc.cluster.local:8200\"\n    roleName: openbao-csi-role\n    objects: |\n      - objectName: \"username\"\n        secretPath: \"secret/data/myapp\"\n        secretKey: \"username\"\n      - objectName: \"password\"\n        secretPath: \"secret/data/myapp\"\n        secretKey: \"password\"\n</code></pre> <p>Key Configuration:</p> <ul> <li><code>provider: openbao</code> - Uses OpenBao CSI provider (not \"vault\")</li> <li><code>secretObjects</code> - Syncs mounted secrets to Kubernetes Secret</li> <li><code>annotations</code> - Reloader annotation for automatic restarts</li> <li><code>parameters.vaultAddress</code> - Points to OpenBao service</li> <li><code>parameters.roleName</code> - Kubernetes auth role name</li> </ul>"},{"location":"integrations/openbao/openbao-csi.html#step-6-deploy-application","title":"Step 6: Deploy Application","text":"<pre><code># deployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: openbao-csi-test-app\n  namespace: openbao-csi-test\n  annotations:\n    reloader.stakater.com/search: \"true\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: openbao-csi-test-app\n  template:\n    metadata:\n      labels:\n        app: openbao-csi-test-app\n    spec:\n      serviceAccountName: openbao-csi-sa\n      containers:\n        - name: app\n          image: busybox:latest\n          command:\n            - \"sh\"\n            - \"-c\"\n            - |\n              while true; do\n                echo \"Username: $APP_USERNAME\"\n                echo \"Password: $APP_PASSWORD\"\n                sleep 30\n              done\n          env:\n            - name: APP_USERNAME\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: username\n            - name: APP_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: password\n          volumeMounts:\n            - name: secrets-store\n              mountPath: \"/mnt/secrets\"\n              readOnly: true\n      volumes:\n        - name: secrets-store\n          csi:\n            driver: secrets-store.csi.k8s.io\n            readOnly: true\n            volumeAttributes:\n              secretProviderClass: openbao-secrets\n</code></pre> <p>Key Configuration:</p> <ul> <li><code>reloader.stakater.com/search: \"true\"</code> - Enables Reloader search mode</li> <li><code>serviceAccountName</code> - Must match the auth role binding</li> <li><code>volumeMounts</code> - Mounts secrets as files (optional but required for sync)</li> <li><code>env</code> - References the synced Kubernetes Secret</li> </ul>"},{"location":"integrations/openbao/openbao-csi.html#step-7-verify-setup","title":"Step 7: Verify Setup","text":"<p>Apply manifests:</p> <pre><code>kubectl apply -f serviceaccount.yaml\nkubectl apply -f secret-provider-class.yaml\nkubectl apply -f deployment.yaml\n</code></pre> <p>Check pod is running:</p> <pre><code>kubectl get pods -n openbao-csi-test\n</code></pre> <p>Verify synced secret:</p> <pre><code>kubectl get secret app-secrets -n openbao-csi-test -o yaml\n</code></pre> <p>Check pod logs:</p> <pre><code>kubectl logs -n openbao-csi-test -l app=openbao-csi-test-app\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#step-8-test-secret-rotation","title":"Step 8: Test Secret Rotation","text":"<p>Record current pod:</p> <pre><code>kubectl get pods -n openbao-csi-test -l app=openbao-csi-test-app\n</code></pre> <p>Update secret in OpenBao:</p> <pre><code>bao kv put secret/myapp username=myuser password=rotated-password\n</code></pre> <p>Wait for CSI rotation (based on rotationPollInterval) and Reloader:</p> <pre><code># After ~30-60 seconds\nkubectl get pods -n openbao-csi-test -l app=openbao-csi-test-app\nkubectl logs -n openbao-csi-test -l app=openbao-csi-test-app --tail=5\n</code></pre> <p>The pod should show a new name and the updated password.</p>"},{"location":"integrations/openbao/openbao-csi.html#how-it-works","title":"How It Works","text":"<ol> <li>CSI Driver mounts secrets - When the pod starts, the CSI driver authenticates to OpenBao using Kubernetes auth and mounts secrets as files</li> <li>secretObjects sync - The CSI driver creates/updates the Kubernetes Secret with the Reloader annotation</li> <li>Rotation polling - CSI driver periodically polls OpenBao for changes (based on rotationPollInterval)</li> <li>Secret update - When secrets change, CSI driver updates the Kubernetes Secret</li> <li>Reloader triggers restart - Reloader detects the Secret change and performs a rolling restart of the Deployment</li> </ol>"},{"location":"integrations/openbao/openbao-csi.html#important-notes","title":"Important Notes","text":""},{"location":"integrations/openbao/openbao-csi.html#provider-name","title":"Provider Name","text":"<p>The OpenBao CSI provider uses <code>openbao</code> as the provider name, not <code>vault</code>:</p> <pre><code>spec:\n  provider: openbao  # NOT \"vault\"\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#rotation-settings","title":"Rotation Settings","text":"<p>The CSI driver must have rotation enabled:</p> <pre><code>--set enableSecretRotation=true\n--set rotationPollInterval=30s\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#volume-mount-required","title":"Volume Mount Required","text":"<p>The CSI volume must be mounted in the pod for <code>secretObjects</code> to work. The Kubernetes Secret is only created/updated when the pod is running with the volume mounted.</p>"},{"location":"integrations/openbao/openbao-csi.html#authentication","title":"Authentication","text":"<p>CSI uses Kubernetes auth with the pod's ServiceAccount. The ServiceAccount must be bound to an OpenBao role with appropriate policies.</p>"},{"location":"integrations/openbao/openbao-csi.html#troubleshooting","title":"Troubleshooting","text":""},{"location":"integrations/openbao/openbao-csi.html#provider-not-found","title":"Provider Not Found","text":"<pre><code>provider not found: provider \"openbao\"\n</code></pre> <p>Ensure OpenBao CSI provider is installed:</p> <pre><code>kubectl get pods -n openbao -l app.kubernetes.io/name=openbao-csi-provider\n</code></pre>"},{"location":"integrations/openbao/openbao-csi.html#secret-not-syncing","title":"Secret Not Syncing","text":"<ol> <li>Check CSI driver has syncSecret enabled</li> <li>Verify pod is running with the CSI volume mounted</li> <li>Check secretObjects configuration matches parameters.objects</li> </ol>"},{"location":"integrations/openbao/openbao-csi.html#authentication-errors","title":"Authentication Errors","text":"<ol> <li>Verify ServiceAccount exists and is used by the pod</li> <li>Check OpenBao role bindings match the namespace and ServiceAccount</li> <li>Review OpenBao CSI provider logs:</li> </ol> <pre><code>kubectl logs -n openbao -l app.kubernetes.io/name=openbao-csi-provider -c openbao-csi-provider\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html","title":"External Secrets Operator","text":""},{"location":"integrations/openbao/openbao-eso.html#how-to-use-reloader-with-openbao-external-secrets-operator-pattern","title":"How to Use Reloader with OpenBao External Secrets Operator Pattern","text":"<p>This guide explains how to set up OpenBao with the External Secrets Operator (ESO), combined with Stakater Reloader for automatic pod restarts when secrets change.</p> <p>Note: ESO uses the same Vault provider configuration for OpenBao because OpenBao is API-compatible with HashiCorp Vault.</p>"},{"location":"integrations/openbao/openbao-eso.html#authentication-options","title":"Authentication Options","text":"<p>ESO supports two authentication methods with OpenBao:</p> Method Description Use Case Token Uses an OpenBao token stored in a K8s Secret Simpler setup, good for development Kubernetes Auth Uses Kubernetes ServiceAccount tokens for authentication More secure, no static credentials, recommended for production <p>Choose the authentication method that best fits your security requirements and proceed to the corresponding section.</p>"},{"location":"integrations/openbao/openbao-eso.html#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           Kubernetes Cluster                                 \u2502\n\u2502                                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                    External Secrets Operator                            \u2502 \u2502\n\u2502  \u2502                                                                         \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502 \u2502\n\u2502  \u2502  \u2502  SecretStore    \u2502         \u2502  ExternalSecret                      \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502         \u2502                                      \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  - OpenBao URL  \u2502         \u2502  - refreshInterval: 30s              \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  - Auth Method  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  - Maps OpenBao KV to K8s Secret     \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  - KV v2 path   \u2502         \u2502  - Adds Reloader annotation          \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502         \u2502                                      \u2502  \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502   K8s Secret     \u2502    \u2502  Stakater        \u2502    \u2502  Application     \u2502       \u2502\n\u2502  \u2502   (app-secrets)  \u2502\u2500\u2500\u2500\u25ba\u2502  Reloader        \u2502\u2500\u2500\u2500\u25ba\u2502  Pod             \u2502       \u2502\n\u2502  \u2502                  \u2502    \u2502                  \u2502    \u2502                  \u2502       \u2502\n\u2502  \u2502  annotation:     \u2502    \u2502  Watches secret  \u2502    \u2502  Reads secrets   \u2502       \u2502\n\u2502  \u2502  reloader.../    \u2502    \u2502  changes and     \u2502    \u2502  from env vars   \u2502       \u2502\n\u2502  \u2502  match: \"true\"   \u2502    \u2502  restarts pods   \u2502    \u2502                  \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502            \u25b2                                                                 \u2502\n\u2502            \u2502                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                       \u2502\n\u2502  \u2502    OpenBao       \u2502                                                       \u2502\n\u2502  \u2502    Server        \u2502                                                       \u2502\n\u2502  \u2502                  \u2502                                                       \u2502\n\u2502  \u2502  KV v2 engine   \u2502                                                       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#prerequisites","title":"Prerequisites","text":"<p>Complete the common setup steps from the Overview:</p> <ul> <li>OpenBao installed, initialized, and unsealed</li> <li>OpenBao CLI configured (<code>BAO_ADDR</code> and <code>BAO_TOKEN</code> exported)</li> <li>KV v2 secrets engine enabled</li> <li>Test secrets written to <code>secret/myapp</code></li> <li>Read policy (<code>myapp-read</code>) created</li> <li>Stakater Reloader installed</li> </ul> <p>Additionally required:</p> <ul> <li>External Secrets Operator installed</li> </ul> <p>Note: All <code>bao</code> commands below assume <code>BAO_ADDR</code> and <code>BAO_TOKEN</code> are set from Overview Step 3.</p>"},{"location":"integrations/openbao/openbao-eso.html#install-external-secrets-operator","title":"Install External Secrets Operator","text":"<pre><code>helm repo add external-secrets https://charts.external-secrets.io\nhelm repo update\nhelm install external-secrets external-secrets/external-secrets \\\n  --namespace external-secrets \\\n  --create-namespace \\\n  --wait\n</code></pre> <p>Verify installation:</p> <pre><code>kubectl get pods -n external-secrets\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#option-1-token-authentication","title":"Option 1: Token Authentication","text":"<p>This section covers setting up ESO with OpenBao token authentication. This method stores an OpenBao token in a Kubernetes Secret.</p>"},{"location":"integrations/openbao/openbao-eso.html#token-step-1-create-openbao-policy","title":"Token: Step 1 - Create OpenBao Policy","text":"<pre><code>bao policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#token-step-2-write-secrets","title":"Token: Step 2 - Write Secrets","text":"<pre><code>bao kv put secret/myapp username='admin-user' password='super-secret-password'\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#token-step-3-create-openbao-token","title":"Token: Step 3 - Create OpenBao Token","text":"<p>Create a token with the read policy:</p> <pre><code>bao token create -policy=myapp-read -period=24h -display-name=eso-token\n</code></pre> <p>Important: Save the <code>token</code> value from the output. You'll need it in the next step.</p> <p>Example output:</p> <pre><code>Key                  Value\n---                  -----\ntoken                s.CAESI...\ntoken_accessor       abc123...\ntoken_duration       24h\ntoken_renewable      true\ntoken_policies       [\"default\", \"myapp-read\"]\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#token-step-4-create-application-namespace-and-token-secret","title":"Token: Step 4 - Create Application Namespace and Token Secret","text":"<pre><code># Create namespace\nkubectl create namespace openbao-eso-test\n\n# Create token secret for ESO\n# Replace &lt;OPENBAO_TOKEN&gt; with the token from Step 3\nkubectl create secret generic openbao-token -n openbao-eso-test \\\n  --from-literal=token=\"&lt;OPENBAO_TOKEN&gt;\"\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#token-step-5-create-secretstore","title":"Token: Step 5 - Create SecretStore","text":"<p>Create <code>secret-store.yaml</code>:</p> <pre><code>apiVersion: external-secrets.io/v1\nkind: SecretStore\nmetadata:\n  name: openbao-secret-store\n  namespace: openbao-eso-test\nspec:\n  provider:\n    vault:\n      server: \"http://openbao.openbao.svc.cluster.local:8200\"\n      path: \"secret\"\n      version: \"v2\"\n      auth:\n        tokenSecretRef:\n          name: openbao-token\n          key: token\n</code></pre> <p>Apply and verify:</p> <pre><code>kubectl apply -f secret-store.yaml\nkubectl get secretstore -n openbao-eso-test\n</code></pre> <p>Should show <code>STATUS: Valid</code> and <code>READY: True</code>.</p> <p>Now proceed to Create ExternalSecret section.</p>"},{"location":"integrations/openbao/openbao-eso.html#option-2-kubernetes-authentication","title":"Option 2: Kubernetes Authentication","text":"<p>This section covers setting up ESO with OpenBao Kubernetes authentication. This method uses Kubernetes ServiceAccount tokens to authenticate with OpenBao - no static credentials required.</p>"},{"location":"integrations/openbao/openbao-eso.html#k8s-auth-step-1-create-openbao-policy","title":"K8s Auth: Step 1 - Create OpenBao Policy","text":"<pre><code>bao policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#k8s-auth-step-2-enable-and-configure-kubernetes-auth","title":"K8s Auth: Step 2 - Enable and Configure Kubernetes Auth","text":"<pre><code># Enable Kubernetes auth method (skip if already enabled)\nbao auth enable kubernetes\n\n# Configure Kubernetes auth\nbao write auth/kubernetes/config \\\n  kubernetes_host='https://kubernetes.default.svc.cluster.local'\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#k8s-auth-step-3-create-openbao-role","title":"K8s Auth: Step 3 - Create OpenBao Role","text":"<pre><code>bao write auth/kubernetes/role/eso-role \\\n  bound_service_account_names=openbao-eso-sa \\\n  bound_service_account_namespaces=openbao-eso-test \\\n  policies=myapp-read \\\n  ttl=1h\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#k8s-auth-step-4-write-secrets","title":"K8s Auth: Step 4 - Write Secrets","text":"<pre><code>bao kv put secret/myapp username='admin-user' password='super-secret-password'\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#k8s-auth-step-5-create-application-namespace-and-serviceaccount","title":"K8s Auth: Step 5 - Create Application Namespace and ServiceAccount","text":"<pre><code># Create namespace\nkubectl create namespace openbao-eso-test\n\n# Create service account for ESO to use\nkubectl create serviceaccount openbao-eso-sa -n openbao-eso-test\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#k8s-auth-step-6-create-secretstore","title":"K8s Auth: Step 6 - Create SecretStore","text":"<p>Create <code>secret-store.yaml</code>:</p> <pre><code>apiVersion: external-secrets.io/v1\nkind: SecretStore\nmetadata:\n  name: openbao-secret-store\n  namespace: openbao-eso-test\nspec:\n  provider:\n    vault:\n      server: \"http://openbao.openbao.svc.cluster.local:8200\"\n      path: \"secret\"\n      version: \"v2\"\n      auth:\n        kubernetes:\n          mountPath: \"kubernetes\"\n          role: \"eso-role\"\n          serviceAccountRef:\n            name: openbao-eso-sa\n</code></pre> <p>Apply and verify:</p> <pre><code>kubectl apply -f secret-store.yaml\nkubectl get secretstore -n openbao-eso-test\n</code></pre> <p>Should show <code>STATUS: Valid</code> and <code>READY: True</code>.</p> <p>Now proceed to Create ExternalSecret section.</p>"},{"location":"integrations/openbao/openbao-eso.html#common-configuration","title":"Common Configuration","text":"<p>The following sections apply to both authentication methods.</p>"},{"location":"integrations/openbao/openbao-eso.html#create-externalsecret","title":"Create ExternalSecret","text":"<p>Create <code>external-secret.yaml</code>:</p> <pre><code>apiVersion: external-secrets.io/v1\nkind: ExternalSecret\nmetadata:\n  name: app-secrets\n  namespace: openbao-eso-test\nspec:\n  refreshInterval: 30s\n  secretStoreRef:\n    name: openbao-secret-store\n    kind: SecretStore\n  target:\n    name: app-secrets\n    creationPolicy: Owner\n    template:\n      metadata:\n        annotations:\n          # Reloader annotation - triggers restart on workloads with search: \"true\"\n          reloader.stakater.com/match: \"true\"\n  data:\n    - secretKey: username\n      remoteRef:\n        key: secret/data/myapp\n        property: username\n    - secretKey: password\n      remoteRef:\n        key: secret/data/myapp\n        property: password\n</code></pre> <p>Apply and verify:</p> <pre><code>kubectl apply -f external-secret.yaml\nkubectl get externalsecret -n openbao-eso-test\n</code></pre> <p>Should show <code>STATUS: SecretSynced</code> and <code>READY: True</code>.</p>"},{"location":"integrations/openbao/openbao-eso.html#deploy-application","title":"Deploy Application","text":"<p>Create <code>deployment.yaml</code>:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: openbao-eso-test-app\n  namespace: openbao-eso-test\n  annotations:\n    reloader.stakater.com/search: \"true\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: openbao-eso-test-app\n  template:\n    metadata:\n      labels:\n        app: openbao-eso-test-app\n    spec:\n      containers:\n        - name: app\n          image: busybox:latest\n          command:\n            - \"sh\"\n            - \"-c\"\n            - |\n              while true; do\n                echo \"Username: $APP_USERNAME\"\n                echo \"Password: $APP_PASSWORD\"\n                sleep 30\n              done\n          env:\n            - name: APP_USERNAME\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: username\n            - name: APP_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: password\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f deployment.yaml\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#verify-the-setup","title":"Verify the Setup","text":"<pre><code># SecretStore\nkubectl get secretstore -n openbao-eso-test\n\n# ExternalSecret\nkubectl get externalsecret -n openbao-eso-test\n\n# Secret (created by ESO)\nkubectl get secret app-secrets -n openbao-eso-test\n\n# Pod\nkubectl get pods -n openbao-eso-test\n\n# Verify secret contents\nkubectl get secret app-secrets -n openbao-eso-test -o jsonpath='{.data.password}' | base64 -d\n\n# Check app logs\nkubectl logs -n openbao-eso-test -l app=openbao-eso-test-app\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#test-secret-rotation","title":"Test Secret Rotation","text":""},{"location":"integrations/openbao/openbao-eso.html#update-secret-in-openbao","title":"Update Secret in OpenBao","text":"<pre><code>bao kv put secret/myapp username='admin-user' password='new-rotated-password'\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#wait-and-verify","title":"Wait and Verify","text":"<p>Wait 30-60 seconds for ESO refresh and Reloader restart:</p> <pre><code># Check secret was updated\nkubectl get secret app-secrets -n openbao-eso-test -o jsonpath='{.data.password}' | base64 -d\n\n# Check pod was restarted (new pod name)\nkubectl get pods -n openbao-eso-test -l app=openbao-eso-test-app\n\n# Check app logs show new password\nkubectl logs -n openbao-eso-test -l app=openbao-eso-test-app --tail=5\n</code></pre>"},{"location":"integrations/openbao/openbao-eso.html#configuration-reference","title":"Configuration Reference","text":""},{"location":"integrations/openbao/openbao-eso.html#secretstore-configuration","title":"SecretStore Configuration","text":""},{"location":"integrations/openbao/openbao-eso.html#token-authentication","title":"Token Authentication","text":"Field Description <code>server</code> OpenBao server URL <code>path</code> KV secrets engine mount path (e.g., <code>secret</code>) <code>version</code> KV engine version (<code>v2</code>) <code>auth.tokenSecretRef.name</code> Name of K8s Secret containing OpenBao token <code>auth.tokenSecretRef.key</code> Key in the Secret containing the token value"},{"location":"integrations/openbao/openbao-eso.html#kubernetes-authentication","title":"Kubernetes Authentication","text":"Field Description <code>server</code> OpenBao server URL <code>path</code> KV secrets engine mount path (e.g., <code>secret</code>) <code>version</code> KV engine version (<code>v2</code>) <code>auth.kubernetes.mountPath</code> OpenBao auth mount path (e.g., <code>kubernetes</code>) <code>auth.kubernetes.role</code> OpenBao role name bound to the ServiceAccount <code>auth.kubernetes.serviceAccountRef.name</code> Kubernetes ServiceAccount name"},{"location":"integrations/openbao/openbao-eso.html#externalsecret-configuration","title":"ExternalSecret Configuration","text":"Field Description <code>refreshInterval</code> How often ESO syncs secrets from OpenBao (e.g., <code>30s</code>) <code>secretStoreRef</code> Reference to the SecretStore <code>target.name</code> Name of the K8s Secret to create <code>target.template.metadata.annotations</code> Annotations to add to the created Secret <code>data[].secretKey</code> Key name in the K8s Secret <code>data[].remoteRef.key</code> Path in OpenBao (KV v2: <code>secret/data/&lt;path&gt;</code>) <code>data[].remoteRef.property</code> Specific field within the OpenBao secret"},{"location":"integrations/openbao/openbao-eso.html#reloader-annotations","title":"Reloader Annotations","text":"Resource Annotation Deployment <code>reloader.stakater.com/search: \"true\"</code> Secret (via ExternalSecret template) <code>reloader.stakater.com/match: \"true\"</code>"},{"location":"integrations/openbao/openbao-eso.html#comparison-token-vs-kubernetes-authentication","title":"Comparison: Token vs Kubernetes Authentication","text":"Aspect Token Kubernetes Auth Credentials Static token stored in K8s Secret Dynamic tokens from ServiceAccount Security Token must be manually rotated No static secrets, tokens auto-rotate Setup Complexity Simpler - just create a token Requires OpenBao K8s auth configuration OpenBao Config Policy + token Policy + auth method + role Best For Development, simple setups Production, security-conscious environments"},{"location":"integrations/vault/index.html","title":"Overview","text":""},{"location":"integrations/vault/index.html#vault-integration","title":"Vault Integration","text":"<p> Support level This integration is validated and supported in Reloader Enterprise. Community usage is possible, but without continuous validation or SLA</p> <p>This guide shows how to automatically restart Kubernetes workloads when HashiCorp Vault secrets change using Stakater Reloader.</p>"},{"location":"integrations/vault/index.html#integration-patterns","title":"Integration Patterns","text":"Pattern How Secrets Arrive Rotation Reloader Compatibility Guide External Secrets Operator ESO syncs to K8s Secret ESO refresh interval Best fit ESO Guide Vault Secrets Operator VSO syncs to K8s Secret VSO refresh interval Best fit VSO Guide CSI Driver CSI mounts files + syncs to K8s Secret CSI rotation interval Works with <code>secretObjects</code> CSI Guide CSI Driver (File-Based) CSI mounts secrets as files only CSI rotation interval Watches SecretProviderClassPodStatus CSI File Guide"},{"location":"integrations/vault/index.html#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Vault + Reloader Architecture                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502  Vault Server (vault namespace):                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  HashiCorp Vault                                                       \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502 \u2502\n\u2502  \u2502  \u2502 KV v2 Engine     \u2502  \u2502 Kubernetes Auth  \u2502  \u2502 AppRole Auth     \u2502    \u2502 \u2502\n\u2502  \u2502  \u2502 secret/myapp     \u2502  \u2502 (k8s SA tokens)  \u2502  \u2502 (RoleID/SecretID)\u2502    \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502  Application Namespace:                                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  Secret Sync (ESO / VSO / CSI)                                         \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502 \u2502\n\u2502  \u2502  \u2502  Operator CRDs   \u2502\u2500\u2500\u2500\u25ba\u2502  K8s Secret      \u2502                         \u2502 \u2502\n\u2502  \u2502  \u2502  (SecretStore,   \u2502    \u2502  (app-secrets)   \u2502                         \u2502 \u2502\n\u2502  \u2502  \u2502   VaultAuth, etc)\u2502    \u2502  match: \"true\"   \u2502                         \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502 \u2502\n\u2502  \u2502                                   \u2502                                    \u2502 \u2502\n\u2502  \u2502                                   \u25bc                                    \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502 \u2502\n\u2502  \u2502  \u2502 Stakater Reloader\u2502\u2500\u2500\u2500\u25ba\u2502  Application Pod \u2502                         \u2502 \u2502\n\u2502  \u2502  \u2502 Detects change   \u2502    \u2502  Rolling restart  \u2502                         \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/vault/index.html#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes cluster (v1.19+)</li> <li>Helm v3+</li> <li>HashiCorp Vault (OSS or Enterprise)</li> <li>Vault CLI installed locally</li> <li>Stakater Reloader installed</li> <li><code>kubectl</code> configured with cluster access</li> </ul>"},{"location":"integrations/vault/index.html#install-stakater-reloader","title":"Install Stakater Reloader","text":"<pre><code>helm repo add stakater https://stakater.github.io/stakater-charts\nhelm install reloader stakater/reloader --namespace reloader --create-namespace\n</code></pre>"},{"location":"integrations/vault/index.html#common-setup-steps","title":"Common Setup Steps","text":""},{"location":"integrations/vault/index.html#step-1-install-vault","title":"Step 1: Install Vault","text":"<pre><code># Add HashiCorp Helm repo\nhelm repo add hashicorp https://helm.releases.hashicorp.com\nhelm repo update\n\n# Install Vault\nhelm install vault hashicorp/vault -n vault --create-namespace \\\n  --set \"server.dataStorage.size=1Gi\" \\\n  --set \"injector.enabled=false\"\n</code></pre> <p>Note: The injector is disabled because this guide uses ESO, VSO, or CSI to sync secrets. Enable it if you also need Vault Agent sidecar injection.</p> <p>Wait for the pod to start (it will be Running but not Ready until unsealed):</p> <pre><code>kubectl wait --for=jsonpath='{.status.phase}'=Running pod/vault-0 -n vault --timeout=180s\n</code></pre>"},{"location":"integrations/vault/index.html#step-2-initialize-and-unseal-vault","title":"Step 2: Initialize and Unseal Vault","text":"<pre><code># Initialize Vault (using 1 key share for simplicity; use more in production)\nkubectl exec -n vault vault-0 -- vault operator init \\\n  -key-shares=1 \\\n  -key-threshold=1 \\\n  -format=json &gt; vault-init.json\n</code></pre> <p>Important: Save <code>vault-init.json</code> securely. It contains the unseal key and root token.</p> <pre><code># Extract unseal key and root token\nVAULT_UNSEAL_KEY=$(cat vault-init.json | jq -r '.unseal_keys_b64[0]')\nVAULT_ROOT_TOKEN=$(cat vault-init.json | jq -r '.root_token')\n\n# Unseal Vault\nkubectl exec -n vault vault-0 -- vault operator unseal \"$VAULT_UNSEAL_KEY\"\n</code></pre> <p>Vault should now show <code>Sealed: false</code>. Wait for the pod to become Ready:</p> <pre><code>kubectl wait --for=condition=ready pod/vault-0 -n vault --timeout=30s\n</code></pre>"},{"location":"integrations/vault/index.html#step-3-configure-vault-cli","title":"Step 3: Configure Vault CLI","text":"<pre><code># Port-forward for local CLI access\nkubectl port-forward -n vault svc/vault 8200:8200 &amp;\n\n# Configure CLI (use the root token from Step 2)\nexport VAULT_ADDR=\"http://127.0.0.1:8200\"\nexport VAULT_TOKEN=\"$VAULT_ROOT_TOKEN\"\n</code></pre>"},{"location":"integrations/vault/index.html#step-4-enable-kv-v2-secrets-engine","title":"Step 4: Enable KV v2 Secrets Engine","text":"<pre><code>vault secrets enable -path=secret kv-v2\n</code></pre> <p>Verify:</p> <pre><code>vault secrets list\n</code></pre> <p>You should see <code>secret/</code> listed as <code>kv</code> version 2.</p>"},{"location":"integrations/vault/index.html#step-5-write-test-secrets","title":"Step 5: Write Test Secrets","text":"<pre><code>vault kv put secret/myapp \\\n  username=\"admin-user\" \\\n  password=\"super-secret-password\"\n</code></pre> <p>Verify:</p> <pre><code>vault kv get secret/myapp\n</code></pre>"},{"location":"integrations/vault/index.html#step-6-create-vault-read-policy","title":"Step 6: Create Vault Read Policy","text":"<pre><code>vault policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/vault/index.html#step-7-enable-kubernetes-auth","title":"Step 7: Enable Kubernetes Auth","text":"<pre><code># Enable Kubernetes auth method\nvault auth enable kubernetes\n\n# Configure Kubernetes auth\nvault write auth/kubernetes/config \\\n  kubernetes_host=\"https://kubernetes.default.svc.cluster.local\"\n</code></pre>"},{"location":"integrations/vault/index.html#step-8-enable-approle-auth-optional","title":"Step 8: Enable AppRole Auth (Optional)","text":"<p>Only required for the VSO AppRole pattern.</p> <pre><code>vault auth enable approle\n</code></pre>"},{"location":"integrations/vault/index.html#how-reloader-works","title":"How Reloader Works","text":"<ol> <li>Secret provider updates K8s Secret - ESO/VSO/CSI syncs secrets from Vault</li> <li>Reloader detects change - Watches for Secret changes via Kubernetes API</li> <li>Pod restart triggered - Rolling restart of pods referencing the changed Secret</li> </ol>"},{"location":"integrations/vault/index.html#reloader-annotations","title":"Reloader Annotations","text":"<p>On Deployment (for K8s Secret-based patterns: ESO, VSO, CSI with secretObjects):</p> <pre><code>metadata:\n  annotations:\n    reloader.stakater.com/search: \"true\"\n</code></pre> <p>On Secret (must be annotation, not label):</p> <pre><code>metadata:\n  annotations:\n    reloader.stakater.com/match: \"true\"\n</code></pre> <p>On Deployment (for CSI file-based pattern only):</p> <pre><code>metadata:\n  annotations:\n    secretproviderclass.reloader.stakater.com/reload: \"&lt;secretproviderclass-name&gt;\"\n</code></pre>"},{"location":"integrations/vault/index.html#pattern-specific-guides","title":"Pattern-Specific Guides","text":"<ul> <li>External Secrets Operator Pattern - Token or Kubernetes auth</li> <li>Vault Secrets Operator Pattern - Kubernetes auth or AppRole</li> <li>CSI Driver Pattern - Kubernetes auth</li> <li>CSI Driver File-Based Pattern - Kubernetes auth, no K8s Secret</li> </ul>"},{"location":"integrations/vault/index.html#using-external-vault-multi-cluster-setup","title":"Using External Vault (Multi-Cluster Setup)","text":"<p>Vault does not need to run inside Kubernetes. A single external Vault instance can serve multiple Kubernetes clusters. This is a common production pattern for centralized secrets management.</p>"},{"location":"integrations/vault/index.html#requirements","title":"Requirements","text":"<ol> <li>Network connectivity - Pods must be able to reach the external Vault URL</li> <li>TLS certificates - Production Vault should use TLS; clusters need the CA certificate</li> <li>Per-cluster Kubernetes auth configuration - Each cluster's JWT tokens are unique</li> </ol>"},{"location":"integrations/vault/index.html#authentication-methods-with-external-vault","title":"Authentication Methods with External Vault","text":"Auth Method Works with External Vault? Additional Configuration Token Yes None - just update Vault URL AppRole Yes None - just update Vault URL Kubernetes Yes Requires per-cluster auth mount configuration"},{"location":"integrations/vault/index.html#configuring-kubernetes-auth-for-external-vault","title":"Configuring Kubernetes Auth for External Vault","text":"<p>When Vault runs outside the cluster, it cannot automatically discover the Kubernetes API. You must provide:</p> <pre><code># Create a service account for Vault to validate tokens\nkubectl create serviceaccount vault-auth -n kube-system\n\n# Grant token review permissions\nkubectl create clusterrolebinding vault-auth-delegator \\\n  --clusterrole=system:auth-delegator \\\n  --serviceaccount=kube-system:vault-auth\n\n# Get the service account token (for K8s 1.24+, create a secret)\nkubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: vault-auth-token\n  namespace: kube-system\n  annotations:\n    kubernetes.io/service-account.name: vault-auth\ntype: kubernetes.io/service-account-token\nEOF\n\n# Extract values for Vault configuration\nTOKEN_REVIEWER_JWT=$(kubectl get secret vault-auth-token -n kube-system -o jsonpath='{.data.token}' | base64 -d)\nKUBE_CA_CERT=$(kubectl config view --raw --minify --flatten -o jsonpath='{.clusters[0].cluster.certificate-authority-data}' | base64 -d)\nKUBE_HOST=$(kubectl config view --raw --minify --flatten -o jsonpath='{.clusters[0].cluster.server}')\n</code></pre> <p>Configure Vault with a separate auth mount per cluster:</p> <pre><code># Enable Kubernetes auth for this cluster\nvault auth enable -path=kubernetes-cluster-a kubernetes\n\n# Configure with cluster-specific values\nvault write auth/kubernetes-cluster-a/config \\\n  kubernetes_host=\"$KUBE_HOST\" \\\n  kubernetes_ca_cert=\"$KUBE_CA_CERT\" \\\n  token_reviewer_jwt=\"$TOKEN_REVIEWER_JWT\"\n\n# Create role (same as before)\nvault write auth/kubernetes-cluster-a/role/myapp-role \\\n  bound_service_account_names=myapp-sa \\\n  bound_service_account_namespaces=production \\\n  policies=myapp-read \\\n  ttl=1h\n</code></pre>"},{"location":"integrations/vault/index.html#manifest-changes-for-external-vault","title":"Manifest Changes for External Vault","text":"<p>Update the Vault address in your manifests:</p> <p>ESO SecretStore:</p> <pre><code>spec:\n  provider:\n    vault:\n      server: \"https://vault.example.com:8200\"\n      caBundle: \"&lt;base64-encoded-ca-cert&gt;\"  # For TLS\n      path: secret\n      auth:\n        kubernetes:\n          mountPath: kubernetes-cluster-a  # Cluster-specific mount\n          role: myapp-role\n</code></pre> <p>VSO VaultConnection:</p> <pre><code>spec:\n  address: \"https://vault.example.com:8200\"\n  caCertSecretRef:\n    name: vault-ca-cert\n    key: ca.crt\n</code></pre> <p>VSO VaultAuth (with external Vault):</p> <pre><code>spec:\n  method: kubernetes\n  mount: kubernetes-cluster-a  # Cluster-specific mount\n  kubernetes:\n    role: myapp-role\n    serviceAccount: myapp-sa\n</code></pre> <p>CSI SecretProviderClass:</p> <pre><code>parameters:\n  vaultAddress: \"https://vault.example.com:8200\"\n  vaultCACertPath: \"/vault/tls/ca.crt\"  # Or use vaultSkipTLSVerify for testing\n  roleName: myapp-role\n</code></pre>"},{"location":"integrations/vault/index.html#multi-cluster-architecture","title":"Multi-Cluster Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         External Vault Server                                \u2502\n\u2502                      (https://vault.example.com:8200)                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502 \u2502\n\u2502  \u2502  \u2502 KV v2 Engine     \u2502  \u2502 kubernetes-      \u2502  \u2502 kubernetes-      \u2502    \u2502 \u2502\n\u2502  \u2502  \u2502 secret/myapp     \u2502  \u2502 cluster-a/       \u2502  \u2502 cluster-b/       \u2502    \u2502 \u2502\n\u2502  \u2502  \u2502                  \u2502  \u2502 (auth mount)     \u2502  \u2502 (auth mount)     \u2502    \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                           \u2502                           \u2502\n          \u25bc                           \u25bc                           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Cluster A       \u2502       \u2502  Cluster B       \u2502       \u2502  Cluster C       \u2502\n\u2502  (Production)    \u2502       \u2502  (Staging)       \u2502       \u2502  (Dev)           \u2502\n\u2502                  \u2502       \u2502                  \u2502       \u2502                  \u2502\n\u2502  ESO / VSO / CSI \u2502       \u2502  ESO / VSO / CSI \u2502       \u2502  ESO / VSO / CSI \u2502\n\u2502  + Reloader      \u2502       \u2502  + Reloader      \u2502       \u2502  + Reloader      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/vault/index.html#references","title":"References","text":"<ul> <li>Stakater Reloader</li> <li>HashiCorp Vault Documentation</li> <li>Vault Helm Chart</li> <li>External Secrets Operator - Vault Provider</li> <li>Vault Secrets Operator</li> <li>Vault CSI Provider</li> </ul>"},{"location":"integrations/vault/vault-csi-file.html","title":"CSI Driver (File-Based)","text":""},{"location":"integrations/vault/vault-csi-file.html#how-to-use-reloader-with-vault-csi-driver-file-based-pattern","title":"How to Use Reloader with Vault CSI Driver (File-Based) Pattern","text":"<p>This guide explains how to set up HashiCorp Vault with the Secrets Store CSI Driver using file-based secrets (no Kubernetes Secret), combined with Stakater Reloader's CSI integration for automatic pod restarts when secrets change.</p>"},{"location":"integrations/vault/vault-csi-file.html#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           Kubernetes Cluster                                 \u2502\n\u2502                                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                         Application Pod                                 \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 \u2502\n\u2502  \u2502  \u2502  App Container                                                   \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502                                                                  \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - Reads secrets directly from mounted files                    \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - No K8s Secret or env vars needed                            \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502                                                                  \u2502   \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502 \u2502\n\u2502  \u2502                              \u2502                                          \u2502 \u2502\n\u2502  \u2502                              \u25bc                                          \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 \u2502\n\u2502  \u2502  \u2502  CSI Volume Mount (/mnt/secrets)                                \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - username (file)                                              \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - password (file)                                              \u2502   \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502            \u25bc                                                   \u25bc            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  Vault CSI       \u2502    \u2502  Stakater Reloader                          \u2502   \u2502\n\u2502  \u2502  Provider        \u2502    \u2502                                              \u2502   \u2502\n\u2502  \u2502                  \u2502    \u2502  Watches SecretProviderClassPodStatus        \u2502   \u2502\n\u2502  \u2502  - Authenticates \u2502    \u2502  for version hash changes, then             \u2502   \u2502\n\u2502  \u2502    via K8s auth  \u2502    \u2502  triggers rolling restart                   \u2502   \u2502\n\u2502  \u2502  - Fetches from  \u2502    \u2502                                              \u2502   \u2502\n\u2502  \u2502    Vault KV v2   \u2502    \u2502  Requires: --enable-csi-integration=true    \u2502   \u2502\n\u2502  \u2502  - Updates files \u2502    \u2502                                              \u2502   \u2502\n\u2502  \u2502    on rotation   \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                       \u2502\n\u2502            \u2502                                                                 \u2502\n\u2502            \u25bc                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                       \u2502\n\u2502  \u2502    Vault         \u2502                                                       \u2502\n\u2502  \u2502    Server        \u2502                                                       \u2502\n\u2502  \u2502                  \u2502                                                       \u2502\n\u2502  \u2502  KV v2 engine   \u2502                                                       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#how-this-differs-from-the-k8s-secret-csi-pattern","title":"How This Differs from the K8s Secret CSI Pattern","text":"Aspect CSI + K8s Secret CSI File-Based (this guide) Secret delivery <code>secretObjects</code> syncs to K8s Secret Secrets mounted as files only App reads secrets from Environment variables (via <code>secretKeyRef</code>) Files on disk (e.g., <code>/mnt/secrets/password</code>) Reloader watches K8s Secret changes (<code>search</code>/<code>match</code> annotations) <code>SecretProviderClassPodStatus</code> version hashes Reloader flag None (default behavior) <code>--enable-csi-integration=true</code> required Reloader annotation <code>reloader.stakater.com/search</code> on Deployment <code>secretproviderclass.reloader.stakater.com/reload</code> on Deployment <p>When to use this pattern: Choose this when your application reads secrets from files rather than environment variables, or when you want to avoid creating intermediate Kubernetes Secret objects. The CSI driver updates files in-place on the mounted volume during rotation, so the running process can re-read files without a restart. However, if your application caches secrets at startup, Reloader's restart ensures the new values are picked up.</p>"},{"location":"integrations/vault/vault-csi-file.html#prerequisites","title":"Prerequisites","text":"<p>Complete the common setup steps from the Overview:</p> <ul> <li>Vault installed and unsealed</li> <li>Vault CLI configured</li> <li>KV v2 secrets engine enabled</li> <li>Test secrets written to <code>secret/myapp</code></li> <li>Read policy (<code>myapp-read</code>) created</li> <li>Stakater Reloader installed with <code>--enable-csi-integration=true</code></li> </ul> <p>Additionally required:</p> <ul> <li>Secrets Store CSI Driver installed with <code>enableSecretRotation=true</code></li> <li>Vault CSI Provider installed</li> </ul>"},{"location":"integrations/vault/vault-csi-file.html#install-stakater-reloader-with-csi-integration","title":"Install Stakater Reloader with CSI Integration","text":"<p>CSI file-based integration requires the <code>--enable-csi-integration=true</code> flag:</p> <pre><code>helm repo add stakater https://stakater.github.io/stakater-charts\nhelm install reloader stakater/reloader --namespace reloader --create-namespace \\\n  --set reloader.deployment.extraArgs.enable-csi-integration=true\n</code></pre> <p>If Reloader is already installed, upgrade it:</p> <pre><code>helm upgrade reloader stakater/reloader --namespace reloader \\\n  --set reloader.deployment.extraArgs.enable-csi-integration=true\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#install-secrets-store-csi-driver","title":"Install Secrets Store CSI Driver","text":"<pre><code>helm repo add secrets-store-csi-driver https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts\nhelm install csi-secrets-store secrets-store-csi-driver/secrets-store-csi-driver \\\n  --namespace kube-system \\\n  --set enableSecretRotation=true \\\n  --set rotationPollInterval=30s\n</code></pre> <p>Note: <code>syncSecret.enabled</code> is not required for this pattern since we are not creating a Kubernetes Secret via <code>secretObjects</code>.</p>"},{"location":"integrations/vault/vault-csi-file.html#install-vault-csi-provider","title":"Install Vault CSI Provider","text":"<pre><code>helm repo add hashicorp https://helm.releases.hashicorp.com\nhelm install vault hashicorp/vault -n vault \\\n  --set \"server.enabled=false\" \\\n  --set \"injector.enabled=false\" \\\n  --set \"csi.enabled=true\"\n</code></pre> <p>Note: If Vault is already installed in the cluster, install only the CSI provider by setting <code>server.enabled=false</code> and <code>injector.enabled=false</code>.</p>"},{"location":"integrations/vault/vault-csi-file.html#step-1-create-vault-policy","title":"Step 1: Create Vault Policy","text":"<pre><code>vault policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#step-2-enable-and-configure-kubernetes-auth","title":"Step 2: Enable and Configure Kubernetes Auth","text":"<pre><code># Enable Kubernetes auth method (skip if already enabled)\nvault auth enable kubernetes\n\n# Configure Kubernetes auth\nvault write auth/kubernetes/config \\\n  kubernetes_host=\"https://kubernetes.default.svc.cluster.local\"\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#step-3-create-vault-role","title":"Step 3: Create Vault Role","text":"<pre><code>vault write auth/kubernetes/role/csi-file-role \\\n  bound_service_account_names=vault-csi-file-sa \\\n  bound_service_account_namespaces=vault-csi-file-test \\\n  policies=myapp-read \\\n  ttl=1h\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#step-4-write-secrets","title":"Step 4: Write Secrets","text":"<pre><code>vault kv put secret/myapp \\\n  username=\"admin-user\" \\\n  password=\"super-secret-password\"\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#step-5-create-application-namespace-and-serviceaccount","title":"Step 5: Create Application Namespace and ServiceAccount","text":"<pre><code>kubectl create namespace vault-csi-file-test\nkubectl create serviceaccount vault-csi-file-sa -n vault-csi-file-test\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#step-6-create-secretproviderclass","title":"Step 6: Create SecretProviderClass","text":"<p>Create <code>secret-provider-class.yaml</code>:</p> <pre><code>apiVersion: secrets-store.csi.x-k8s.io/v1\nkind: SecretProviderClass\nmetadata:\n  name: vault-secrets\n  namespace: vault-csi-file-test\nspec:\n  provider: vault\n  parameters:\n    vaultAddress: \"http://vault.vault.svc.cluster.local:8200\"\n    roleName: \"csi-file-role\"\n    objects: |\n      - objectName: \"username\"\n        secretPath: \"secret/data/myapp\"\n        secretKey: \"username\"\n      - objectName: \"password\"\n        secretPath: \"secret/data/myapp\"\n        secretKey: \"password\"\n</code></pre> <p>Important: Each object must include <code>secretKey</code>. Reloader tracks changes by comparing version hashes of individual objects in the <code>SecretProviderClassPodStatus</code>. Without <code>secretKey</code>, Reloader may not detect updates correctly.</p> <p>Note: There is no <code>secretObjects</code> field in this configuration. Secrets are delivered purely as files on the CSI volume mount.</p> <p>Apply:</p> <pre><code>kubectl apply -f secret-provider-class.yaml\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#step-7-deploy-application","title":"Step 7: Deploy Application","text":"<p>Create <code>deployment.yaml</code>:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: vault-csi-file-test-app\n  namespace: vault-csi-file-test\n  annotations:\n    secretproviderclass.reloader.stakater.com/reload: \"vault-secrets\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: vault-csi-file-test-app\n  template:\n    metadata:\n      labels:\n        app: vault-csi-file-test-app\n    spec:\n      serviceAccountName: vault-csi-file-sa\n      containers:\n        - name: app\n          image: busybox:latest\n          command:\n            - \"sh\"\n            - \"-c\"\n            - |\n              while true; do\n                echo \"Username: $(cat /mnt/secrets/username)\"\n                echo \"Password: $(cat /mnt/secrets/password)\"\n                sleep 10\n              done\n          volumeMounts:\n            - name: vault-secrets\n              mountPath: /mnt/secrets\n              readOnly: true\n      volumes:\n        - name: vault-secrets\n          csi:\n            driver: secrets-store.csi.k8s.io\n            readOnly: true\n            volumeAttributes:\n              secretProviderClass: vault-secrets\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f deployment.yaml\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#step-8-verify-the-setup","title":"Step 8: Verify the Setup","text":""},{"location":"integrations/vault/vault-csi-file.html#check-pod-status","title":"Check Pod Status","text":"<pre><code>kubectl get pods -n vault-csi-file-test\n</code></pre> <p>Pod should be Running.</p>"},{"location":"integrations/vault/vault-csi-file.html#check-secretproviderclasspodstatus","title":"Check SecretProviderClassPodStatus","text":"<pre><code>kubectl get secretproviderclasspodstatuses -n vault-csi-file-test -o yaml\n</code></pre> <p>You should see <code>mounted: true</code> with version hashes for each object:</p> <pre><code>status:\n  mounted: true\n  objects:\n    - id: password\n      version: \"7vqIvQ_EK1QRzcRgswkuu_jFo8gie6VFk9BSQ28f59w=\"\n    - id: username\n      version: \"Oi7gx1M05Zm6xN4CR5FQ-ryYL7iC7OTqO8aXVvVyIAk=\"\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#verify-secrets-are-mounted-as-files","title":"Verify Secrets are Mounted as Files","text":"<pre><code># Check files exist on the volume\nkubectl exec -n vault-csi-file-test deploy/vault-csi-file-test-app -- ls /mnt/secrets\n\n# Check file contents\nkubectl exec -n vault-csi-file-test deploy/vault-csi-file-test-app -- cat /mnt/secrets/username\nkubectl exec -n vault-csi-file-test deploy/vault-csi-file-test-app -- cat /mnt/secrets/password\n\n# Check app logs\nkubectl logs -n vault-csi-file-test -l app=vault-csi-file-test-app\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#step-9-test-secret-rotation","title":"Step 9: Test Secret Rotation","text":""},{"location":"integrations/vault/vault-csi-file.html#update-secret-in-vault","title":"Update Secret in Vault","text":"<pre><code>vault kv put secret/myapp \\\n  username=\"new-admin\" \\\n  password=\"new-rotated-password\"\n</code></pre>"},{"location":"integrations/vault/vault-csi-file.html#wait-and-verify","title":"Wait and Verify","text":"<p>Wait 30-60 seconds for CSI rotation and Reloader restart:</p> <pre><code># Check SecretProviderClassPodStatus - version hashes should change\nkubectl get secretproviderclasspodstatuses -n vault-csi-file-test -o yaml\n\n# Check pod was restarted (new pod name)\nkubectl get pods -n vault-csi-file-test -l app=vault-csi-file-test-app\n\n# Check app logs show new values\nkubectl logs -n vault-csi-file-test -l app=vault-csi-file-test-app --tail=5\n</code></pre> <p>The <code>SecretProviderClassPodStatus</code> <code>generation</code> field increments and each object's <code>version</code> hash changes when its value is updated.</p>"},{"location":"integrations/vault/vault-csi-file.html#key-configuration-points","title":"Key Configuration Points","text":""},{"location":"integrations/vault/vault-csi-file.html#reloader-csi-integration","title":"Reloader CSI Integration","text":"Setting Description <code>--enable-csi-integration=true</code> Required Reloader flag to watch <code>SecretProviderClassPodStatus</code>"},{"location":"integrations/vault/vault-csi-file.html#reloader-annotations-for-csi","title":"Reloader Annotations for CSI","text":"Annotation Description <code>secretproviderclass.reloader.stakater.com/reload: \"&lt;name&gt;\"</code> Restart when the named SecretProviderClass updates <code>secretproviderclass.reloader.stakater.com/auto: \"true\"</code> Restart when any SecretProviderClass used by the workload updates <code>reloader.stakater.com/auto: \"true\"</code> Global auto-discovery (includes CSI, Secrets, and ConfigMaps)"},{"location":"integrations/vault/vault-csi-file.html#secretproviderclass-configuration","title":"SecretProviderClass Configuration","text":"Field Description <code>provider</code> Must be <code>vault</code> <code>parameters.vaultAddress</code> Vault server URL <code>parameters.roleName</code> Vault Kubernetes auth role name <code>parameters.objects</code> YAML string defining which secrets to mount"},{"location":"integrations/vault/vault-csi-file.html#objects-configuration","title":"Objects Configuration","text":"<p>Each object in the <code>parameters.objects</code> field maps a Vault secret field to a file:</p> Field Description <code>objectName</code> Name of the mounted file <code>secretPath</code> Full Vault path (KV v2: <code>secret/data/&lt;path&gt;</code>) <code>secretKey</code> Specific field within the Vault secret (required for Reloader change detection)"},{"location":"integrations/vault/vault-csi-file.html#how-reloader-detects-changes","title":"How Reloader Detects Changes","text":"<ol> <li>The CSI driver periodically polls Vault for secret updates (controlled by <code>rotationPollInterval</code>)</li> <li>When secrets change, the CSI driver updates the files on disk and updates the <code>SecretProviderClassPodStatus</code> resource with new version hashes</li> <li>Reloader watches <code>SecretProviderClassPodStatus</code> resources and compares version hashes</li> <li>When a hash changes, Reloader triggers a rolling restart of the annotated Deployment</li> </ol>"},{"location":"integrations/vault/vault-csi.html","title":"CSI Driver","text":""},{"location":"integrations/vault/vault-csi.html#how-to-use-reloader-with-vault-csi-driver-k8s-secret-pattern","title":"How to Use Reloader with Vault CSI Driver (K8s Secret) Pattern","text":"<p>This guide explains how to set up HashiCorp Vault with the Secrets Store CSI Driver using Kubernetes authentication, combined with Stakater Reloader for automatic pod restarts when secrets change. This pattern uses <code>secretObjects</code> to sync CSI-mounted secrets into a Kubernetes Secret, which Reloader then watches.</p> <p>See also: CSI Driver File-Based Pattern - an alternative that skips the K8s Secret entirely and uses Reloader's CSI integration to watch <code>SecretProviderClassPodStatus</code> directly.</p>"},{"location":"integrations/vault/vault-csi.html#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           Kubernetes Cluster                                 \u2502\n\u2502                                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                         Application Pod                                 \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 \u2502\n\u2502  \u2502  \u2502  App Container                                                   \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502                                                                  \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - Reads secrets from env vars (K8s Secret)                     \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - Optionally reads secrets from mounted files                  \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502                                                                  \u2502   \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502 \u2502\n\u2502  \u2502                              \u2502                                          \u2502 \u2502\n\u2502  \u2502                              \u25bc                                          \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 \u2502\n\u2502  \u2502  \u2502  CSI Volume Mount (/mnt/secrets)                                \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - username                                                      \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502  - password                                                      \u2502   \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502            \u25bc                         \u25bc                         \u25bc            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n\u2502  \u2502  Vault CSI       \u2502    \u2502   K8s Secret     \u2502    \u2502  Stakater        \u2502      \u2502\n\u2502  \u2502  Provider        \u2502\u2500\u2500\u2500\u25ba\u2502   (app-secrets)  \u2502\u2500\u2500\u2500\u25ba\u2502  Reloader        \u2502      \u2502\n\u2502  \u2502                  \u2502    \u2502                  \u2502    \u2502                  \u2502      \u2502\n\u2502  \u2502  - Authenticates \u2502    \u2502  annotation:     \u2502    \u2502  Watches secret  \u2502      \u2502\n\u2502  \u2502    via K8s auth  \u2502    \u2502  reloader.../    \u2502    \u2502  changes and     \u2502      \u2502\n\u2502  \u2502  - Fetches from  \u2502    \u2502  match: \"true\"   \u2502    \u2502  restarts pods   \u2502      \u2502\n\u2502  \u2502    Vault KV v2   \u2502    \u2502                  \u2502    \u2502                  \u2502      \u2502\n\u2502  \u2502  - Syncs via     \u2502    \u2502  (secretObjects) \u2502    \u2502                  \u2502      \u2502\n\u2502  \u2502    secretObjects \u2502    \u2502                  \u2502    \u2502                  \u2502      \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\n\u2502            \u2502                                                                 \u2502\n\u2502            \u25bc                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                       \u2502\n\u2502  \u2502    Vault         \u2502                                                       \u2502\n\u2502  \u2502    Server        \u2502                                                       \u2502\n\u2502  \u2502                  \u2502                                                       \u2502\n\u2502  \u2502  KV v2 engine   \u2502                                                       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#prerequisites","title":"Prerequisites","text":"<p>Complete the common setup steps from the Overview:</p> <ul> <li>Vault installed, initialized, and unsealed</li> <li>Vault CLI configured</li> <li>KV v2 secrets engine enabled</li> <li>Test secrets written to <code>secret/myapp</code></li> <li>Read policy (<code>myapp-read</code>) created</li> <li>Stakater Reloader installed</li> </ul> <p>Additionally required:</p> <ul> <li>Secrets Store CSI Driver installed with <code>syncSecret.enabled=true</code></li> <li>Vault CSI Provider installed</li> </ul>"},{"location":"integrations/vault/vault-csi.html#install-secrets-store-csi-driver","title":"Install Secrets Store CSI Driver","text":"<pre><code>helm repo add secrets-store-csi-driver https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts\nhelm install csi-secrets-store secrets-store-csi-driver/secrets-store-csi-driver \\\n  --namespace kube-system \\\n  --set syncSecret.enabled=true \\\n  --set enableSecretRotation=true \\\n  --set rotationPollInterval=30s\n</code></pre> <p>Important: <code>syncSecret.enabled=true</code> is required for the CSI driver to create Kubernetes Secrets from mounted volumes. Without this, the <code>secretObjects</code> field will not work.</p>"},{"location":"integrations/vault/vault-csi.html#install-vault-csi-provider","title":"Install Vault CSI Provider","text":"<pre><code>helm repo add hashicorp https://helm.releases.hashicorp.com\nhelm install vault hashicorp/vault -n vault \\\n  --set \"server.enabled=false\" \\\n  --set \"injector.enabled=false\" \\\n  --set \"csi.enabled=true\"\n</code></pre> <p>Note: If Vault is already installed in the cluster, install only the CSI provider by setting <code>server.enabled=false</code> and <code>injector.enabled=false</code>.</p>"},{"location":"integrations/vault/vault-csi.html#step-1-create-vault-policy","title":"Step 1: Create Vault Policy","text":"<pre><code>vault policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#step-2-enable-and-configure-kubernetes-auth","title":"Step 2: Enable and Configure Kubernetes Auth","text":"<pre><code># Enable Kubernetes auth method (skip if already enabled)\nvault auth enable kubernetes\n\n# Configure Kubernetes auth\nvault write auth/kubernetes/config \\\n  kubernetes_host=\"https://kubernetes.default.svc.cluster.local\"\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#step-3-create-vault-role","title":"Step 3: Create Vault Role","text":"<pre><code>vault write auth/kubernetes/role/csi-role \\\n  bound_service_account_names=vault-csi-sa \\\n  bound_service_account_namespaces=vault-csi-test \\\n  policies=myapp-read \\\n  ttl=1h\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#step-4-write-secrets","title":"Step 4: Write Secrets","text":"<pre><code>vault kv put secret/myapp \\\n  username=\"admin-user\" \\\n  password=\"super-secret-password\"\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#step-5-create-application-namespace-and-serviceaccount","title":"Step 5: Create Application Namespace and ServiceAccount","text":"<pre><code>kubectl create namespace vault-csi-test\nkubectl create serviceaccount vault-csi-sa -n vault-csi-test\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#step-6-create-secretproviderclass","title":"Step 6: Create SecretProviderClass","text":"<p>Create <code>secret-provider-class.yaml</code>:</p> <pre><code>apiVersion: secrets-store.csi.x-k8s.io/v1\nkind: SecretProviderClass\nmetadata:\n  name: vault-secrets\n  namespace: vault-csi-test\nspec:\n  provider: vault\n  # Sync to Kubernetes Secret - Required for Reloader integration\n  secretObjects:\n    - secretName: app-secrets\n      type: Opaque\n      annotations:\n        reloader.stakater.com/match: \"true\"\n      data:\n        - key: username\n          objectName: username\n        - key: password\n          objectName: password\n  parameters:\n    vaultAddress: \"http://vault.vault.svc.cluster.local:8200\"\n    roleName: \"csi-role\"\n    objects: |\n      - objectName: \"username\"\n        secretPath: \"secret/data/myapp\"\n        secretKey: \"username\"\n      - objectName: \"password\"\n        secretPath: \"secret/data/myapp\"\n        secretKey: \"password\"\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f secret-provider-class.yaml\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#step-7-deploy-application","title":"Step 7: Deploy Application","text":"<p>Create <code>deployment.yaml</code>:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: vault-csi-test-app\n  namespace: vault-csi-test\n  annotations:\n    reloader.stakater.com/search: \"true\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: vault-csi-test-app\n  template:\n    metadata:\n      labels:\n        app: vault-csi-test-app\n    spec:\n      serviceAccountName: vault-csi-sa\n      containers:\n        - name: app\n          image: busybox:latest\n          command:\n            - \"sh\"\n            - \"-c\"\n            - |\n              while true; do\n                echo \"Username: $APP_USERNAME\"\n                echo \"Password: $APP_PASSWORD\"\n                sleep 30\n              done\n          # Reference secrets from K8s Secret (required for Reloader)\n          env:\n            - name: APP_USERNAME\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: username\n            - name: APP_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: password\n          # CSI volume mount required to trigger secret sync\n          volumeMounts:\n            - name: vault-secrets\n              mountPath: /mnt/secrets\n              readOnly: true\n      volumes:\n        - name: vault-secrets\n          csi:\n            driver: secrets-store.csi.k8s.io\n            readOnly: true\n            volumeAttributes:\n              secretProviderClass: vault-secrets\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f deployment.yaml\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#step-8-verify-the-setup","title":"Step 8: Verify the Setup","text":""},{"location":"integrations/vault/vault-csi.html#check-pod-status","title":"Check Pod Status","text":"<pre><code>kubectl get pods -n vault-csi-test\n</code></pre> <p>Pod should be Running.</p>"},{"location":"integrations/vault/vault-csi.html#check-secretproviderclasspodstatus","title":"Check SecretProviderClassPodStatus","text":"<pre><code>kubectl get secretproviderclasspodstatuses -n vault-csi-test\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#verify-secrets-are-populated","title":"Verify Secrets are Populated","text":"<pre><code># Check K8s Secret was created\nkubectl get secret app-secrets -n vault-csi-test -o jsonpath='{.data.password}' | base64 -d\n\n# Check app logs\nkubectl logs -n vault-csi-test -l app=vault-csi-test-app\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#step-9-test-secret-rotation","title":"Step 9: Test Secret Rotation","text":""},{"location":"integrations/vault/vault-csi.html#update-secret-in-vault","title":"Update Secret in Vault","text":"<pre><code>vault kv put secret/myapp \\\n  username=\"admin-user\" \\\n  password=\"new-rotated-password\"\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#wait-and-verify","title":"Wait and Verify","text":"<p>Wait 30-60 seconds for CSI rotation and Reloader restart:</p> <pre><code># Check secret was updated\nkubectl get secret app-secrets -n vault-csi-test -o jsonpath='{.data.password}' | base64 -d\n\n# Check pod was restarted (new pod name)\nkubectl get pods -n vault-csi-test -l app=vault-csi-test-app\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#key-configuration-points","title":"Key Configuration Points","text":""},{"location":"integrations/vault/vault-csi.html#secretproviderclass-configuration","title":"SecretProviderClass Configuration","text":"Field Description <code>provider</code> Must be <code>vault</code> <code>parameters.vaultAddress</code> Vault server URL <code>parameters.roleName</code> Vault Kubernetes auth role name <code>parameters.objects</code> YAML string defining which secrets to mount"},{"location":"integrations/vault/vault-csi.html#objects-configuration","title":"Objects Configuration","text":"<p>Each object in the <code>parameters.objects</code> field maps a Vault secret field to a file:</p> Field Description <code>objectName</code> Name of the mounted file and key in <code>secretObjects</code> <code>secretPath</code> Full Vault path (KV v2: <code>secret/data/&lt;path&gt;</code>) <code>secretKey</code> Specific field within the Vault secret"},{"location":"integrations/vault/vault-csi.html#secretobjects-configuration","title":"<code>secretObjects</code> Configuration","text":"<p>The <code>secretObjects</code> field syncs mounted secrets to a Kubernetes Secret:</p> <pre><code>secretObjects:\n  - secretName: app-secrets\n    type: Opaque\n    annotations:\n      reloader.stakater.com/match: \"true\"\n    data:\n      - key: username\n        objectName: username  # Must match objectName in parameters.objects\n      - key: password\n        objectName: password\n</code></pre>"},{"location":"integrations/vault/vault-csi.html#reloader-annotations","title":"Reloader Annotations","text":"Resource Annotation Deployment <code>reloader.stakater.com/search: \"true\"</code> Secret <code>reloader.stakater.com/match: \"true\"</code> (via <code>secretObjects</code>)"},{"location":"integrations/vault/vault-csi.html#why-csi-volume-mount-is-required","title":"Why CSI Volume Mount is Required","text":"<p>Even if your app only uses environment variables from the K8s Secret, the CSI volume must be mounted because:</p> <ol> <li>The CSI driver only syncs secrets when a pod mounts the volume</li> <li>Without the mount, the K8s Secret (<code>secretObjects</code>) won't be created</li> </ol>"},{"location":"integrations/vault/vault-eso.html","title":"External Secrets Operator","text":""},{"location":"integrations/vault/vault-eso.html#how-to-use-reloader-with-vault-external-secrets-operator-pattern","title":"How to Use Reloader with Vault External Secrets Operator Pattern","text":"<p>This guide explains how to set up HashiCorp Vault with the External Secrets Operator (ESO), combined with Stakater Reloader for automatic pod restarts when secrets change.</p>"},{"location":"integrations/vault/vault-eso.html#authentication-options","title":"Authentication Options","text":"<p>ESO supports two authentication methods with Vault:</p> Method Description Use Case Token Uses a Vault token stored in a K8s Secret Simpler setup, good for development Kubernetes Auth Uses Kubernetes ServiceAccount tokens for authentication More secure, no static credentials, recommended for production <p>Choose the authentication method that best fits your security requirements and proceed to the corresponding section.</p>"},{"location":"integrations/vault/vault-eso.html#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           Kubernetes Cluster                                 \u2502\n\u2502                                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                    External Secrets Operator                            \u2502 \u2502\n\u2502  \u2502                                                                         \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502 \u2502\n\u2502  \u2502  \u2502  SecretStore    \u2502         \u2502  ExternalSecret                      \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502         \u2502                                      \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  - Vault URL    \u2502         \u2502  - refreshInterval: 30s              \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  - Auth Method  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  - Maps Vault KV to K8s Secret       \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502  - KV v2 path   \u2502         \u2502  - Adds Reloader annotation          \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502         \u2502                                      \u2502  \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502   K8s Secret     \u2502    \u2502  Stakater        \u2502    \u2502  Application     \u2502       \u2502\n\u2502  \u2502   (app-secrets)  \u2502\u2500\u2500\u2500\u25ba\u2502  Reloader        \u2502\u2500\u2500\u2500\u25ba\u2502  Pod             \u2502       \u2502\n\u2502  \u2502                  \u2502    \u2502                  \u2502    \u2502                  \u2502       \u2502\n\u2502  \u2502  annotation:     \u2502    \u2502  Watches secret  \u2502    \u2502  Reads secrets   \u2502       \u2502\n\u2502  \u2502  reloader.../    \u2502    \u2502  changes and     \u2502    \u2502  from env vars   \u2502       \u2502\n\u2502  \u2502  match: \"true\"   \u2502    \u2502  restarts pods   \u2502    \u2502                  \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502            \u25b2                                                                 \u2502\n\u2502            \u2502                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                       \u2502\n\u2502  \u2502    Vault         \u2502                                                       \u2502\n\u2502  \u2502    Server        \u2502                                                       \u2502\n\u2502  \u2502                  \u2502                                                       \u2502\n\u2502  \u2502  KV v2 engine   \u2502                                                       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#prerequisites","title":"Prerequisites","text":"<p>Complete the common setup steps from the Overview:</p> <ul> <li>Vault installed, initialized, and unsealed</li> <li>Vault CLI configured</li> <li>KV v2 secrets engine enabled</li> <li>Test secrets written to <code>secret/myapp</code></li> <li>Read policy (<code>myapp-read</code>) created</li> <li>Stakater Reloader installed</li> </ul> <p>Additionally required:</p> <ul> <li>External Secrets Operator installed</li> </ul>"},{"location":"integrations/vault/vault-eso.html#install-external-secrets-operator","title":"Install External Secrets Operator","text":"<pre><code>helm repo add external-secrets https://charts.external-secrets.io\nhelm repo update\nhelm install external-secrets external-secrets/external-secrets \\\n  --namespace external-secrets \\\n  --create-namespace \\\n  --wait\n</code></pre> <p>Verify installation:</p> <pre><code>kubectl get pods -n external-secrets\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#option-1-token-authentication","title":"Option 1: Token Authentication","text":"<p>This section covers setting up ESO with Vault token authentication. This method stores a Vault token in a Kubernetes Secret.</p>"},{"location":"integrations/vault/vault-eso.html#token-step-1-create-vault-policy","title":"Token: Step 1 - Create Vault Policy","text":"<pre><code>vault policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#token-step-2-write-secrets","title":"Token: Step 2 - Write Secrets","text":"<pre><code>vault kv put secret/myapp \\\n  username=\"admin-user\" \\\n  password=\"super-secret-password\"\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#token-step-3-create-vault-token","title":"Token: Step 3 - Create Vault Token","text":"<p>Create a token with the read policy:</p> <pre><code>vault token create \\\n  -policy=myapp-read \\\n  -period=24h \\\n  -display-name=eso-token\n</code></pre> <p>Important: Save the <code>token</code> value from the output. You'll need it in the next step.</p> <p>Example output:</p> <pre><code>Key                  Value\n---                  -----\ntoken                hvs.CAESI...\ntoken_accessor       abc123...\ntoken_duration       24h\ntoken_renewable      true\ntoken_policies       [\"default\", \"myapp-read\"]\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#token-step-4-create-application-namespace-and-token-secret","title":"Token: Step 4 - Create Application Namespace and Token Secret","text":"<pre><code># Create namespace\nkubectl create namespace vault-eso-test\n\n# Create token secret for ESO\n# Replace &lt;VAULT_TOKEN&gt; with the token from Step 3\nkubectl create secret generic vault-token -n vault-eso-test \\\n  --from-literal=token=\"&lt;VAULT_TOKEN&gt;\"\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#token-step-5-create-secretstore","title":"Token: Step 5 - Create SecretStore","text":"<p>Create <code>secret-store.yaml</code>:</p> <pre><code>apiVersion: external-secrets.io/v1\nkind: SecretStore\nmetadata:\n  name: vault-secret-store\n  namespace: vault-eso-test\nspec:\n  provider:\n    vault:\n      server: \"http://vault.vault.svc.cluster.local:8200\"\n      path: \"secret\"\n      version: \"v2\"\n      auth:\n        tokenSecretRef:\n          name: vault-token\n          key: token\n</code></pre> <p>Apply and verify:</p> <pre><code>kubectl apply -f secret-store.yaml\nkubectl get secretstore -n vault-eso-test\n</code></pre> <p>Should show <code>STATUS: Valid</code> and <code>READY: True</code>.</p> <p>Now proceed to Create ExternalSecret section.</p>"},{"location":"integrations/vault/vault-eso.html#option-2-kubernetes-authentication","title":"Option 2: Kubernetes Authentication","text":"<p>This section covers setting up ESO with Vault Kubernetes authentication. This method uses Kubernetes ServiceAccount tokens to authenticate with Vault - no static credentials required.</p>"},{"location":"integrations/vault/vault-eso.html#k8s-auth-step-1-create-vault-policy","title":"K8s Auth: Step 1 - Create Vault Policy","text":"<pre><code>vault policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#k8s-auth-step-2-enable-and-configure-kubernetes-auth","title":"K8s Auth: Step 2 - Enable and Configure Kubernetes Auth","text":"<pre><code># Enable Kubernetes auth method (skip if already enabled)\nvault auth enable kubernetes\n\n# Configure Kubernetes auth\nvault write auth/kubernetes/config \\\n  kubernetes_host=\"https://kubernetes.default.svc.cluster.local\"\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#k8s-auth-step-3-create-vault-role","title":"K8s Auth: Step 3 - Create Vault Role","text":"<pre><code>vault write auth/kubernetes/role/eso-role \\\n  bound_service_account_names=vault-eso-sa \\\n  bound_service_account_namespaces=vault-eso-test \\\n  policies=myapp-read \\\n  ttl=1h\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#k8s-auth-step-4-write-secrets","title":"K8s Auth: Step 4 - Write Secrets","text":"<pre><code>vault kv put secret/myapp \\\n  username=\"admin-user\" \\\n  password=\"super-secret-password\"\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#k8s-auth-step-5-create-application-namespace-and-serviceaccount","title":"K8s Auth: Step 5 - Create Application Namespace and ServiceAccount","text":"<pre><code># Create namespace\nkubectl create namespace vault-eso-test\n\n# Create service account for ESO to use\nkubectl create serviceaccount vault-eso-sa -n vault-eso-test\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#k8s-auth-step-6-create-secretstore","title":"K8s Auth: Step 6 - Create SecretStore","text":"<p>Create <code>secret-store.yaml</code>:</p> <pre><code>apiVersion: external-secrets.io/v1\nkind: SecretStore\nmetadata:\n  name: vault-secret-store\n  namespace: vault-eso-test\nspec:\n  provider:\n    vault:\n      server: \"http://vault.vault.svc.cluster.local:8200\"\n      path: \"secret\"\n      version: \"v2\"\n      auth:\n        kubernetes:\n          mountPath: \"kubernetes\"\n          role: \"eso-role\"\n          serviceAccountRef:\n            name: vault-eso-sa\n</code></pre> <p>Apply and verify:</p> <pre><code>kubectl apply -f secret-store.yaml\nkubectl get secretstore -n vault-eso-test\n</code></pre> <p>Should show <code>STATUS: Valid</code> and <code>READY: True</code>.</p> <p>Now proceed to Create ExternalSecret section.</p>"},{"location":"integrations/vault/vault-eso.html#common-configuration","title":"Common Configuration","text":"<p>The following sections apply to both authentication methods.</p>"},{"location":"integrations/vault/vault-eso.html#create-externalsecret","title":"Create ExternalSecret","text":"<p>Create <code>external-secret.yaml</code>:</p> <pre><code>apiVersion: external-secrets.io/v1\nkind: ExternalSecret\nmetadata:\n  name: app-secrets\n  namespace: vault-eso-test\nspec:\n  refreshInterval: 30s\n  secretStoreRef:\n    name: vault-secret-store\n    kind: SecretStore\n  target:\n    name: app-secrets\n    creationPolicy: Owner\n    template:\n      metadata:\n        annotations:\n          # Reloader annotation - triggers restart on workloads with search: \"true\"\n          reloader.stakater.com/match: \"true\"\n  data:\n    - secretKey: username\n      remoteRef:\n        key: secret/data/myapp\n        property: username\n    - secretKey: password\n      remoteRef:\n        key: secret/data/myapp\n        property: password\n</code></pre> <p>Apply and verify:</p> <pre><code>kubectl apply -f external-secret.yaml\nkubectl get externalsecret -n vault-eso-test\n</code></pre> <p>Should show <code>STATUS: SecretSynced</code> and <code>READY: True</code>.</p>"},{"location":"integrations/vault/vault-eso.html#deploy-application","title":"Deploy Application","text":"<p>Create <code>deployment.yaml</code>:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: vault-eso-test-app\n  namespace: vault-eso-test\n  annotations:\n    reloader.stakater.com/search: \"true\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: vault-eso-test-app\n  template:\n    metadata:\n      labels:\n        app: vault-eso-test-app\n    spec:\n      containers:\n        - name: app\n          image: busybox:latest\n          command:\n            - \"sh\"\n            - \"-c\"\n            - |\n              while true; do\n                echo \"Username: $APP_USERNAME\"\n                echo \"Password: $APP_PASSWORD\"\n                sleep 30\n              done\n          env:\n            - name: APP_USERNAME\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: username\n            - name: APP_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: password\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f deployment.yaml\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#verify-the-setup","title":"Verify the Setup","text":"<pre><code># SecretStore\nkubectl get secretstore -n vault-eso-test\n\n# ExternalSecret\nkubectl get externalsecret -n vault-eso-test\n\n# Secret (created by ESO)\nkubectl get secret app-secrets -n vault-eso-test\n\n# Pod\nkubectl get pods -n vault-eso-test\n\n# Verify secret contents\nkubectl get secret app-secrets -n vault-eso-test -o jsonpath='{.data.password}' | base64 -d\n\n# Check app logs\nkubectl logs -n vault-eso-test -l app=vault-eso-test-app\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#test-secret-rotation","title":"Test Secret Rotation","text":""},{"location":"integrations/vault/vault-eso.html#update-secret-in-vault","title":"Update Secret in Vault","text":"<pre><code>vault kv put secret/myapp \\\n  username=\"admin-user\" \\\n  password=\"new-rotated-password\"\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#wait-and-verify","title":"Wait and Verify","text":"<p>Wait 30-60 seconds for ESO refresh and Reloader restart:</p> <pre><code># Check secret was updated\nkubectl get secret app-secrets -n vault-eso-test -o jsonpath='{.data.password}' | base64 -d\n\n# Check pod was restarted (new pod name)\nkubectl get pods -n vault-eso-test -l app=vault-eso-test-app\n\n# Check app logs show new password\nkubectl logs -n vault-eso-test -l app=vault-eso-test-app --tail=5\n</code></pre>"},{"location":"integrations/vault/vault-eso.html#configuration-reference","title":"Configuration Reference","text":""},{"location":"integrations/vault/vault-eso.html#secretstore-configuration","title":"SecretStore Configuration","text":""},{"location":"integrations/vault/vault-eso.html#token-authentication","title":"Token Authentication","text":"Field Description <code>server</code> Vault server URL <code>path</code> KV secrets engine mount path (e.g., <code>secret</code>) <code>version</code> KV engine version (<code>v2</code>) <code>auth.tokenSecretRef.name</code> Name of K8s Secret containing Vault token <code>auth.tokenSecretRef.key</code> Key in the Secret containing the token value"},{"location":"integrations/vault/vault-eso.html#kubernetes-authentication","title":"Kubernetes Authentication","text":"Field Description <code>server</code> Vault server URL <code>path</code> KV secrets engine mount path (e.g., <code>secret</code>) <code>version</code> KV engine version (<code>v2</code>) <code>auth.kubernetes.mountPath</code> Vault auth mount path (e.g., <code>kubernetes</code>) <code>auth.kubernetes.role</code> Vault role name bound to the ServiceAccount <code>auth.kubernetes.serviceAccountRef.name</code> Kubernetes ServiceAccount name"},{"location":"integrations/vault/vault-eso.html#externalsecret-configuration","title":"ExternalSecret Configuration","text":"Field Description <code>refreshInterval</code> How often ESO syncs secrets from Vault (e.g., <code>30s</code>) <code>secretStoreRef</code> Reference to the SecretStore <code>target.name</code> Name of the K8s Secret to create <code>target.template.metadata.annotations</code> Annotations to add to the created Secret <code>data[].secretKey</code> Key name in the K8s Secret <code>data[].remoteRef.key</code> Path in Vault (KV v2: <code>secret/data/&lt;path&gt;</code>) <code>data[].remoteRef.property</code> Specific field within the Vault secret"},{"location":"integrations/vault/vault-eso.html#reloader-annotations","title":"Reloader Annotations","text":"Resource Annotation Deployment <code>reloader.stakater.com/search: \"true\"</code> Secret (via ExternalSecret template) <code>reloader.stakater.com/match: \"true\"</code>"},{"location":"integrations/vault/vault-eso.html#comparison-token-vs-kubernetes-authentication","title":"Comparison: Token vs Kubernetes Authentication","text":"Aspect Token Kubernetes Auth Credentials Static token stored in K8s Secret Dynamic tokens from ServiceAccount Security Token must be manually rotated No static secrets, tokens auto-rotate Setup Complexity Simpler - just create a token Requires Vault K8s auth configuration Vault Config Policy + token Policy + auth method + role Best For Development, simple setups Production, security-conscious environments"},{"location":"integrations/vault/vault-vso.html","title":"Vault Secrets Operator","text":""},{"location":"integrations/vault/vault-vso.html#how-to-use-reloader-with-vault-secrets-operator-pattern","title":"How to Use Reloader with Vault Secrets Operator Pattern","text":"<p>This guide explains how to set up HashiCorp Vault with the Vault Secrets Operator (VSO), combined with Stakater Reloader for automatic pod restarts when secrets change.</p>"},{"location":"integrations/vault/vault-vso.html#authentication-options","title":"Authentication Options","text":"<p>VSO supports multiple authentication methods with Vault:</p> Method Description Use Case Kubernetes Auth Uses Kubernetes ServiceAccount tokens for authentication Recommended for production, no static credentials AppRole Uses a RoleID and SecretID pair Good for non-Kubernetes clients or cross-cluster setups <p>Choose the authentication method that best fits your security requirements and proceed to the corresponding section.</p>"},{"location":"integrations/vault/vault-vso.html#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           Kubernetes Cluster                                 \u2502\n\u2502                                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                    Vault Secrets Operator                               \u2502 \u2502\n\u2502  \u2502                                                                         \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502 \u2502\n\u2502  \u2502  \u2502 VaultConnection \u2502  \u2502 VaultAuth  \u2502  \u2502 VaultStaticSecret          \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502  \u2502            \u2502  \u2502                            \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502 - Vault address \u2502\u2500\u25ba\u2502 - K8s Auth \u2502\u2500\u25ba\u2502 - mount: secret            \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502  \u2502   or       \u2502  \u2502 - path: myapp              \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502  \u2502 - AppRole  \u2502  \u2502 - refreshAfter: 30s        \u2502  \u2502 \u2502\n\u2502  \u2502  \u2502                 \u2502  \u2502            \u2502  \u2502 - Reloader annotation      \u2502  \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502   K8s Secret     \u2502    \u2502  Stakater        \u2502    \u2502  Application     \u2502       \u2502\n\u2502  \u2502   (app-secrets)  \u2502\u2500\u2500\u2500\u25ba\u2502  Reloader        \u2502\u2500\u2500\u2500\u25ba\u2502  Pod             \u2502       \u2502\n\u2502  \u2502                  \u2502    \u2502                  \u2502    \u2502                  \u2502       \u2502\n\u2502  \u2502  annotation:     \u2502    \u2502  Watches secret  \u2502    \u2502  Reads secrets   \u2502       \u2502\n\u2502  \u2502  reloader.../    \u2502    \u2502  changes and     \u2502    \u2502  from env vars   \u2502       \u2502\n\u2502  \u2502  match: \"true\"   \u2502    \u2502  restarts pods   \u2502    \u2502                  \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502            \u25b2                                                                 \u2502\n\u2502            \u2502                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                       \u2502\n\u2502  \u2502    Vault         \u2502                                                       \u2502\n\u2502  \u2502    Server        \u2502                                                       \u2502\n\u2502  \u2502                  \u2502                                                       \u2502\n\u2502  \u2502  KV v2 engine   \u2502                                                       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Note: VSO has a built-in <code>rolloutRestartTargets</code> field on <code>VaultStaticSecret</code> that can trigger workload restarts natively. However, using Stakater Reloader provides a uniform restart mechanism across all secret operators (ESO, VSO, CSI), which is valuable when running multiple patterns in the same cluster.</p>"},{"location":"integrations/vault/vault-vso.html#prerequisites","title":"Prerequisites","text":"<p>Complete the common setup steps from the Overview:</p> <ul> <li>Vault installed and unsealed</li> <li>Vault CLI configured</li> <li>KV v2 secrets engine enabled</li> <li>Test secrets written to <code>secret/myapp</code></li> <li>Stakater Reloader installed</li> </ul> <p>Additionally required:</p> <ul> <li>Vault Secrets Operator installed</li> </ul>"},{"location":"integrations/vault/vault-vso.html#install-vault-secrets-operator","title":"Install Vault Secrets Operator","text":"<pre><code>helm repo add hashicorp https://helm.releases.hashicorp.com\nhelm repo update\nhelm install vault-secrets-operator hashicorp/vault-secrets-operator \\\n  --namespace vault-secrets-operator-system \\\n  --create-namespace \\\n  --wait\n</code></pre> <p>Verify installation:</p> <pre><code>kubectl get pods -n vault-secrets-operator-system\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#option-1-kubernetes-authentication","title":"Option 1: Kubernetes Authentication","text":"<p>This section covers setting up VSO with Vault Kubernetes authentication. This method uses Kubernetes ServiceAccount tokens to authenticate with Vault.</p>"},{"location":"integrations/vault/vault-vso.html#k8s-auth-step-1-create-vault-policy","title":"K8s Auth: Step 1 - Create Vault Policy","text":"<pre><code>vault policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#k8s-auth-step-2-enable-and-configure-kubernetes-auth","title":"K8s Auth: Step 2 - Enable and Configure Kubernetes Auth","text":"<pre><code># Enable Kubernetes auth method (skip if already enabled)\nvault auth enable kubernetes\n\n# Configure Kubernetes auth\nvault write auth/kubernetes/config \\\n  kubernetes_host=\"https://kubernetes.default.svc.cluster.local\"\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#k8s-auth-step-3-create-vault-role","title":"K8s Auth: Step 3 - Create Vault Role","text":"<pre><code>vault write auth/kubernetes/role/vso-role \\\n  bound_service_account_names=vault-vso-sa \\\n  bound_service_account_namespaces=vault-vso-test \\\n  policies=myapp-read \\\n  ttl=1h\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#k8s-auth-step-4-write-secrets","title":"K8s Auth: Step 4 - Write Secrets","text":"<pre><code>vault kv put secret/myapp \\\n  username=\"admin-user\" \\\n  password=\"super-secret-password\"\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#k8s-auth-step-5-create-application-namespace-and-serviceaccount","title":"K8s Auth: Step 5 - Create Application Namespace and ServiceAccount","text":"<pre><code># Create namespace\nkubectl create namespace vault-vso-test\n\n# Create service account\nkubectl create serviceaccount vault-vso-sa -n vault-vso-test\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#k8s-auth-step-6-create-vaultconnection","title":"K8s Auth: Step 6 - Create VaultConnection","text":"<p>Create <code>vault-connection.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultConnection\nmetadata:\n  name: vault-connection\n  namespace: vault-vso-test\nspec:\n  address: \"http://vault.vault.svc.cluster.local:8200\"\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f vault-connection.yaml\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#k8s-auth-step-7-create-vaultauth","title":"K8s Auth: Step 7 - Create VaultAuth","text":"<p>Create <code>vault-auth.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultAuth\nmetadata:\n  name: vault-auth\n  namespace: vault-vso-test\nspec:\n  vaultConnectionRef: vault-connection\n  method: kubernetes\n  mount: kubernetes\n  kubernetes:\n    role: vso-role\n    serviceAccount: vault-vso-sa\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f vault-auth.yaml\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#k8s-auth-step-8-create-vaultstaticsecret","title":"K8s Auth: Step 8 - Create VaultStaticSecret","text":"<p>Create <code>vault-static-secret.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultStaticSecret\nmetadata:\n  name: app-secrets\n  namespace: vault-vso-test\nspec:\n  vaultAuthRef: vault-auth\n  mount: secret\n  type: kv-v2\n  path: myapp\n  refreshAfter: 30s\n  destination:\n    name: app-secrets\n    create: true\n    annotations:\n      reloader.stakater.com/match: \"true\"\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f vault-static-secret.yaml\n</code></pre> <p>Now proceed to Deploy Application section.</p>"},{"location":"integrations/vault/vault-vso.html#option-2-approle-authentication","title":"Option 2: AppRole Authentication","text":"<p>This section covers setting up VSO with Vault AppRole authentication. This method uses a RoleID and SecretID pair.</p>"},{"location":"integrations/vault/vault-vso.html#approle-step-1-create-vault-policy","title":"AppRole: Step 1 - Create Vault Policy","text":"<pre><code>vault policy write myapp-read - &lt;&lt;EOF\npath \"secret/data/myapp\" {\n  capabilities = [\"read\"]\n}\npath \"secret/metadata/myapp\" {\n  capabilities = [\"read\"]\n}\nEOF\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#approle-step-2-enable-and-configure-approle-auth","title":"AppRole: Step 2 - Enable and Configure AppRole Auth","text":"<pre><code># Enable AppRole auth method (skip if already enabled)\nvault auth enable approle\n\n# Create AppRole role\nvault write auth/approle/role/vso-role \\\n  secret_id_ttl=0 \\\n  token_policies=myapp-read \\\n  token_ttl=1h \\\n  token_max_ttl=4h\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#approle-step-3-get-roleid-and-secretid","title":"AppRole: Step 3 - Get RoleID and SecretID","text":"<pre><code># Get RoleID\nROLE_ID=$(vault read -field=role_id auth/approle/role/vso-role/role-id)\necho \"RoleID: $ROLE_ID\"\n\n# Generate SecretID\nSECRET_ID=$(vault write -field=secret_id -f auth/approle/role/vso-role/secret-id)\necho \"SecretID: $SECRET_ID\"\n</code></pre> <p>Important: Save both values. You'll need them in Step 5.</p>"},{"location":"integrations/vault/vault-vso.html#approle-step-4-write-secrets","title":"AppRole: Step 4 - Write Secrets","text":"<pre><code>vault kv put secret/myapp \\\n  username=\"admin-user\" \\\n  password=\"super-secret-password\"\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#approle-step-5-create-application-namespace-and-approle-secret","title":"AppRole: Step 5 - Create Application Namespace and AppRole Secret","text":"<pre><code># Create namespace\nkubectl create namespace vault-vso-test\n\n# Create service account (required by the deployment)\nkubectl create serviceaccount vault-vso-sa -n vault-vso-test\n\n# Create Kubernetes Secret with AppRole SecretID\n# The secret must have a key named \"id\" (required by VSO)\n# Replace &lt;SECRET_ID&gt; with the SecretID from Step 3\nkubectl create secret generic vault-approle-secret -n vault-vso-test \\\n  --from-literal=id=\"&lt;SECRET_ID&gt;\"\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#approle-step-6-create-vaultconnection","title":"AppRole: Step 6 - Create VaultConnection","text":"<p>Create <code>vault-connection.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultConnection\nmetadata:\n  name: vault-connection\n  namespace: vault-vso-test\nspec:\n  address: \"http://vault.vault.svc.cluster.local:8200\"\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f vault-connection.yaml\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#approle-step-7-create-vaultauth","title":"AppRole: Step 7 - Create VaultAuth","text":"<p>Create <code>vault-auth.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultAuth\nmetadata:\n  name: vault-auth\n  namespace: vault-vso-test\nspec:\n  vaultConnectionRef: vault-connection\n  method: appRole\n  mount: approle\n  appRole:\n    roleId: &lt;ROLE_ID&gt;\n    secretRef: vault-approle-secret\n</code></pre> <p>Note: Replace <code>&lt;ROLE_ID&gt;</code> with the RoleID from Step 3. The <code>secretRef</code> is the name of the K8s Secret created in Step 5, which must contain a key named <code>id</code> with the SecretID value.</p> <p>Apply:</p> <pre><code>kubectl apply -f vault-auth.yaml\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#approle-step-8-create-vaultstaticsecret","title":"AppRole: Step 8 - Create VaultStaticSecret","text":"<p>Create <code>vault-static-secret.yaml</code>:</p> <pre><code>apiVersion: secrets.hashicorp.com/v1beta1\nkind: VaultStaticSecret\nmetadata:\n  name: app-secrets\n  namespace: vault-vso-test\nspec:\n  vaultAuthRef: vault-auth\n  mount: secret\n  type: kv-v2\n  path: myapp\n  refreshAfter: 30s\n  destination:\n    name: app-secrets\n    create: true\n    annotations:\n      reloader.stakater.com/match: \"true\"\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f vault-static-secret.yaml\n</code></pre> <p>Now proceed to Deploy Application section.</p>"},{"location":"integrations/vault/vault-vso.html#common-configuration","title":"Common Configuration","text":"<p>The following sections apply to both authentication methods.</p>"},{"location":"integrations/vault/vault-vso.html#deploy-application","title":"Deploy Application","text":"<p>Create <code>deployment.yaml</code>:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: vault-vso-test-app\n  namespace: vault-vso-test\n  annotations:\n    reloader.stakater.com/search: \"true\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: vault-vso-test-app\n  template:\n    metadata:\n      labels:\n        app: vault-vso-test-app\n    spec:\n      serviceAccountName: vault-vso-sa\n      containers:\n        - name: app\n          image: busybox:latest\n          command:\n            - \"sh\"\n            - \"-c\"\n            - |\n              while true; do\n                echo \"Username: $APP_USERNAME\"\n                echo \"Password: $APP_PASSWORD\"\n                sleep 30\n              done\n          env:\n            - name: APP_USERNAME\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: username\n            - name: APP_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: app-secrets\n                  key: password\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f deployment.yaml\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#verify-the-setup","title":"Verify the Setup","text":"<pre><code># VaultConnection\nkubectl get vaultconnection -n vault-vso-test\n\n# VaultAuth\nkubectl get vaultauth -n vault-vso-test\n\n# VaultStaticSecret\nkubectl get vaultstaticsecret -n vault-vso-test\n\n# Secret (created by VSO)\nkubectl get secret app-secrets -n vault-vso-test\n\n# Pod\nkubectl get pods -n vault-vso-test\n\n# Verify secret contents\nkubectl get secret app-secrets -n vault-vso-test -o jsonpath='{.data.password}' | base64 -d\n\n# Check app logs\nkubectl logs -n vault-vso-test -l app=vault-vso-test-app\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#test-secret-rotation","title":"Test Secret Rotation","text":""},{"location":"integrations/vault/vault-vso.html#update-secret-in-vault","title":"Update Secret in Vault","text":"<pre><code>vault kv put secret/myapp \\\n  username=\"admin-user\" \\\n  password=\"new-rotated-password\"\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#wait-and-verify","title":"Wait and Verify","text":"<p>Wait 30-60 seconds for VSO refresh and Reloader restart:</p> <pre><code># Check secret was updated\nkubectl get secret app-secrets -n vault-vso-test -o jsonpath='{.data.password}' | base64 -d\n\n# Check pod was restarted (new pod name)\nkubectl get pods -n vault-vso-test -l app=vault-vso-test-app\n\n# Check app logs show new password\nkubectl logs -n vault-vso-test -l app=vault-vso-test-app --tail=5\n</code></pre>"},{"location":"integrations/vault/vault-vso.html#configuration-reference","title":"Configuration Reference","text":""},{"location":"integrations/vault/vault-vso.html#vaultconnection-configuration","title":"VaultConnection Configuration","text":"Field Description <code>address</code> Vault server URL (e.g., <code>http://vault.vault.svc.cluster.local:8200</code>) <code>caCertSecretRef</code> (Optional) Reference to K8s Secret containing Vault CA certificate <code>tlsServerName</code> (Optional) TLS server name for certificate verification <code>skipTLSVerify</code> (Optional) Skip TLS verification (not recommended for production)"},{"location":"integrations/vault/vault-vso.html#vaultauth-configuration","title":"VaultAuth Configuration","text":""},{"location":"integrations/vault/vault-vso.html#kubernetes-authentication","title":"Kubernetes Authentication","text":"Field Description <code>vaultConnectionRef</code> Reference to the VaultConnection resource <code>method</code> Auth method: <code>kubernetes</code> <code>mount</code> Auth mount path in Vault (e.g., <code>kubernetes</code>) <code>kubernetes.role</code> Vault role name <code>kubernetes.serviceAccount</code> Kubernetes ServiceAccount name"},{"location":"integrations/vault/vault-vso.html#approle-authentication","title":"AppRole Authentication","text":"Field Description <code>vaultConnectionRef</code> Reference to the VaultConnection resource <code>method</code> Auth method: <code>appRole</code> <code>mount</code> Auth mount path in Vault (e.g., <code>approle</code>) <code>appRole.roleId</code> AppRole RoleID <code>appRole.secretRef</code> Name of K8s Secret containing SecretID (must have a key named <code>id</code>)"},{"location":"integrations/vault/vault-vso.html#vaultstaticsecret-configuration","title":"VaultStaticSecret Configuration","text":"Field Description <code>vaultAuthRef</code> Reference to the VaultAuth resource <code>mount</code> Secrets engine mount path (e.g., <code>secret</code>) <code>type</code> Secrets engine type (<code>kv-v2</code> or <code>kv-v1</code>) <code>path</code> Secret path within the mount (e.g., <code>myapp</code>) <code>refreshAfter</code> How often VSO syncs secrets from Vault (e.g., <code>30s</code>) <code>destination.name</code> Name of the K8s Secret to create <code>destination.create</code> Whether to create the Secret if it doesn't exist <code>destination.annotations</code> Annotations to add to the created Secret"},{"location":"integrations/vault/vault-vso.html#reloader-annotations","title":"Reloader Annotations","text":"Resource Annotation Deployment <code>reloader.stakater.com/search: \"true\"</code> Secret (via VaultStaticSecret destination) <code>reloader.stakater.com/match: \"true\"</code>"},{"location":"integrations/vault/vault-vso.html#comparison-kubernetes-auth-vs-approle","title":"Comparison: Kubernetes Auth vs AppRole","text":"Aspect Kubernetes Auth AppRole Credentials Dynamic tokens from ServiceAccount Static RoleID + rotating SecretID Security No static secrets, tokens auto-rotate SecretID can be rotated, RoleID is static Setup Complexity Requires Vault K8s auth configuration Requires AppRole setup + secret management Vault Config Policy + K8s auth role Policy + AppRole role Best For In-cluster workloads, production Cross-cluster setups, CI/CD pipelines"}]}